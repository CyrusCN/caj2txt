Ｉ寺 故 ＊ 葦

Ｔ ＹＯ Ｆ  Ｅ Ｌ Ｅ Ｃ Ｔ Ｒ Ｏ Ｎ Ｉ Ｃ Ｓ Ｃ Ｉ Ｅ Ｎ Ｃ Ｅ Ａ Ｎ ＤＴ Ｅ Ｃ Ｈ Ｎ Ｏ Ｌ Ｏ Ｇ ＹＯ Ｆ Ｃ Ｈ Ｉ Ｎ Ａ

巧Ｕ Ｎ Ｉ

Ｖ Ｅ Ｒ Ｓ Ｉ

去

？

？

．

：

．

．

参

硕 ± 学 位 论 文

ｆ
Ｍ Ａ Ｓ Ｔ Ｅ ＲＴ Ｈ Ｅ Ｓ Ｉ Ｓ

非 《

，

。 ‘￣

 瑞

／ 柄 聲 ，
 ．

“Ｖ

，游 八

’

．

，

．

．

．磯１ ．

论文 题 目 基于安卓 的 多特征疲劳实 时检测 系统 设计 与实现

藻学 科 专 业



计算 机巧 用 技术＿

＿

＇

‘

，



Ｉ学号２ ０ １ ３ ２ １ ０ ６ ０巧 ５

 ｆ令 者 姓 名苟群森
指 导 教 师叶 茂教 授

■

分类号                                                                      密级           

UDC 注 1                                                           

指导教师     

申请学位级别     

            学科专业     

提交论文日期  2016.3.28  论文答辩日期      2016.5.18                   

学位授予单位和日期           

    2016

6

答辩委员会主席                                           

评阅人                                                                                           

注 1：注明《国际十进分类法 UDC》的类号。 

 
 
 
 
 
   
   
   
 
 
 
 
 
 
 
 
 
 
 
 
 
 
   
 
 
 
 
 
   
   
 
     
   
 
 
 
   
 
                       
     
         
           
                   
 
Design and Implementation of a Real-time 
Multi-feature Fatigue Detection System Based on 
Android 

A Master Thesis Submitted to 

University of Electronic Science and Technology of China 

Major:            Computer Applied Technology 

Author:                            Qunsen Gou 

Supervisor:                            Prof. Mao Ye 

School:    School of Computer Science and Engineering 

 
 
 
 
 
 
 
 
摘要 

摘    要 

随着社会交通运输的快速发展，越来越多的长途客货运驾驶员忙碌在工作岗

位，因疲劳驾驶出现的事故频繁发生。因此，疲劳驾驶检测的相关研究意义重大。

其中基于计算机视觉的检测方法因为对驾驶员无干扰成为研究热点。目前已有的

方法存在的问题是计算复杂度高，耗时长，难以在移动设备上实现实时检测。 

本文选择实现基于安卓系统的实时疲劳检测系统，包括移动检测终端和远程

网络监控系统。采用人脸对齐算法得到眼睛、嘴巴和头部等疲劳特征，实现疲劳

状态分析。本文主要有以下研究成果： 

改进显式形状回归人脸对齐算法，提出基于二级形状参数回归的人脸对齐算

法。采用 PCA 降维，用低维的人脸形状参数约束人脸形状。在二级回归框架中，
仅简单计算低维的人脸形状参数，替代原始的高维人脸形状。针对人脸的旋转角

度和尺度大小不同，使用明确的形状特征索引算法替代局部特征索引，提高特征

的可比性。采用多重随机特征选择方法，筛选出更好的人脸特征。通过算法改进，

明显减小了运算复杂度和数据存储量，提高了对齐速度和对齐效果。 

在安卓系统算法实现时将人脸对齐分为人眼对齐和人脸轮廓对齐两个步骤。

人眼对齐时，通过对人脸图片的截取和压缩，仅处理图片大小 80*40 的人眼区域，
用 20 个特征点描述人眼形状，并降到 20 维，减少单次需要处理的图像信息和数
据维度。人脸轮廓对齐时，选取 27 个特征点表示人脸轮廓形状，并降到 20 维，
根据人眼对齐结果得到的双眼瞳孔坐标，优化人脸轮廓初始形状，使人脸轮廓对

齐更快更精确。 

疲劳特征分析时，根据对齐的人眼形状和人脸轮廓形状中特征点的坐标位置，

采用简单的四则运算判断眼睛的睁闭、嘴巴的张合程度和头部上下运动。选取鼻

尖和脸颊的 3 个特征点坐标组成特征三角形，根据三角形形状变化判断头部的偏
转方向。最后综合全部疲劳特征给出检测结果，减少单一疲劳特征判断出现的误

检。 

最后，实现的检测程序在性能一般的安卓系统手机、平板上达到了良好的检

测效果和实时的检测速度，实现了网络监测服务器端系统。 

关键词：安卓系统，疲劳驾驶检测，多特征分析，形状参数回归，人脸对齐

I 

 
 
ABSTRACT 

ABSTRACT 

With  the  rapid  development  of  the  social  transportation,  more  and  more 

long-distance transport drivers are busy at work. However, the driving accidents occur 

frequently due to the fatigue driving. Therefore, it is significant to research the fatigue 

driving  detection.  The  detection  method  based  on  computer  vision  has  become  a  hot 

topic because of no interference to the drivers. The existing methods have the problems 

of high computational complexity and time consume so that it is difficult to achieve the 

real-time detection on mobile devices. 

In  this  paper,  we  implement  the  real-time  fatigue  detection  system  based  on 

Android  system.  Our  system  includes  the  mobile  detection  terminal  and  the  remote 

network  monitoring  system.  The  face  alignment  algorithm  is  used  to  get  the  fatigue 

characteristics of the eyes, the mouth and the head. This paper mainly has the following 

research results: 

We improve the explicit shape regression face alignment algorithm and propose the 

novel  face  alignment  algorithm  based  on  the  shape  parameter  regression  algorithm 

using  the  second  order  regression  framework.  We  regulate  face  shapes  by  low 

dimensional face shape parameters which are obtained by PCA. In the framework of the 

second regression, only the low dimensional parameters are calculated for replacing the 

original  high  dimension  parameters.  For  different  rotation  angles  and  face  scales,  the 

explicit shape feature index algorithm is used to replace the local feature index, which 

can  improve  the  comparability  of  features.  We  employ  the  multiple  random  feature 

selection  method  to  select  better  features.  Through  improving  the  algorithm,  the 

computation  complexity  and  data  storage  capacity  are  greatly  reduced,  and  the 

alignment speed and alignment effect are improved. 

During  the  implementation  of  the  Android  system,  the  face  alignment  is  divided 

into two steps, the alignment of the  human  eyes and the alignment of the human  face 

contours. In the first step, we just process the human eye areas with the size of 80*40 

pixels. 20 feature points whose dimensions are 20 are used for aligning the eye shape. 

By  this  way,  we  reduce  the  image  information  and  data  dimensions  for  the  single 

processing.  In  the  second  step,  27  feature  points  whose  dimensions  are  also  20  are 

selected  to  represent  the  shape  of  the  face  contours.  According  to  the  results  of  the 

II 

ABSTRACT 

human eye alignment, we optimize the initial shape of the face contours. Thus, the face 

contour alignment is faster and more accurate. 

When analyzing the characteristics of the fatigue, according to the alignment of the 

human  eye  shapes  and  the  coordinates  of  the  feature  points  in  the  shape  of  the  face 

contours, we use a simple four operations to judge the open and close of eyes, the open 

and  close  degrees  of  the  mouth,  and  the  up  and  down  movement  of  the  head.  The 

coordinates  of  three  feature  points  of  the  nose  and  cheek  are  selected  to  form  the 

characteristic  triangle.  According  to  the  change  of  the  triangle  shape,  we  judge  the 

deflection directions of the head. The detection results are given by the overall fatigue 

features, which reduce errors detected by single fatigue characteristic. 

Finally, we implement our detection program on the general Android mobile phone 

and  the  tablet  PC,  achieving  good  detection  results  and  real-time  detection  speed. 

Furthermore, we realize the network monitoring server system. 

Keywords: Android, fatigue driving detection, multi-feature analysis, shape parameter 

regression, face alignment 

III 

 
 
目录 

目    录 
第一章 绪 论 .................................................................................................................. 1 
1.1  疲劳检测的背景与意义 .................................................................................... 1 
1.2  疲劳检测的国内外研究历史与现状 ................................................................ 1 
1.2.1  接触式疲劳检测方法 ............................................................................... 1 
1.2.2  非接触疲劳检测方法 ............................................................................... 3 
1.2.3  疲劳检测方法总结 ................................................................................... 5 
1.3  本文的主要贡献与创新 .................................................................................... 6 
1.4  本论文的结构安排 ............................................................................................ 7 
第二章 相关理论基础 .................................................................................................... 8 
2.1 PCA 降维 ............................................................................................................ 8 
2.2  人脸检测方法简介 ............................................................................................ 9 
2.2.1  基于肤色的人脸检测方法 ..................................................................... 10 
2.2.2  基于几何特征的人脸检测方法 ............................................................. 10 
2.2.3  基于统计理论的人脸检测方法 .............................................................. 11 
2.3  人脸特征点提取方法简介 .............................................................................. 12 
2.3.1  点分布模型 ............................................................................................. 12 
2.3.2  基于优化的人脸特征点提取方法 ......................................................... 13 
2.3.3  基于回归的人脸特征点提取方法 ......................................................... 14 
2.4  本章小结 .......................................................................................................... 15 
第三章 基于安卓的疲劳检测系统的架构设计 .......................................................... 16 
3.1  概述 .................................................................................................................. 16 
3.2  系统架构设计方案 .......................................................................................... 17 
3.2.1  疲劳检测系统整体架构图 ..................................................................... 17 
3.2.2  疲劳检测安卓端系统设计 ..................................................................... 17 
3.2.3  后台监测服务器系统设计 ..................................................................... 19 
3.3  本章小结 .......................................................................................................... 21 
第四章 改进的人脸对齐方法 ...................................................................................... 22 
4.1  显式形状回归人脸对齐算法 .......................................................................... 22 
4.1.1  训练样本 ................................................................................................. 22 
4.1.2  显示形状回归模型 ................................................................................. 24 
4.1.3  人脸特征提取与选择 ............................................................................. 26 
4.2  改进的显式形状回归算法 .............................................................................. 28 

IV 

目录 

4.2.1  人脸形状空间 ......................................................................................... 29 
4.2.2  二级级联形状参数回归 ......................................................................... 30 
4.2.3  改进形状特征索引 ................................................................................. 32 
4.2.4  多重随机特征选择 ................................................................................. 34 
4.3  实验结果分析 .................................................................................................. 35 
4.3.1  人脸数据库介绍和实验参数设置 ......................................................... 35 
4.3.2  误差分析 ................................................................................................. 37 
4.4  本章小结 .......................................................................................................... 40 
第五章 安卓端算法实现 .............................................................................................. 41 
5.1  安卓端人眼对齐与疲劳特征分析 .................................................................. 42 
5.1.1  电脑端人眼对齐训练过程 ..................................................................... 42 
5.1.2  安卓端人眼对齐检测过程 ..................................................................... 45 
5.1.3  人眼疲劳特征分析 ................................................................................. 46 
5.2  安卓端人脸轮廓对齐与疲劳特征分析 .......................................................... 47 
5.2.1 人脸轮廓对齐训练与检测 ..................................................................... 48 
5.2.2  头部对齐结果状态分析 ......................................................................... 49 
5.2.3  嘴部对齐结果状态分析 ......................................................................... 51 
5.3  综合疲劳特征分析 .......................................................................................... 52 
5.4  本章小结 .......................................................................................................... 54 
第六章 系统实现 .......................................................................................................... 56 
6.1  安卓端检测系统实现 ...................................................................................... 56 
6.2  服务器端系统实现 .......................................................................................... 60 
6.3  本章小结 .......................................................................................................... 61 
第七章 总结与展望 ...................................................................................................... 62 
7.1  全文总结 .......................................................................................................... 62 
7.2  不足与展望 ...................................................................................................... 63 
致  谢 ............................................................................................................................ 64 
参考文献 ........................................................................................................................ 65 
攻读硕士学位期间的成果 ............................................................................................ 68 

V 

 
第一章  绪论 

第一章  绪  论 

1.1  疲劳检测的背景与意义 

随着我们国家经济的快速发展、大众生活水平的提高和基础建设的越来越完

善，铁路、机动车出行逐渐成为首选。我国汽车保有量越来越大，数量增速也成

为世界第一，驾校更是如雨后春笋，热度不减，驾驶员渐渐成为每一个人的新身

份。另外，国家在基础设施建设上继续提速，高速公路方面，逐渐实现区县相通

高速公路网，实现人口和 GDP 的百分之九十以上覆盖。高速铁路方面，十三五规
划要实现所有省会城市、直辖市之间的高铁连通。即时将有更多的职业列车司机

和长途运输司机忙碌在工作岗位上。 

然而，随着铁路、公路客货运数量的提升，更多的驾驶员加入并长期工作在

这个岗位，让交通安全越来越严峻。中国每年的交通事故造成的个人家庭和国家

经济的损失不可估量，有数据显示超过五分之一的交通事故由驾驶员疲劳引起。

经研究人员发现，长途汽车、列车司机在漫长而单调的驾驶之后，如果强忍着疲

劳工作，其危险程度将同醉酒驾驶一样。而职业长途汽车驾驶员和列车司机的工

作环境更令人担心，因为长时间的高度精神集中，身体机能消耗大，并且驾驶环

境枯燥，外界干扰少，非常容易使驾驶人出现疲劳状态。 

综上所述，进行疲劳驾驶检测的相关研究意义重大。研究时考虑应用效果和

环境，提高检测精度，减少检测时对驾驶员的干扰程度，实现提前预警，疲劳警

报等功能。 

1.2  疲劳检测的国内外研究历史与现状 

疲劳驾驶检测因在交通事故应用中的重要性和巨大的商业前景而受到国内外

研究人员和企业的高度重视和持续的研究投入。目前为止，疲劳检测的方法主要

分为接触式及非接触式两种。采用传感器监测驾驶员生理信号，得到脉搏信号，

脑电图，心电图，肌电图，呼吸频率等生理指标对疲劳状态进行分析的方法需要

有仪器连接驾驶员身体，称为接触式。通过图像监控驾驶员头部运动和面部表情，

进行图像处理，或者通过机械控制监测车辆运行轨迹，分析车辆行驶状态来判断

驾驶员状态的方法，称为非接触式。 

1.2.1  接触式疲劳检测方法 

接触式疲劳检测方法，主要靠检测驾驶员的生理信息，会在驾驶员的身体部

1 

 
电子科技大学硕士学位论文 

分部位安装需要的传感器等，会对驾驶员造成部分身体的不适和驾驶过程中的干

扰，但是由于生理信息对人清醒和疲劳状态的反馈最为准确，也成为疲劳检测的

热门研究方向。 

（1）脑电图监测（
研究发现脑电信号 EEG 的频率变化能直观地表达人的疲劳程度，是检测疲劳
状态准确度最高、客观性最强的方法。吉林大学的高振海教授[1]带领团队在驾驶员

） 

疲劳特征与脑电信号相关性研究上取得不错进展。该团队让驾驶员使用环实验台，

再利用

多导生理记录仪进行仿真驾驶实验，使被测驾驶员在模拟多

种路况下持续进行驾驶，观察并记录由清醒阶段到疲劳阶段的脑电信号变化规律。

原始采集到的脑电信号数据并不能直接用来分析，需要对原始的脑电信号数据采

取滤波处理、降频重采样以及伪迹处理等。最终发现四类典型信号，其中 波（0 - 
4 Hz）和 波（4 – 7 Hz）最具相关性，分别和轻度疲倦、严重嗜睡相关。 波（12 
– 30 Hz）与人的警觉性和活跃程度有关。 波（8 – 13 Hz）也具有一定辅助的指
示作用。 

（2）心电图检测（
心电图在现代科学中一直作为临床医学诊断的重要参考项目，它能直观地表

） 

现出驾驶员身体机能的变化。驾驶员在逐渐疲劳的过程中，心电信号图的周期和

形态上会有显著的不同，所以将心电图作为分析驾驶员疲劳的原始数据是一个重
要 的 研 究 方 向 。 重 庆 大 学 邓 小 燕 教 授 的 团 队 [2] 采 用 心 率 变 异 性 （ Heart  Rate 
Variability,  HRV）信号来检测疲劳。心率变异性是两次心跳之间的细小差异，即
RR 间期序列，它能体现交感和副交感两种影响，并反应呼吸调节和心脏自主神经
信号，筛选了三种指标进行最终分析：时域指标，
系统的变化。通过得到的

包括反应 间期均值的

，反应 间期标准差的

，反应

变化

速率的

（ 间期的差值均方根）；频域指标，包括高频（ ）和低频

（ ）；非线性指标，包括关联维数 和

指数 。通过分析驾驶员疲

劳时各指标的变化规律，发现以下结论：

明显上升（P<0.05），但

和

几乎没有波动（P>0.05 ），最终增大了

的总数值； 明显增大

（P<0.05）且 明显变小（P>0.05），体现交感神经变得活跃而迷走神经趋于平
复；关联维数和 Lyapunov 指数都有明显减小（P<0.05），体现了非线性指标的
信号交错程度下降。通过上述指标变化规律分析，表明 HRV 能良好且精确地判断
驾驶员是否疲劳和疲劳程度。 

2 

EEGElectroencephalogram，Biopac MP100ECGElectrocardiogram，HRVRRMEANRRSDNNHRVRMSSDRRHFLF2DLyapunovLESDNNRMSSDMEANHRVLFHFHRV 
第一章  绪论 

1.2.2  非接触疲劳检测方法 

非接触疲劳检测方法由于对驾驶员的干扰小，可行性强，成为疲劳驾驶检测

的主要研究方向。非接触疲劳检测方法又分为对驾驶员状态和车辆行驶状态的检

测，也可以两者综合判断。近几年由于计算机视觉和模式识别研究的兴起，检测

驾驶员面部疲劳特征来判断疲劳状态的研究不断出现。因为全程只需要通过摄像

头拍摄驾驶员的头部照片，设备简单且容易模拟实验环境，便于研究人员在实验

室内研发。 

（1）车辆行驶状态检测 
车辆状态检测为非接触式，对驾驶员无干扰，且不受光照，环境变化影响，

成为汽车公司的重点研究方向。驾驶员疲劳时，对车辆的操控会有所改变，出现

一定的误操作，从而造成严重后果，所以，车辆行驶状态的改变也可以部分反映

驾驶员的状态。沃尔沃公司以注重车辆安全出名，不仅在车身结构安全和行人保

护安全方面成果突出，最近他们还推出了防疲劳驾驶辅助系统（DAS-W）。该系
统主要是通过摄像头拍摄汽车行驶路线，分析车辆行驶轨迹和道路线检测，若发

现行驶轨迹异常，则通过主动降速、双闪灯提示和声音报警等功能预防危险发生，

并提醒驾驶员。 

车辆行驶状态的变化最早表现在驾驶员对方向盘的控制上，所以通过监控驾

驶员对方向盘操作的微小变化信息，可以实现疲劳驾驶检测。由于传统研究多在

模拟实验室完成，不能综合考虑驾驶员习惯、车辆行驶速度、交通实际环境和驾

驶员技术熟练程度等因素，清华大学汽车安全与节能国家重点实验室[3]基于实际道

路条件，提出了以方向盘的修正幅度和频率为特征的方向盘微小变化检测。提出

了双时间窗口的细微变化指标提取方法。该方法包括两个判断指标：最大零速比

）和最大角度标准差。其中 PNS=n/N，N 为一段时
PNS（
间内角速度的采样数和，n 为采样点里面角速度在±0.1°/s 的点数。在该判别标准
下，实验表明疲劳驾驶识别准确率达到了 82%。 

（2）眼睛的睁闭状态检测 
实验表明，眼睛的睁闭程度能很好地表达疲劳状态，卡内基梅隆研究员经过

反复实验和论证，提出了度量疲劳或瞌睡的物理量

（

，

），具体表达是一段时间内（通常实验选 分钟

或者 秒）检测到眼睛闭眼的时间和总时长的比值（

、

）。通过实验找

到较好的阀值，高于该阀值则表示疲劳状态发生。美国联邦公路管理局（

）

和美国国家公路交通安全管理局（

轨迹检测以及头部位置等），确定了

）通过对比实验（如 EEG、车辆行驶
方法和疲劳的相关性以及检测的有

3 

percentage of non steeringPERCLOSPercentage of EyelidClosure over the Pupilover Time13070%80%FHWANHTSAPERCLOS 
 
电子科技大学硕士学位论文 

效性，并提出将

作为检测驾驶员疲劳的检测指标。但是

是通过

一种特殊的摄像头来找到眼睛，在此基础上运用

方法，设备复杂而无法

实际商用，所以基于该指标的检测方法迅速成为实时疲劳检测的研究热点。该方

法都是在定位到眼睛区域后，再对眼睛区域进行分析，主要方法有：基于积分投

影，基于模板匹配，基于眼脸曲率，基于

检测，基于统计的方法[4]。 

基于积分投影方法，主要对眼睛区域进行灰度图像积分投影，获得眼睛的高

度或宽度，也有选择得到瞳孔的宽度或面积占比。但此方法受光线干扰大，且数

据单一普适性差，或者需要通过辅助的红外设备，对驾驶员眼睛有干扰，实际使

用效果较差。 

基于模板匹配的疲劳检测方法，是根据眼睛的不同状态收集不同的样本，通

过人工分类，由多个相同类样本取平均构造人眼模板。在检测时通过人脸检测、

人眼定位并将定位得到的眼睛区域和模板的相似度来判断疲劳状态。模板匹配分

为固定模板和可变参数模板。固定模板匹配有识别精度高的特点，但由于现实生

活中眼睛类型繁多，不可能收集完整，所以普适性不强，而改进的可变参数模板

虽适应性强，但实时性差。 

基于眼脸曲率的检测方法，指通过检测眼睛不同状态时眼脸边缘的曲线率来

判断疲劳的一种方法。该方法虽然理想状态下效果明显，但实验中眼睫毛和眼皮

边缘等其它轮廓信息的干扰太大，眼脸边缘完整性的准确度不高，所以实际检测

效果不佳。 
基于

变化检测，是利用人眼的瞳孔为圆形且与眼白部分边缘清晰，特

征明显。用

变换检测定位到的眼睛区域有无圆形的边缘区域，由此分辨人

眼的张闭状态。但该算法普适性很差，不仅不同人眼睁开时露出瞳孔的状态差异

很大，且对拍摄到的图像质量要求高，需要清晰规范的圆形瞳孔形态，容易受到

光照和噪声的影响，检测准确度不高。 

基于统计的方法，该方法首先要收集大量的人眼各个状态下的样本，通过手

工分类样本后，训练分类器，再用分类器对定位到的人眼区域进行检测。该方法

检测准确度较高，但是提高精度的同时也会增加样本的数量，分类器的过大，增

加处理时间，难以在移动设备上应用。 

（3）嘴部状态检测 
当人处于疲劳初期时会出现打哈欠的动作，当打哈欠时嘴巴的张大幅度会明

显大于平时说话或吃东西时候的幅度，所以通过检测嘴部形状的变化可以判断驾

驶员当前的精神状态。嘴唇的定位由于受驾驶员个体差异（如露齿、伸舌头和是

否有胡须等）以及光照的原因成为一个复杂的问题。孙伟等[5]为了提高唇色特征提

4 

PERCLOSNHTSAPERCLOSHoughHoughHough第一章  绪论 

取效果，挑选了 3 种特别的颜色特征构建 Fisher 分类器，显著高于使用单一颜色
特征提取唇色的效果，再用积分投影方法定位嘴唇轮廓，确定上下嘴唇和左右嘴

角的距离。定义嘴部的张合度公式为 R=H/W，根据实验得到的阀值 T，当 R≥T
时，判断为打哈欠状态，否则为一般状态，一般状态包括说话、吃东西以及呼吸

等幅度较大的情况。 

（4）头部位移检测 
当人处于疲劳时头部会明显偏离处于清醒时的位置，出现点头、后仰靠椅动

作或头偏向两侧。通过检测驾驶员一段时间内头部位置变化可以判断驾驶员的清

醒或疲劳状态。ASCI（
检测装置，能准确得到驾驶员头部的位移变化。通过在驾驶位靠枕部位安装电容

）开发的车内驾驶员后脑部位

传感器阵列，每个传感器检测自身到驾驶员头部的直线距离。通过处理数据，能

得到驾驶员头部在三维空间中的位移变化，根据一段时间内驾驶员头部运动特征，

判断驾驶员的疲劳或清醒状态。 

（5）面部表情检测 
为了避免因为局部人脸特征作为疲劳检测的标准，杨秋芬等[6]通过研究人脸整

体表情特征，确定了通过表情特征作为疲劳检测的可行性，并得出面部动态视频

评分和静态图像表情分析的疲劳等级。根据人脸面部器官和肌肉纹理位置，选取

得到 7 个疲劳特征指标。 

清华的马添翼[7]参考 MPEG-4 协议的面部特征点定义，并采用里面的 23 个特
征标注点，如图 1-1 所示。提出一种表情几何拓扑构型的疲劳检测特征，建立了全
新的疲劳表情形态体系，量化疲劳表情特征，归纳得到三类的面部疲劳状态的判

别。 

图 1-1  人脸特征点选择 

1.2.3  疲劳检测方法总结 

迄今为止，疲劳检测已经包括了对驾驶员的生理反应、行为特征以及局部特

5 

Advanced Safety Concept Inc. 
 
电子科技大学硕士学位论文 

征变化等，对车辆的行驶轨迹、操控行为变化，以及多种信息融合的研究。各种

方法在实用性、准确性、抗干扰性和对驾驶员的侵入性都有所差别，如表 1-1 所示： 

表 1-1  各种疲劳检测方法对比 

检测目标 

检测方法 

商用程度  抗干扰性  有无接触  设备复杂度  准确性 

驾驶员生理信号 

脑电、肌电信号 

心电图、脉搏等 

低 

强 

驾驶员身体反应 

车辆行为 

眼睛睁闭 

一般 

一般 

嘴部打哈欠 

头部位置变化 

面部表情特征 

行驶轨迹 

方向盘转动 

低 

高 

低 

一般 

一般 

低 

低 

一般 

一般 

一般 

有 

无 

无 

无 

无 

无 

无 

高 

高 

一般 

一般 

简单 

一般 

一般 

一般 

较高 

一般 

较差 

较高 

一般 

一般 

1.3  本文的主要贡献与创新 

本论文在仔细调研当前疲劳驾驶检测的研究现状基础上，选用并改进人脸对

齐算法，提出基于二级级联形状参数回归的人脸对齐算法，实现基于安卓系统的

实时疲劳驾驶检测系统。该系统主要包括安卓移动设备端的实时疲劳检测和网络

端疲劳检测结果实时显示、查看和记录。安卓设备端的疲劳检测主要包括图片预

处理、人脸检测、眼部区域定位与对齐、脸部轮廓对齐、疲劳状态分析与报警提

示以及疲劳状态图片发送到服务器等功能。网络端主要包括接收实时疲劳状态图

片、显示并保存，提供登录管理和历史记录查询等功能。 

本文的主要创新点如下： 
（1）率先采用人脸对齐方法应用于疲劳驾驶检测。通过对齐人脸形状，直接
得到全部人脸面部器官轮廓信息，与传统方法相比，避免分别检测、定位和分析

人脸各个器官的状态。减少了处理数据，提高检测速度。 

（2）改进显式形状回归算法：采用 PCA 降维，用低维的人脸形状参数约束
人脸形状；在二级回归框架中，仅简单计算低维的人脸形状参数，并通过改进形

状特征索引和特征选择方法来训练人脸形状参数回归量。根据改进提出基于二级

级联形状参数回归人脸对齐算法，提高了原始算法的对齐效率和对齐精度，并且

训练所得的模型文件小，易于在安卓系统中实现实时检测。 

（3）在安卓系统中分步实现人脸形状对齐，分别对齐人眼轮廓和简化的人脸
轮廓，并降低数据维度，极大地减少单次需要处理的数据量，加快检测速度。根

6 

第一章  绪论 

据人眼对齐得到精确的双眼瞳孔坐标位置，改进人脸轮廓对齐的初始形状，减少

了迭代次数，提高人脸轮廓的对齐速度和对齐效果。 

（4）疲劳特征分析时，根据人脸对齐结果，均通过简单的四则运算分析疲劳
特征，用上下眼脸坐标距离判断眼睛的睁闭，连续多帧的鼻尖坐标位置变化判断

头部运动，面部三角形形状变化判断面部朝向和偏转，嘴巴特征点的距离计算高

宽比判断张合程度，最后综合以上疲劳特征给出检测结果。避免了每个人脸器官

分别定位、图像与分析等复杂计算过程。 

1.4  本论文的结构安排 

本文的总体结构安排如下： 
第一章：绪论。本章说明了基于安卓系统的疲劳驾驶实时检测系统的研究意

义，介绍了当前疲劳驾驶检测的检测方法及成果，最后概括了本文的主要研究内

容和实现的创新。 

第二章：相关理论基础。介绍了基于安卓系统的疲劳驾驶实时检测系统实现

过程中主要用到的相关技术，包括 PCA 降维，人脸检测的各种方法，不同人脸对
齐算法优劣对比等。 

第三章：基于安卓的疲劳检测系统的架构设计。详细说明了系统安卓终端和

后台服务器端需要实现的各个功能模块，以及各功能模块间的联系。 

第四章：改进人脸对齐算法。首先介绍了显式形状回归人脸对齐算法，然后

详细描述了对改算法的多处改进，并提出二级人脸形状参数回归算法。 

第五章：疲劳状态分析。详细介绍安卓系统中分步实现人脸对齐训练和检测

算法的步骤。并根据对齐结果分别分析人眼、嘴巴、头部和面部的疲劳特征，最

后综合疲劳特征给出检测结果。 

第六章：系统实现。给出安卓终端和服务器网页端系统实现的效果展示图，

通过模拟实验验证系统稳定性。 

第七章：总结与展望。总结全文内容，根据实验结果分析系统的不足以及未

来工作能够改进的地方。

7 

 
电子科技大学硕士学位论文 

第二章  相关理论基础 

本文实现的实时疲劳检测系统采用摄像头实时拍摄驾驶员头部图像，通过图

像分析得到驾驶员精神状态变化。疲劳检测部分主要包括原始视频图像采集、图

像预处理、人脸检测、人脸对齐以及疲劳特征分析几个模块。为了达到准确并实

时的疲劳检测，本文详细调研了几个检测模块中涉及的相关算法和理论基础。本

章主要介绍疲劳检测系统中涉及的 PCA 主成分分析、人脸检测方法、常见人脸对
齐方法和人脸特征点提取方法。 

2.1 PCA 降维 

人脸对齐算法通常采用几十个特征点标注人脸特征，称为人脸形状，在对齐

过程中，根据人脸形状特征点提取到的人脸特征反复迭代调整人脸形状，通常迭

代的特征维数太多，导致计算复杂，耗时长。因此本文首先想到采用降维方法改

进传统的人脸对齐算法。常见的特征降维方法有两种：特征选择及特征抽取。分

别是从高维的特征数据中筛选出较好的子集替代全部特征和采用特别的函数将高

维的特征数据映射到低维的新特征。下面介绍特征抽取方法之一的主成分分析

（

）方法[8]。 

PCA（

）本质就是在尽可能保留更多更好的数据

信息条件下，把原来高维数据的特征信息进行线性变换、映射，降为低维数据空

间。它不仅实现了高维数据特征信息的降维，还在降维过程中消除了噪声，得到

了数据中的模式。

通过数据降维，将 个相关性大的随机变量

映

射为比 小的 个综合变量

。新的综合变量需要有下面几个特点：（1）

大大减小了变量个数，即

；（2） 个综合变量能保留大部分原始数据信息；

（3） 个综合变量相互独立，即

。因此

经常用于需要处理高

维数据的人脸对齐、大数据压缩和机器学习等领域，将原来大量高维且相关性较

大的数据变换为少数低维且相互独立的变量。 

综合变量 是原始数据变量的线性表达，表示为： 

                                  (2-1) 

8 

PCAPrincipal Component AnalysisPCAn12,,,nxxxnm12,,,mFFFnmmm(,)0ijCovFFPCAiF11111221221122221122...............nnnnmmmmnnFaxaxaxFaxaxaxFaxaxax第二章  相关理论基础 

式中 表示第 个主成分。 为第一主成分，是

所有线性组合中方差最

大且包含信息量最多的。若 不足以表示原始数据信息，则继续求 ，直到全部

个主成分包含足够的信息。 

从公式(2-1)可以看出，

主要任务是通过大量的训练样本求出其中所有的

未知系数 。将全部的系数 组成一个协方差矩阵，可以得到： 

              (2-2) 

也 就 是 求 矩 阵 。 要 求 出 所 有 主 成 分 ， 即

的 线 性 组 合 变 量

的 全 部系数

， 只需要 得 到原始 随 机变量

的协方差矩阵的前 个较大的特征值 。因为从数学上能够证明，随机

变量 的协方差矩阵的特征根就是 的方差，因此前 个较大的特征根就是前

个较大的 方差值。其中对系数添加约束

，即系数 选择的是 匹配的单

位特征向量。最终求得矩阵

，

，为相关系数矩

阵， 、 是对应的特征值和单位特征向量，其中

。 

2.2  人脸检测方法简介 

人脸检测与人脸定位是模式识别领域的研究热门，它是人脸对齐、人脸识别

等众多研究的基础，只有精确的人脸检测结果才能更好地实现对人脸的处理与分
析。人脸检测的难度主要在以下三个方面[9]： 

（1）检测对象的多变性，人脸存在长相各异、表情丰富、肤色不同以及姿态

多变等可变因素。 

（2）易受光照的干扰，二维图片显示三维的人脸时通常会受到光照影响产生

阴影。 

（3）干扰物体过多，生活中的人脸上经常会存在眼镜、胡须、口罩或者被帽

子遮挡等。 

由于人脸检测技术的困难，人脸检测技术不仅包括了图像处理和计算机视觉

的相关技术和理论，还涉及了生物解剖学、模式识别以及神经网络等不同学科的

内容。正是由于人脸检测的复杂性，目前大多研究都缺乏普适性，只是针对某个

领域的特定问题或环境取得一定的效果，不能适应所有的环境或情况。但经常也

会出现多个人脸检测方法混合使用，所以并没有清晰的检测方法分类，下面介绍

几种比较成熟的人脸检测方法。 

9 

iFi1F12,,,nxxx1F2FmPCAijaija111112112221222212nnmnmmmnnFxaaaxFxaaaxAFxaaaxA(1,2,...,)iFim(1,2,...,)jxn(1,2.,..,;1,2,...,)ijaimjn12,,,nxxxmiixiFmmiF'1iiaaiai12()(,,...,)ijmAanmaaaiiiRaaiia120n 
电子科技大学硕士学位论文 

2.2.1  基于肤色的人脸检测方法 

基于肤色的人脸检测方法[10]主要是依据：人脸的颜色相对稳定，不会随环境

的改变而有很大的变化，也不受姿态和角度改变的影响，因此可以通过找人脸颜

色快速定位出一个类似人脸的区域。但基于肤色的人脸检测方法也有显著的局限

性，即色彩是易受光照条件和背景环境等影响。单独的肤色检测方法速度快、实

现简单，但准确度不高，所以该方法的应用通常结合一些其它检测方法实现人脸

定位。目前研究中常见的人脸肤色空间有：YUV(YCbCr)、RGB(Red-Green-Blue)、
HSV(Hue-Saturation-Value)、HIS(Hue-Saturation-Intensity)、YIQ 等。 

（1）肤色检测与人脸特征结合的方法[11]。可以先在图像中分割出人的肤色部
分，再根据人脸轮廓特征，面部主要器官的定位，最终得到精确的人脸区域。具

体方法为将检测图像单元化，将大小为 M*N 的图像，均分为 P*Q 个单元为 m*n

的马赛克图像，提高后续肤色处理的速度和鲁棒性。根据 Soriano 等人的研究结论，
采用 RGB 中 R 和 G 空间的分布进行肤色空间描述，得到小单元化后的肤色区域
提取图像，通过连通域方法，粗定位候选人脸区域。在人脸候选区域采用基于灰

度投影算法确定眼睛位置，采用色彩空间差异建立唇色模型定位嘴巴。最后根据

眼睛、嘴巴的倒三角关系，精确定位人脸区域。 

（2）肤色检测与模板匹配结合的方法[12]。单独的肤色检测方法，面部区域容
易和其它类肤色区域分割为一个连通区域，也易受光照和三维器官影响而使整个

人脸被分为多个不连通的区域。单独的模板匹配方法虽然检测结果准确度高，但

是数据处理量大，耗时长，实时性差，所以结合两种检测方法能大大优化人脸检

测结果。通过肤色检测与分割后，得到图像中类似人脸的连通域部分，包括人脸

图像、其它肤色与人脸相近的背景图像以及皮肤图像（脖子、手臂等）。基于模

板的方法进行精确定位的方法有多种，可以采用基于两梯度图像的模板方法，选

取边缘明显的眼睛、鼻子和嘴巴等局部特征为判别区域，实现排除与定位。也可

以采用与标准人脸模板进行匹配检测的方法，根据人脸各个器官间的几何特征，

首先确定人眼的位置，再根据眉毛、嘴巴等以及它们与人眼的位置关系，将标定

的人脸区域样本进行训练，得到标准的人脸模板。 

2.2.2  基于几何特征的人脸检测方法 

基于人脸的几何特征是指根据人脸面部多个器官的相对位置、器官各自形状

在几何上的关系特征。包括局部的眼睛、鼻子、嘴巴和眉毛等，还有整体的面部
轮廓、纹理等特征[13]。 

（1）基于人脸轮廓特征[14]。人脸轮廓特征检测通常采用边缘检测方法，常见

10 

第二章  相关理论基础 

的图像边缘可以用

、

和

等算子描述。通过边缘检测可以得到众

多圆形的连通区域，对图像拟合椭圆形状，得到人脸区域和部分类似椭圆形状区

域。在椭圆区域类定位眼睛，可以由眼睛的对称性、连通域的面积和形状等几何

特征精确定位眼睛。根据嘴巴和眼睛的几何位置特征，由双眼连线的中点和椭圆

中眼睛下方的连通域定位嘴巴。最终确定人脸位置。 

（2）基于灰度分布特征。人脸面部器官都含有各自的灰度分布特征，利用这
些特征就能建立不同的规律。通过检测图像中是否含有满足这些规律的区域就能

判断图像中是否存在人脸。这类方法的代表就是杨光正的复杂背景中人脸检测的

镶嵌图法[15]。镶嵌图法类对图片的处理类似于马赛克法，是按一定规则降低原始

图像的分辨率。将图像分为 4*4 或 8*8 的正方形细胞单元（cell），称为四分图和
八分图，每个 cell 的灰度由 cell 中全部像素灰度的平均值表示。根据人脸面部灰度
分布特征建立能表示人脸区域的四分图、八分图规律，则根据这些规律，将图片

从低分辨率到高分辨率进行筛选，将满足这些规律的区域判断为人脸区域。 

（3）模板特征检测方法[16]。模板匹配即事先提取需检测物体的特征数据作为
已知模板，再和被检测图像去匹配，根据检测窗口中的特征匹配度判断检测结果。

Yullie 提出可变模板检测方法，该可变模板分为根据人脸形状设定的参数化可变模
板和对应能量函数。能量函数通过人脸图像的灰度信息和轮廓信息等实验得到。

可变模板的优点有模板可变化，对人脸的大小变化、角度偏转等有适应性，但缺

点是检测时需要动态调整可变模板参数和计算对应的能量函数，时间复杂度高。 

2.2.3  基于统计理论的人脸检测方法 

基于统计理论的人脸检测方法不显示地描述和分析人脸局部特征，将人脸作

为一个整体，将检测样本划为人脸图片和其它图片，理论上通过增加样本的数量
和多样性提高检测结果[17]。通常这类方法的检测主要模块如图 2-1 所示。 

应用较多的统计理论人脸检测算法有：基于概率模型的检测方法[18]，基于支

持向量机（

，

）的方法[19]，基于

的方法[20]，

基 于 神 经 网 络（

） 的 检 测 方 法 [21] ， 基 于 隐 马 尔 科 夫

（

）的检测方法[22]。 
其中检测效果较好的是隐马尔科夫和基于纹理特征的检测算法。检测速度较

，

快的是

方法，它的主要思想是在学习阶段，加大分类错误的样本权重，

并在以后的训练中重点学习该类样本，最后通过算法选出效果较好的多个弱分类

器级联成为强分类器。基于统计理论的人脸检测方法是当前的研究热点，被当做

能真正解决复杂人脸检测问题的可行方法。它的主要优势是不需要常规方法中详

11 

CannySobelLaplaceSupport VectorMachineSVMAdaboostNeural NetworkHidden Markov ModelHMMAdaboost 
电子科技大学硕士学位论文 

细的人脸局部特征信息的先验知识，也不需要设置模板参数等。通过提高训练样

本的数量就能增加检测范围，处理复杂背景中的人脸检测，提高检测效果，不过

通常训练阶段耗时较长。统计理论方法也有可改进的地方，需要解决图片质量和

训练耗时的问题。因此，将基于几何特征和统计模型的算法相融合，是以后研究

的新思路。 

图 2-1  统计模型人脸检测方法主要模块 

即使关于人脸检测的算法很多且各有优势，但大部分算法只是针对某一种问

题有较好的结果，而实际中人脸检测问题复杂且广泛，至今仍没有一个效率高、

效果好的通用方法。当前仍然存在的难点有复杂环境且多姿态的人脸检测，不同

光照和有遮挡的情况，还有在检测效率和检测精度上的同时提高，而不是做取舍。 

2.3  人脸特征点提取方法简介 

人脸对齐是在检测到人脸的基础上，再次用多个特征点定位人脸轮廓、眼睛、

鼻子、眉毛和嘴巴等，通过特征点来刻画人脸形状。人脸对齐广泛应用于人脸识

别、人脸检索和人脸姿态表情分析等领域，所以人脸对齐效果直接影响人脸特征

提取及后续研究。当前的人脸对齐方法基本选择点分布模型建立，常见的有 ASM、

AAM 和一系列改进算法。 

2.3.1  点分布模型 

点分布模型[23]（

，

）是一种通过多个特征点标

注目标对象形状的技术，这种技术在非刚性形状对象的特征描述中具有较高的稳

12 

非人脸样本人脸样本图片预处理训练分类器待检测图片多尺度检测分类器输出检测结果训练部分检测部分Point Distribution ModelPDM 
第二章  相关理论基础 

定性和可靠性，广泛应用于图像中目标详细特征的定位。 

以人脸点分布模型为例，在训练阶段，需要收集尽量多的人脸图片样本，包

括各种姿态、表情等。然后手工精确标定所有人脸图片中想要对齐的特征点位置

和特征点数量，形成参考人脸形状。因为收集到的人脸图片大小尺度不一，需要

对样本集进行归一化，避免受到额外因素的干扰。最后通过 PCA 得到点分布模型，
即人脸形状。 

在对目标图像进行预处理时，选择出好的特征点既能良好地描述目标对象，

又能有利于训练和学习阶段的特征提取。通常在选择人脸特征点时，重点标定人

脸中出现边缘轮廓、曲线变化、颜色变化边界等位置，即人脸中各个器官的边缘

轮廓。由全部的特征点可以得到每一个人脸的人脸特征向量

，

标定了 66 个点的人脸形状如图 2-2 所示： 

图 2-2  人脸面部特征形状 

人脸形状对齐的测试过程，就是将一个初始人脸形状 通过平移、旋转、收缩

之后尽可能地接近参考形状 ，可以通过一个简单的对齐误差函数表示如下： 

                          (2-3) 

式(2-3)只能用于人脸对齐的训练部分，因为在检测阶段并没有手工标定的参

考形状 ，无法通过最小化式(2-3)结束检测，因此需要新的误差函数用于人脸对齐

的检测阶段。计算目标人脸形状 ，当前主流的有基于优化算法和基于回归算法。 

2.3.2  基于优化的人脸特征点提取方法 

基于优化的人脸对齐算法是最小化一个与式(2-3)相关的对齐误差函数，通过
改变各种参数，调整人脸形状位置，实现人脸形状的对齐。这些方法都依赖于对

齐误差函数的选择。常见的方法有

[24,25]、

[26,27]。其中，

是通过最

小化特征点周围的局部纹理误差来估算目标人脸形状，而

是在

基础上

结合形状与纹理特征重建整个人脸，通过最小化全局纹理信息误差来计算目标人

脸形状。这些模型仅限于位置、表情和光照条件较好的情况下表现良好，对于部

13 

1,1[,...,,]TnnSxyxySˆS2ˆ||||SSˆSSASMAAMASMAAMASM 
 
电子科技大学硕士学位论文 

分不可见的人脸图片表现不佳。同时，这些方法对初始形状特别敏感，不好的初

始形状将导致局部极值问题。 
（1）主动形状模型 
主动形状模型（

，

）是一种基于统计模型的人脸对

齐算法,它最初由 T．ECoots 等人于 1992 年提出的。该算法定义了一个能量函数作
为其对齐误差函数，通过调整模型参数最小化能量函数，实现人脸形状的对齐[28]。 

（2）主动外观模型 
主动外观模型（

，

）是由

等人在

年

提出，该算法是在

的方法上，增加了对纹理信息的统计建模，再把人脸形状

和纹理两个统计模型综合处理为表观模型[29]。和

有差异的地方是它即处理了

对象的形状信息也处理了对象的纹理信息，将形状与纹理结合起来形成统计表现

模型。与

相比，该算法运算量大，对齐速度慢，但是整体对齐效果优于

算法。 

ASM 和 AAM 算法虽然对齐效果较好，但还存在很多缺点。它们易受强弱光
照、不同表情、面部朝向、局部遮挡等因素的影响，算法对这些因素的鲁棒性不

高；其次，ASM 和 AAM 都使用了 PCA 降维方法形成一个人脸参数形状模型，而
参数模型中小的参数误差并不能代表小的对齐误差，因此很难得到精确定位。 

2.3.3  基于回归的人脸特征点提取方法 

基于回归的人脸对齐算法是训练一个回归函数，给定一幅人脸图像和一个初

始形状，通过回归函数可直接输出人脸形状，这些复杂的回归变量需要从庞大的

训练数据中获取，这种对齐算法在测试阶段中是非常有效的。目前已拥有一些基

于回归理论的人脸对齐算法，例如 Nassem 等[30]提出的一种基于线性回归的人脸对

齐方法，该方法是将人脸图像使用训练中的人脸图像线性表示，通过数据训练计

算回归系数，最终对齐人脸。此外，曹旭东等在 2012 年 CVPR 会议中提出了显式
形状回归人脸对齐方法[31]，该方法很高效地使用式(2-3)作为其误差函数，通过大

量的人脸形状数据训练出一系列回归量，输入检测图片和对应的初始人脸形状，

通过回归量直接输出对齐结果。这种算法在 BioID[32]、LFPW[33]和 LFW87[34]这些

具有挑战性的人脸数据库上得到了惊人的实验结果，具有较高的研究价值。 

（1）线性回归方法 

线性回归方法首先将输入人脸图像进行归类，然后将目标人脸形状用所属类

目的训练样本形状线性表示，最后通过最小二乘法计算线性回归系数，最终得到

14 

Active Shape ModelASMActive Appearance ModelAAMCootes1998ASMASMASMASM第二章  相关理论基础 

目标人脸形状。 

令 表示测试图像中人脸面部形状向量，若 属于第 类，则它可以表示为第

类中所有训练样本面部形状向量 的线性组合，即： 

                      (2-4) 

其中，

为回归系数，由于该方程为一个线性回归问题，可采用最新二乘法

对 进行估算，即： 

                        (2-5) 

估算出 之后，利用 与 对 进行重建得到重建向量 ： 

然后计算 与 之间的距离

： 

             (2-6) 

               (2-7) 

最小的距离

对应的回归系数 即为所求回归系数。即可得到测试图像中人脸

面部形状向量 。 

（2）显式形状回归方法（ESR） 

显式形状先通过训练样本训练 个回归量

。在测试阶段，输入

测试人脸图像并给定初始人脸形状，通过 个回归量计算形状增量，经过 次形状

调整后，得到测试图像中的人脸形状。本文将选择基于显式形状回归的人脸对齐

算法实现疲劳检测，并对其进行多项改进，减小训练得到的模型文件大小，提高

对齐效率和对齐效果，使其能在硬件一般的安卓系统中实现实时检测[35]。 

2.4  本章小结 

本章介绍了疲劳检测系统的几个功能模块涉及到的主要算法和相关理论基

础，包括 PCA 主成分分析、人脸检测方法、常见人脸对齐方法和人脸特征点提取

方法。简单阐述了各种算法的思想，对比相关算法的优劣，为实现疲劳检测系统

选择出较好的技术方案。

15 

yyiiiX,1,2,...,iiyXik1iniRi1ˆ()TTiiiiXXXyˆiiXˆiyˆiy1ˆˆ(),1,2,...,TTiiiiiiiyXXXXXyikˆiyy()idy2ˆ()||||,1,2,...,iidyyyikˆ()dyˆyT1(,...,,...,)tTRRRTT 
电子科技大学硕士学位论文 

第三章  基于安卓的疲劳检测系统的架构设计 

3.1  概述 

疲劳检测相关的研究经过几十年的发展，近几年有了极大地进步，科研人员

推出一些可以商用的研究成果。比如以注重安全著称的沃尔沃公司，通过不断改

进其驾驶辅助系统，加入了驾驶员疲劳检测单元，该系统通过监测车辆行驶轨迹，

道路延伸方向以及方向盘转动规律判断驾驶员是否出现疲劳或注意力分散，最后

通过座椅振动，主动减速等方式提示驾驶员安全驾驶。一种头戴式疲劳检测产品，

如图 3-1(a)，通过检测脑电波信号以及驾驶员头部姿态变化等信息综合判断驾驶员
疲劳状态。还有一种耳戴式疲劳检测产品，如图 3-1(b)，采用非常简单的水平仪原
理，通过要求驾驶员始终保持头比较正的姿态来预防疲劳。后两种产品由于采用

接触式检测或预防，对驾驶员有入侵性，且要求驾驶员长期保持同一个姿态，使

产品体验度很差，不利于推广。近几年由于计算机视觉领域的快速发展，基于视

觉的驾驶员疲劳检测研究也成为热点，该方法由于非接触式，设备简单便携，对

驾驶员无干扰等优点，有非常好的产品推广前景，但是目前还没有出现非常成熟，

可以商用的该类产品。 

(a)  头戴式产品                                                            (b)  耳戴式产品 

图 3-1  部分疲劳检测产品演示 

因此，本文从便于产品化的理念出发，设计了一个基于安卓系统的实时疲劳

检测系统实现方案。整个系统分为两个部分：车载检测终端和后台监测服务器。

其中车载检测终端采用能运行安卓系统且接入有摄像头的平板或手机等设备，主

16 

     
 
第三章  基于安卓的疲劳检测系统的架构设计 

要实现摄像头采集视频图像，终端设备进行图像预处理，实时疲劳检测，疲劳预

警以及存储并发送驾驶员疲劳状态图片到后台服务器的功能。后台监测服务器主

要包括实时接收、显示并保存驾驶员疲劳状态图片，提供历史记录查询等功能。 

3.2  系统架构设计方案 

3.2.1  疲劳检测系统整体架构图 

本文设计的基于安卓的疲劳驾驶检测系统整体架构主要包括驾驶员交互、实

时疲劳检测模块和管理员后台监测系统三大部分。主要用户包括被检测的驾驶员

和随时可以查看检测结果和记录的管理人员，主要设备包括摄像头，运行安卓系

统的移动设备以及后台服务器。疲劳检测系统实现的整体拓扑结构图如图 3-2 所
示，疲劳检测系统的整体架构图如图 3-3 所示： 

图 3-2  疲劳检测系统整体拓扑结构图 

3.2.2  疲劳检测安卓端系统设计 

疲劳检测终端系统主要包括驾驶员交互、视频采集模块和疲劳检测模块三部

分。主要设备包括红外摄像头，运行安卓系统的硬件设备（集成存储设备、4G 网
络模块和外放声音模块）。功能上实现驾驶员图像的实时采集、图像预处理、人脸

检测、疲劳状态检测、疲劳图片本地保存、疲劳图片网络发送以及疲劳状态报警。 
驾驶员交互部分包括驾驶员打开并登陆疲劳检测系统，调整摄像头以及检测

到疲劳时对驾驶员的警报提示。为了防止光照的影响以及驾驶员戴墨镜等影响，

本系统在夜间可以选择红外摄像头进行视频图像的采集，以保证驾驶员人脸图像

的质量。当驾驶员打开疲劳检测系统后，需要根据摄像头拍摄的图像适当调整摄

像头位置，以保证摄像头准确地拍摄到驾驶员的头部等区域。疲劳警报功能主要

是当系统检测到驾驶员出现疲劳特征后，会在屏幕上显示文字并发出声音等警报

17 

 
 
电子科技大学硕士学位论文 

信息提示驾驶员注意安全行驶，当检测到驾驶员状态恢复正常后，警报解除，该

过程中短时间暂停疲劳检测，预留时间和处理器资源给图片压缩和网络发送模块。 

图 3-3  疲劳检测系统的整体架构图 

视频图像采集模块主要通过安卓系统实时采集原始视频，因为驾驶员佩戴墨

镜以及车辆行驶环境经常存在光照变化大的情况，平板电脑外接的摄像头尽量选

择红外摄像头，可以减少这类因素的干扰。采集图像时，安卓系统设置拍摄图像

的初始大小，将原始的 YUV 格式图像压缩并转换为 bitmap 格式的图片，并进行
灰度化处理。在图片格式转换时，需要替换掉安卓自带的转换格式，提高图片转

换的速度和质量。该过程通过图像格式转化，大小压缩，灰度化，减小了需要处

理的图片信息，大大提高了后续的人脸检测以及人脸对齐部分的处理速度。 

疲劳检测模块。该部分包括人脸检测、分步的人脸对齐、各疲劳特征分析及

综合判断、疲劳报警以及当前疲劳状态图片网络发送等。 

人脸检测，由于安卓自带的人脸检测函数耗时长且检测效果不佳，采用在程

序中加载 OpenCV-2.4.9 安卓版 sdk，调用 OpenCV 人脸检测函数，函数返回一个
包含人脸的矩形区域。 

分步对齐人脸形状中，第一步先精确对齐人眼，所以需要将函数返回的人脸

矩形框坐标结果按一定的参数比例转换粗略得到双眼瞳孔的坐标位置，结果作为

人眼对齐部分的输入参数。若检测不到人脸，程序返回处理下一帧图片。若在设

定的时间内均检测不到人脸，则判定为驾驶员离岗，发出警报。通过双眼瞳孔的

坐标位置扩展并截取出一个尺寸合适的人眼区域图片，仅对截取的图片进行赋初

始人眼形状和人眼对齐，减少图片信息，提高了对齐速度，并根据精确的人眼对

18 

驾驶员交互调整摄像头接收警报驾驶员登陆疲劳检测实时录像后台检测服务器系统图片管理用户管理管理员登陆疲劳检测疲劳报警发送图片 
第三章  基于安卓的疲劳检测系统的架构设计 

齐结果分析眼睛的睁闭状态。 

第二步人脸轮廓对齐，将人眼对齐结果得到精确的双眼瞳孔坐标位置作为人

脸轮廓对齐部分的输入参数，改进赋值的初始人脸轮廓形状，使人脸轮廓对齐过

程更快更准确。根据对齐结果分析驾驶员嘴巴张合程度、面部的偏转方向以及头

部位置变化特征。综合以上检测到的驾驶员头部特征，分析驾驶员精神状态，若

判定驾驶员出现疲劳，则发出文字和声音疲劳警报信息。最后，压缩当前驾驶员

疲劳时的图片，保存在移动端内存设备并通过移动网络上传到后台监测服务器。

疲劳检测流程图如图 3-4 所示： 

图 3-4  疲劳检测流程图 

3.2.3  后台监测服务器系统设计 

后台监测服务器系统主要包括管理员和普通用户登陆，接收、实时显示和保

19 

输入视频人脸检测判断眼睛睁闭状态保存、发送图片输出报警信息精确眼睛对齐简化后的人脸轮廓对齐判断辅助特征状态登陆系统退出系统疲劳判断是初始化眼睛形状初始化人脸形状 
 
电子科技大学硕士学位论文 

存移动终端发送的驾驶员疲劳图片，以及查看历史图片等功能。硬件设备包括计

算机，web 服务器，存储设备等。管理人员可以在任意可以连接网络的计算机上打
开后台监测服务系统网站并用账号和密码登陆，登陆系统后分管理员和普通用户

有不同权限，普通用户主要有实时显示当前疲劳图片，查看、删除历史疲劳图片

等权限，管理员还可以实现对用户账号的管理。后台监测服务器系统功能模块结

构图如图 3-5 所示。 

首页管理模块：包括网页展示，登陆系统和退出系统的功能。网页展示用于

显示系统的一些相关的基本信息，比如当前登录的用户、网站技术和框架模型、

运行环境、数据库版本以及服务器 IP 地址等。登陆系统包括向用户显示登录页面，
提供账号、密码以及验证码输入功能，并对输入信息（账号、密码、验证码）进

行验证。退出系统模块用于用户退出系统，注销会话信息。 

系统设置模块：包括基本设置和友情链接两个子模块。基本设置模块用于显

示网站相关的一些基本信息，如网站名称、网址地址、网站简介、站长邮箱等等，

基本设置模块还提供修改当前已登录用户的用户名和密码功能。友情链接模块用

于往系统中添加其他网站的相关信息，如网站名称、网站 URL、网站描述，友情
链接模块还提供修改链接信息及删除链接的功能。 

图 3-5  网站后台检测服务器系统功能模块结构图 

管理中心模块：包括添加管理员模块和管理管理员模块。添加管理员模块用

于往系统中添加新管理员账户；管理管理员模块用户对已存在的管理员账户信息

进行维护或删除管理员。 

数据中心模块：包括用户管理和图片管理两个子模块。用户管理模块用于对

本系统的相关普通用户进行信息的维护，可以修改用户的信息，或删除用户，还

可以添加新的普通用户；图片管理模块用于对接收到来自终端的疲劳驾驶图片进

行管理，可以逐张图片进行大图阅览和删除等管理，也可以批量对同一个用户的

所有存储的图片进行查找和删除操作。同时，该子模块还能对终端传送过来的疲

20 

· 首页展示· 登陆系统· 退出系统数据中心模块管理中心模块系统设置模块首页管理模块· 添加用户· 管理用户· 添加图片· 管理图片· 批量管理· 实时显示· 添加管理员· 管理管理员· 基本设置· 更改密码· 添加链接· 链接管理 
第三章  基于安卓的疲劳检测系统的架构设计 

劳驾驶图片进行实时显示，当接收到新的图片时刷新实时显示页面。 

3.3  本章小结 

本章首先介绍了目前市场上应用的疲劳检测产品，对比并说明了它们的优缺

点，说明了本系统用于疲劳检测的优势以及产品化的可行性。再详细介绍了基于

安卓的疲劳检测系统的架构设计方案。给出了系统整体架构设计图以及应用场景

拓扑图。最后详细介绍疲劳检测终端和后台监测服务器系统端，描述了各功能模

块的详细设计和需要实现的功能。

21 

 
电子科技大学硕士学位论文 

第四章  改进的人脸对齐方法 

传统的基于模式识别的疲劳检测方法多是采用人脸检测、人眼定位与跟踪、

嘴巴定位与跟踪、眼睛疲劳状态分析以及嘴巴状态分析等步骤[36]，每个步骤选用

不同的算法实现。传统方法使整个疲劳检测过程算法复杂度高，计算量大，基本

只能在计算机上模拟实现疲劳检测，不利于移植到性能一般的安卓设备上。 

本文创新性地采用人脸对齐方法实现驾驶员疲劳检测，该方法能一步定位出

人脸的眼睛、嘴巴、鼻子以及人脸轮廓等特征，大大减小系统整体计算复杂度。

在 众 多 传 统 和 改 进 的 人 脸 对 齐 算 法 中 ， 由 微 软 亚 洲 研 究 院 的 曹 旭 东 等 人 在

IEEE
Regression，
齐方法，

上提出的显式形状回归算法（

），取得了非常不错的效果且检测速度快。虽然相较传统人脸对

方法在效率和精度方面都有了较大提高，但最终检测容易受到噪音

的影响，使对齐效果不理想，并且对于中低性能的安卓设备，形状回归量依然太

大，难以实现实时检测。 

4.1  显式形状回归人脸对齐算法 

如前文所述，基于级联回归这一类的算法没有采用传统的参数模型、主动外

观模型，而是采用回归量来控制人脸形状约束，使得具有良好的对齐速度和对齐

精度而受到众多研究者的重视。其中曹旭东等提出的显式形状回归算法最具代表

性，该算法的主要思想是训练阶段由最小化人脸对齐误差函数学习得到一系列人

脸形状回归量，检测时使人脸初始形状受该回归量限制，并通过级联回归逐步收

敛，得到可以由标准人脸线性回归表示的对齐人脸形状。 

4.1.1  训练样本 

因为采集到的人脸训练样本中图片大小、人脸位置、人脸大小差异，需要在

创建点分布模型之前对人脸训练样本进行归一化处理。该过程可以减少不同样本

图片中人脸的位置不同，角度变化等非人脸形状因素的干扰，使训练样本间的点

分布更具有相关性，点分布模型更加准确。 

人脸对齐训练样本通常选择

[37]分析方法，需要对所有人脸训练样本

做缩放、平移以及旋转操作，使每一个训练样本都能对齐到相同的点分布模型上，

解决了原始样本数据混乱无序的状态，消除部分外界因素造成的非形状干扰。下

面用形状 对齐形状 的过程讲述

方法的样本对齐（假设只完成两个人

22 

CVPR2012Face Alignment by Explicit ShapeESRESRProcrustes2S1SProcrustes 
第四章  改进的人脸对齐方法 

脸形状的对齐过程）。在此需要人脸形状变换过程中用到的三个参数，形状的旋转

角度 、缩放的尺度 以及平移的大小 ，即人脸形状 通过旋转、缩放和平移变

换最终使对齐 的误差 最小，公式如(4-1)所示： 

                    (4-1) 

式中

为人脸形状 完成一次角度为 的旋转和尺度 的缩放操作， 是平移

向量， 是对角矩阵，公式如(4-2)、(4-3)、(4-4)所示： 

       (4-2) 

                                       (4-3) 

                                              (4-4) 

对公式中变量 ， ， ， 求偏微分 ， ,

, ，并令各偏微分方程等于

零，联立以上方程可求得人脸形状变换参数： 

                                                  (4-5) 

                          (4-6) 

                            (4-7) 

                            (4-8) 

式中：                         

                            (4-9) 

                     (4-10) 

先将训练集中的所有样本形状对齐参考人脸，然后计算平均人脸，将平均人

脸对齐参考人脸，再将所有的训练样本形状对齐平均人脸，再计算平均人脸，如

此循环，直到前后平均人脸形状误差小于设定的阈值为止。训练样本算法流程如

图 4-1 所示： 

23 

st2S1SE1212E[(,)][(,)]TSMsStWSMsSt(,)Ms2SstW222222cossin(,)sincoskkkkkkxxxssabMsyyyssba(,,,,...,,)Txyxyxyttttttt01NkiiWvsxtytEEsExtEyt22sab1tan(/)ba1ixxtn1iyytn1222||SSaS212122||iiiixyyxbnS 
电子科技大学硕士学位论文 

图 4-1  训练样本对齐流程 

训练完成后得到了每个训练样本对齐后的人脸形状 和一个平均人脸形状 。 

4.1.2  显示形状回归模型 

基于形状回归的人脸对齐算法是训练一个回归函数，一般有两种常用的回归

框架，分别为一级形状回归和二级形状回归。 

在一级形状回归中，给出一幅人脸图像 和一个初始化的人脸形状 ,经过不
停迭代，使前后两次人脸形状误差增量小于预设阀值，最终完成目标人脸形状对

齐。训练时，由样本数据产生 个弱回归

，每次迭代通过人脸图片

和当前形状计算形状增量 来更新人脸形状，最后训练得到人脸形状 。如公式

(4-11)，一级形状回归迭代过程如图 4-2 所示： 

                 (4-11) 

图 4-2  一级形状回归迭代过程 

采用一级回归算法得到的回归量非常弱。在训练过程中，收敛速度非常慢，

最终的检测对齐效果也较差。 

24 

样本对齐开始调整样本原点到中心坐标所有形状对齐第一个形状计算平均形状平均标准化所有形状对齐平均形状是否收敛样本对齐结束否是ˆSSI0ST1(,...,,...,)tTRRRSTStt-1t-1(,),1,...,tSSRIStT 
 
第四章  改进的人脸对齐方法 

显式形状回归采用二级形状回归。相对一级形状回归提高了收敛效率，极大

提升了人脸对齐的速度和精度。 

二级形状回归将回归量 进行分解成 个弱回归量

，其中

个弱回归量的训练过程和一级回归训练过程相似，但训练 过程中图片的形状特

征索引不变，这即加快了训练过程也保证了弱回归量的稳定性，减少了资源开销。

改变后的公式如下： 

              (4-12) 

式中:                  

            (4-13) 

通过 个弱回归量计算出一个强回归量 ，更新人脸形状，进行下一次迭代。

二级回归迭代过程如图 4-3 所示： 

图 4-3  二级形状回归迭代过程 

二级回归中采用

分类器[38]计算 个弱回归量

。每个

由 个特征组成

，每个特征 为一个 0，1 变量，因此

总共有

种情况，分别计算每个训练的样本

值，即可将特征空间（训练样本）分成

个特征子空间，通过最小化对齐误差，可计算出每个子空间 中训练样本 的形

状增量，公式为： 

                  (4-14) 

其中 为上一阶段的迭代形状。式(4-14)的解为子空间 中训练样本的平均形状误
差，且引进一个收缩参数 [39]，避免每组的训练样本不足而造成平均形状误差过

大，当子空间 中训练样本量够大时， 参数可忽略。平均形状误差为： 

                  (4-15) 

25 

tRK1(,...,,...,)kKrrrKtrt11'11(,)(,)KttkkiiiiikRISSrIS111ˆargmin||-(S(,S))||NkkkiiiirirSrIKtRfernsK1(,...,,...,)kKrrrfernsF1(,...,,...,)iFfffifferns2Fferns2Fbbˆargmin||-()||bbiiSiSSSSiSbbˆ()11/||||biiibbbSSS 
 
电子科技大学硕士学位论文 

通过大量数据训练，明确最小化形状对齐误差函数，保留每一次迭代中每组

的平均形状增量，最终形成一个巨大的形状调整变量。在测试阶段，每次更新的

形状为一个形状增量，而这个形状增量是训练样本真实形状 的线性组合。因此，

很容易看出最终得到的目标人脸形状为初始形状 和训练样本真实形状 的线

性组合： 

                        (4-16) 

在测试阶段，每输入一个人脸图像，给定一个初始化人脸形状，只要这个初

始化人脸形状 满足形状约束，通过联级迭代，就能得到对齐精度高的目标人脸

形状。因为所有的训练样本形状构成了一个形状子空间，对于训练样本形状的线

性组合必然满足人脸形状约束的。人脸对齐检测流程图如下： 

图 4-4  人脸对齐检测流程图 

4.1.3  人脸特征提取与选择 

ASM 和 AAM 算法中采用人脸纹理统计信息。该特征提取较复杂，需要消耗
大量的时间和资源，难以实现实时对齐。显式形状回归则采用简单的像素差值来

提取人脸特征，只要提取大量的像素差值特征，就能够充分表达人脸信息。该特

26 

ˆ{}iS0Sˆ{}iS01ˆNiiiSSwS0S测试人脸图片根据训练所得回归量计算当前特征点位置和阀值，计算fern通过fern将样本分类，得到该类平均形状增量更新当前形状完成K次迭代完成T次迭代是否否是对齐开始输出对齐结果对齐结束 
第四章  改进的人脸对齐方法 

征计算量小、复杂度低，是提取人脸特征非常好的选择。既能提高对齐效率也能

完成更好的人脸形状调整。 

为了方便计算像素差值，建立一个形状特征索引来存储需要的像素坐标和对

应的像素值。传统方法一般采用全局坐标

来提取像素值，但由于人脸形状的

复杂性和非刚性的人脸，全局坐标不能很好地表达人脸特征。人脸的显著特征有

眼睛、眉毛、鼻子和嘴巴等，所以这些显著特征区域为局部坐标

，作为提

取特征点的索引坐标更准确，如图 4-5 所示： 

图 4-5  全局坐标和局部坐标特征索引对比图 

由图 4-5 可以看出，局部坐标中的特征点索引能更好地表达人脸的显著特征。
中不同的人脸采用相同的坐标位置，提取的人脸特征差异可能

因为全局坐标

会较大，而局部坐标

中同一个特征索引，即使不同人脸也能提取到相同的

人脸特征。 

在一级回归中的每个回归量 ，在人脸区域随机选择 个像素点及其像素点

坐标做像素差计算，则可以提取到 个特征。由于提取到的像素差特征太多，并

且很多特征是冗余和无用的，需要有好的特征选择方法来筛选出有效的特征。 

显式形状回归算法中采用相关性特征选择方法。该方法采用随机生成多个

并形成一个 池，再找出其中一个 使回归误差最小作为人脸特征。有效的

至少具有两个特点：（1） 中的每个特征和目标回归之间需要高度的相关性。
（2）每个特征相互之间的相关性不高。相关性特征选择方法能很好满足以上两点
要求。 

在二级回归中，通过相关特征选择从 个像素差分特征选择出 个特征，由

设置的阈值将这 个特征转换成一个 fern，则每个样本计算出了一个对应的
值。姿态、表情和方向信息各异的人脸形状会有各异的人脸特征，我们通过 fern
分类器将所有的训练样本分成了 个类别，通过式(4-15)计算每类的平均样本形状
增量，并将其保存。通过二级回归和一级回归，我们将得到每次迭代中每类的平

均形状增量，最终形成了一个强大的回归量

。 

27 

(,)xy(,)xy(,)xy(,)xytRP2Pfernfernfernfernfern2PFFfern2F1(,...,,...,)tTRRR 
 
电子科技大学硕士学位论文 

4.2  改进的显式形状回归算法 

虽然显式形状回归算法的人脸对齐已经有不错的对齐速度和精度，但是对齐

容易受到图像噪音的影响，使对齐效果不理想，并且训练产生的形状回归量太大，
空间复杂度较高，难以移植到性能一般的安卓移动设备上。虽然 Troop[40]在之后研
究中提出了稀疏压缩算法尝试解决以上不足，但是增加了算法运算复杂度，反而

使效率降低，而且压缩率并未显著提高，依然不能解决本系统所面临的问题。 

针对以上问题，本文通过实验对显式形状回归算法进行了改进，提出了一种

时间和空间复杂度低、对齐精度高的人脸对齐算法——基于形状参数回归的人脸

对齐算法[41]（

，SPR）。该算法采用一系列低维的人脸
形状参数替代显式形状回归中的高维人脸形状，在二级级联回归中，使用人脸形

状参数进行形状的迭代，并在第一层回归中，结合人脸角度变化和图片尺度因素

改进了特征索引方法，使提取到的人脸特征更加准确，更具可比性。在第二层回

归中，选用了多重特征选择方法，减少了人脸对齐的训练时间。基于形状参数回

归的人脸对齐算法训练阶段和测试阶段的总体框架如图 4-6 所示： 

图 4-6  形状参数回归算法框架 

28 

Shape Parameter Regression 
第四章  改进的人脸对齐方法 

由图 4-6 可知，在人脸对齐训练中，利用人脸形状空间方法，将所有人脸形状
转换为低维的人脸形状参数。根据输入的样本图片、初始形状参数和标准形状参

数，在二级级联回归的框架下，仅计算低维的人脸形状参数增量，调整样本的人

脸形状，得到回归量

，并作为检测阶段的输入模型文件。 

在人脸对齐时，先为人脸赋值一个初始人脸形状，并通过人脸形状空间方法

将其转换为初始人脸形状参数。再通过训练阶段得到的模型文件进行参数迭代更

新，最后得到人脸对齐结果。 

4.2.1  人脸形状空间 

在人脸形状迭代对齐的阶段，需要使人脸形状在可控范围内变化，即对形状

增量进行约束。现在主流的约束方法有两种，一种是根据已有的样本人脸形状空

间进行控制，也就是本文选择的方法，另一种是依靠训练样本形状的线性表达来

进行控制。 

人脸对齐中一般采用 个特征点来描述人脸形状，每个特征点由坐标

表

示，从而得到的 维人脸形状特征点向量维数很高。这种高维的人脸形状数据使

显式形状回归中训练所得的回归量数据文件比较大，存在很大的数据冗余。但这

个人脸形状特征点彼此间具有很强的相关性，各点之间的位置保持着一定的关系，

所以可以采用 PCA（
提取出人脸形状的主成分，而不会损失太多数据信息。将样本集里面全部的标准

）方法，对人脸形状进行降维，

人脸形状做降维处理，于是任意一个人脸形状可以看做是主成分向量空间的一个

坐标点，而该坐标的原点就是训练样本集中所有人脸形状的平均人脸形状，任意

人脸形状可以看做坐标原点加上一个向量。通过 PCA 得到人脸形状特征向量和人
脸形状特征值，由它们组成了一个人脸形状空间。所以，在人脸形状空间中可以

通过公式(4-17)得到人脸形。 

                                                          (4-17) 

当我们得到人脸形状后，可通过公式(4-18)计算出对应的人脸形状参数： 

                                                      (4-18) 

其中， 是训练样本集中所有人脸形状的平均人脸形状。 是包含了前 t 个主成分
的协方差矩阵。 是人脸形状参数，是一个 维的向量。人脸形状参数是有一定的

变化范围的，如果参数变化太大，会导致形状的变化范围超出人脸的范围。由公

式(4-17)可知，人脸形状可以通过输入低维形状参数得到，并且不同的人脸形状由
不同的形状参数生成，所以有足够多的人脸形状训练样本，就能形成一个良好的

29 

1(,...,,...,)tTRRRn(,)xy2nnPrincipal Component AnalysisSSP()TPSSSPt 
电子科技大学硕士学位论文 

人脸形状空间。在级联回归算法中采用人脸形状空间，不仅能有效地约束人脸形

状变化范围，而且大大降低了数据冗余，减少数据处理量。图 4-7 展示了部分不同
参数的人脸形状。 

图 4-7  不同参数的人脸形状 

4.2.2  二级级联形状参数回归 

改进的显式形状回归算法是将人脸形状迭代对象转换为了低维的人脸形状参

数，在二级级联形状参数回归框架中，不停地更新迭代人脸形状参数，输出最优

的人脸形状参数，最终根据人脸形状空间将最优人脸形状参数转换为人脸形状。

人脸形状参数的迭代过程如下式所示：   

                                            (4-19) 

式中 是迭代第 次的人脸形状参数，

为一个形状回归量选择器，

需要通过大量的训练样本训练得到。 

首先，收集、处理得到训练样本集

，每个训练样本包括人脸图片和标

注精确的人脸形状，通过预处理将训练样本集进行归一化操作。为了增加样本有

效性，计算样本集的平均人脸形状，将平均人脸形状通过大小收缩、角度旋转和

位置平移变换得到多个初始人脸形状，并给每一个训练样本都赋值多个初始人脸

形状。如图 4-8 所示： 

图 4-8  多个初始人脸形状 

30 

11(,)ttttRISPtt1(,)ttRISP1ˆ{,}NiiiIS 
 
第四章  改进的人脸对齐方法 

在形状参数回归量 的计算中，通过当前人脸形状获取人脸特征，并计算出

参数回归量 ，使所有的样本对齐误差最小，即： 

                          (4-20) 

式中， 是第个 样本的实际人脸形状参数， 是第 个样本的第 次人脸形状

参数。每一个训练样本都根据公式(4-20)反复更新迭代人脸形状参数，最终使每个
样本的形状参数和实际的人脸形状参数误差最小。整个过程中记录下每次迭代的

人脸形状参数回归量。 

训练出好的回归量决定了人脸对齐的准确率，本文通过改进二级形状回归算

法，设计了二级级联形状参数回归方法，将迭代过程分解为两个层次，第一层为

特征的提取，而第二层为回归量的计算。在第二层中将参数回归量 分解成了 个

弱参数回归量 ，将参数回归量 的计算转换成 个弱参数回归量 的计算。在回

归量计算中，采用多重特征选择方法从第一层得到的训练样本特征池中选择出

个特征作为当前迭代特征。这些特征都是弱特征，对应的回归量为弱回归量，经

过 次迭代后得到了一个强特征，而这些强特征增强了人脸形状参数回归量 的

有效性。二级级联形状参数回归迭代过程如图 4-9 所示： 

图 4-9  二级人脸形状参数回归过程 

在二级级联回归的第一层中，设计了一个明确形状特征索引方法，通过该方

法定位人脸的特征，形成一个样本特征池。在二级级联回归的第二层中，我们使

用多重特征选择方法在第一层中的样本特征池中选出 个与此次迭代较相关的特

征，根据这 个特征，计算出每个特征的阈值，并将每个特征转换为 01 特征，在
根据 01 特征对所有样本进行分类，并计算每类的形状增量 。对于形状增量的
计算，主要依据类中样本形状收敛最快的原则。有优化理论知识得到，该问题为

一个优化问题，可以表示为： 

31 

tRtR11111argmin||((,))||ˆNtttiiiRittiiiRPRISPˆii1tii1ttRKrtRKrFKtRFFf 
 
电子科技大学硕士学位论文 

                                            (4-21) 

式中 为类中第 个样本的人脸形状参数增量。由优化理论知识可以得到 类中

全部样本的形状参数增量的平均值就是它的最优值，即： 

                                                  (4-22) 

对全部的样本进行分类，每个样本最终对齐的人脸形状表示为： 

                                            (4-23) 

通过式(4-23)能看出，该算法通过样本形状参数的线性表示方式很好地约束了
人脸变化范围，不需要另加约束条件就很好地控制了参数的变化范围，避免了整

个人脸形状的变化超出人脸的范围。 

4.2.3  改进形状特征索引 

在人脸形状不断调整对齐过程中，需要提取良好的人脸特征，获得人脸面部

信息。常见的

[42]、

[43]、

[44]等特征提取方法都需要通过大量的运算

过程，且特征表达复杂，难以用于实时的人脸对齐算法。显式形状回归算法中采

用简单的像素差值作为人脸面部特征，即选取人脸区域的两个坐标点，并做差得

到人脸特征，这种特征提取方法计算量小，易于获取，能大大提高人脸对齐算法

的效率。如图 4-10 所示： 

图 4-10  像素差提取人脸特征 

本文采用和显式形状回归人脸对齐算法相同的人脸特征，通过随机在人脸面部

区域产生若干个坐标点并提取像素特征。因为人脸面部区域的像素特征之间有很

强的相关性，所以在选择像素特征时，可以仅仅选取部分人脸面部像素特征，这

32 

argmin||-||bfiiiib/||bfibi*0()11TKfkiiitkSSPLBPHOGSIFT 
第四章  改进的人脸对齐方法 

不仅能够减少特征冗余，而且能够提高运算效率。通过在人脸区域内随机产生 个

不同的具体坐标点，作为像素特征的索引。将其记为

。 

因为不同图片中人脸角度、尺度大小等不同，如果直接将随机产生的坐标点映

射到人脸图片上，提取像素值特征，这会使不同人脸图片之间提取的特征缺乏可

比性，从而产生很大的误差。因此在提取人脸特征时，通常是根据坐标在面部器

官中的相对位置来提取，使其更具有可比性，也更能够体现出人脸之间的差异。 
在显式形状回归人脸对齐算法中，采用了形状特征索引，选择平均人脸形状为

基准，计算每个随机产生的坐标与人脸形状中所有特征点坐标之间的距离，选择

出 距 离 坐 标 最 小 的 形 状 特 征 点 编 号 ， 并 记 录 相 应 的 坐 标 偏 移 量 ， 即 得 到 了

。然后根据样本当前的形状还原 个坐标的真实坐标。但这种

方法仅在人脸图片具有相同的角度和尺寸的条件下才能取得良好的结果，而收集

到的人脸样本图片往往具有不同的旋转角度和大小尺度，所以采用该方法提取到

的人脸特征不能达到预期的效果，同样缺乏可比性。如图 4-11(a)所示： 

    (a)  形状特征索引                    (b)  改进的形状特征索引 

图 4-11  特征索引对比 

针对不同人脸的旋转角度和大小尺度问题，本文提出一种改进的形状特征索

引方法。同样通过随机产生的坐标

，并选择与平均人脸形状所有特征点中距

离最小的特征点，将

转换为以该特征点为坐标原点的坐标系中的局部坐标，

并记该特征点坐标索引为 。再根据平均人脸形状中眼睛瞳孔的特征点坐标，建

立参考形状特征索引，表示为

。最后根据当前的

人脸形状，并参双眼瞳孔特征点的坐标还原需要提取的特征的实际坐标。坐标还

原公式如(4-24)所示： 

                        (4-24) 

33 

P1{(,)}Piiixy1{,(,)}PiiiindexxyP(,)iixy(,)iixyi****1{{,,},(,),(,)}Piiiixylxlyrxry****22**2**2+()()()()iiiiiiiiiiiiiixrxlxxlxrxScyrylyylyryrxlxrylycrxlxryly 
 
电子科技大学硕士学位论文 

式中，

表示获取人脸形状 中 的坐标索引。

表示人脸的左眼坐标，

表示人脸的右眼坐标。

表示平均人脸形状中左眼瞳孔的坐标，

表示平均人脸形状中右眼瞳孔的坐标。 作为人脸形状尺寸大小变化的参

考控制量。采用改进的形状特征索引方法后，定位的效果更好，如图 4-11(b)所示。 

4.2.4  多重随机特征选择 

在二级人脸参数形状回归的第一层，提取人脸特征时，我们在图像人脸区域

内随机选取 个像素点，并记录其像素位置，这 个像素可产生 个像素差特征，

生成特征池。在第二层回归中，需要该特征池里的特征作为当前回归量计算的输

入。但由于像素差特征过多，导致计算量过大，为了提高计算速度，只需要在特

征池中选择出若干有效的特征。选择出好的特征往往会使得回归量的计算更加准

确，同时能够提高对齐速度。 

从大量的特征中选择出有效的特征，显式形状回归算法采用了相关性特征选

择方法，这种方法随机产生一个方向，利用特征之间的相关性，选择出若干特征。

但该方法运算复杂，需要消耗大量的计算时间。而且常常选择出来的特征也并非

最有效的。 

本文在特征选择时采用多重随机特征选择方法，在多次随机特征选择操作中，

筛选出最优的一次作为当前的特征。该方法计算量小，提高了对齐速度，并能筛

选出良好的人脸特征，保证了人脸形状的收敛。同时，该类方法可以采用分布式

计算方式，提高计算速度。 

多重随机特征选择方法首先从特征池中任选出 对特征坐标，并根据公式

(4-24)和当前人脸形状还原选择特征坐标的真实坐标，获取对应的像素值特征，记
。通过对每对像素特征作差，得到一个像素差特征，然后将所有样本
为

的平均像素差值作为特征阈值，建立如图 4-12 所示的特征回归树。 

0 

1 

0 

1 

1 

0 

1 

… … … 

图 4-12  特征回归树 

在回归树中，将大于特征阀值的像素差值置为 1，否则置为 0，表达式如(4-25)

所示： 

34 

iiSiSi(,)iilxly(,)iirxry**(,)lxly**(,)rxryicPP2PF121{,}Fiiiaa[00000][00001][00010][00011][][11111]                   
第四章  改进的人脸对齐方法 

                                      (4-25) 

经 过 回 归 树 变 换 后 ， 将 所 有 样 本 特 征 向 量 转 换 成 了 二 进 制 特 征 向 量

，  依据这些向量，把所有样本划分成了 个类别，再根据公式(4-22)
计算出每个类别的人脸形状参数增量。最后，计算所有样本的收敛速度。样本收

敛速度定义如公式(4-26)所示： 

                                          (4-26) 

式中， 是样本 的真实形状参数， 是样本 的第 次形状参数， 为总的样本

数量。重复以上步骤，将样本的收敛速度最快的一个选择为该次迭代特征的选择

结果。具体的步骤如下： 

（1）任选出 对特征坐标，获取像素差特征，计算特征阈值。 
（2）回归树变换，划分样本类别，算出每类的参数变化量
（3）计算收敛速度 。 
（4）当收敛速度优于最快收敛速度，则更新最优选择结果和最快收敛速度。 
（5）转回步骤（1），迭代 n 次停止。 
多重随机特征选择方法能有效提高人脸对齐的训练速度，并能选择出较好的

。 

样本特征，能更方便于移植到性能一般的安卓设备上。 

4.3  实验结果分析 

为了验证改进后的形状参数回归算法更具优越性，更易于在普通安卓设备上
实现实时检测，本文将约束局部模型[45]（KDE）、显式形状回归算法（ESR）和改
进后的二级形状参数回归算法（SPR）在人脸数据库 LFPW[46]和 HELEN[47]中进行
测试对比。对比 3 种人脸对齐算法的训练所得模型文件大小、对齐速度和对齐精
度，并得到 3 种人脸对齐算法在相同人脸上对齐结果的对比图。最后给出形状参
数回归算法在不同光照、表情、朝向和有遮挡的场景中的对齐效果图，综合说明

SPR 算法的优越性和可用性。 

4.3.1  人脸数据库介绍和实验参数设置 

本文选择的 LFPW 和 HELEN 两个人脸数据库几乎囊括了所有场景中的人脸
图片，包括不同光照、姿态各异、表情丰富和局部遮挡等复杂场景中的人脸图片，

如图 4-13 所示。LFPW 数据库中包括 989 张人脸图片，实验中随机选择 550 张图
作为训练样本集，剩下 239 张作为测试样本集。包含 2330 张图片的 HELEN 数据

35 

211()0iiiaathreadfother12,,,Ffff2F11ˆ1||-||MNiiiˆiiiiiMNFf 
电子科技大学硕士学位论文 

库人脸图片则更加丰富，更具有多样性和复杂性，实验中随机选择 2000 张图作为
训练样本集，剩下 330 张作为测试样本集。所有图片都准确地标注了 66 个特征点
的人脸形状，实验中选择 66 个特征点描述人脸形状。 

图 4-13  数据库中的人脸图片 

二级人脸形状参数算法中需要设置一些固定的模型参数，包括一级回归次数

、二级回归次数 、特征选择数 、随机特征点数 ，人脸形状参数维度 。

经过反复实验后获得了两组实验结果良好的参数设置方案，设置的第一组参数为

，

，

，

，

，记为 SPR1；设置的第二组参数为

，

，

，记为 SPR2。本文的算法需要最终在性能一
般的安卓移动设备上实现实时检测，所以对算法的运算耗时要求较高，可能需要

，

，

在更好的对齐精度和更快的对齐速度之间做一个平衡。所以在设置两组参数时有

所对比，第一组参数设置中人脸形状参数的维度更高，计算量更大，保存的人脸

形状信息也更丰富，对齐结果更好。而第二组中的形状参数维度较低，会牺牲一

定的对齐精度，但算法计算量小，对齐速度会有提高。 

为了能直观地得到不同算法人脸对齐结果的优劣，需要明确一个误差函数，

对算法进行误差分析。人脸对齐算法在测试中可以得到人脸的标准形状和对齐形

状

，可以直接分析这两个形状之间的差异。仅对同一个样本，这样的差异

可通过计算欧氏距离进行分析。但在实际的测试过程中，往往需要用到多个样本

求误差，用于测试算法的优劣。最后综合多个样本误差，算出一个平均误差。但

多个样本之间本身存在较大的尺度上的差异，而尺度上的差异会极大影响测试结

果的可比性，所以，在进行误差分析时，需要先对所有的样本形状进行归一化操

36 

TKFPD10T100K5F400P30D10T100K5F400P10D*1ˆ{,}NiiiSS 
第四章  改进的人脸对齐方法 

作，才能更好地对齐结果的进行误差分析。在本次实验中，我们是以平均人脸形

状中两个瞳孔特征点坐标之间的距离作为参考，将所有的标准形状进行缩放操作，

将其两个瞳孔特征点的距离等于平均人脸形状中的距离，同时，对应的样本对齐

形状也进行相应的缩放操作，这样能够有效减少样本尺度因素对对齐误差的影响，

误差函数定义如公式(4-27)所示： 

                              (4-27) 

式中， 是人脸形状特征点的个数，

是对齐人脸形状 中的坐标，

是

标准人脸形状 中的坐标， 和 分别为测试人脸形状和平均人脸形状中两个瞳孔

之间的距离。 和 可以约束误差之间的尺度差异。由式(4-27)可以看出，误差越
小，对齐精度越高。 

4.3.2  误差分析 

本 文 算 法 的 实 验 环 境 为 ： PC 端 处 理 器

，2G 1333Hz 内存，使用 VS2008 结合 OpenCV2.3.1 编程实现。 
分别将 ESR 和 SPR 算法在 LFPW 和 HELEN 人脸数据库的训练集上进行回归
量训练，记录两个算法在每个人脸数据库的训练集上的训练时长，并对比最后需

要保存的回归量的文件数据大小，统计结果如表 4-1 所示： 

表 4-1 ESR 和 SPR 训练时长和文件大小对比 

数据库 

ESR 

SPR1 

SPR2 

训练时长（min） 
HELEN 
LFPW 
37.87 
10.12 

文件大小（M） 
HELEN 
LFPW 
16.17 
16.17 

7.51 

5.46 

28.48 

20.14 

3.87 

1.36 

3.87 

1.36 

从表 4-1 可以看出，对比 ESR 算法，SPR 算法的两组参数设置方案的训练结
果中，训练时长和需要保存的回归量文件大小都有显著的改善。尤其是模型大小，

SPR1 训练产生的回归量仅为 ESR 算法的 24%左右，SPR2 更减少到 8.4%左右，大
大减小了数据冗余。同时，由实验结果可知，通过调整形状参数维度，能满足不

同用户的需求，具有不错的扩展性。 

加入 KDE[47]算法，分别将训练所得的回归量模型在对应的测试集上进行测试，
记录下每次迭代中的过程误差，分析人脸对齐的收敛情况，迭代过程中的平均误

差如图 4-14 所示： 

37 

*221ˆˆ=()()niiiiilExxyynln(,)iixy*iSˆˆ(,)iixyˆiSl*ll*lPentium(R)Dual-CoreCPUE5300@2.60GHz 
 
电子科技大学硕士学位论文 

            (a) LFPW 数据库误差                                            (b) HELEN 数据库误差 

图 4-14  算法迭代过程误差对比 

由图 4-14 可知，在人脸图片较少的 LFPW 数据库上，每个人脸对齐算法的迭
代收敛速度差距不大，也比较稳定，但 SPR 算法的两组参数设置实验都是在迭代
7 次之后才趋于平稳，表明 SPR 算法的收敛速度和对齐结果更好。而在人脸图片
比较丰富的 HELEN 数据库上，KDE 算法的表现明显差于 ESR 和 SPR 算法，说明
基于级联回归的人脸对齐算法能更好地处理复杂的人脸数据库，应该作为实验的

首选。在 ESR 和 SPR 算法的对比中，参数设置保留人脸形状信息更多的 SPR1 的
收敛速度优于 ESR 算法，但 SPR2  却比 ESR 算法更差，说明形状参数维度设置过
低，导致人脸形状信息丢失太多，会减小算法的对齐收敛速度，增大对齐误差。

通过记录各个人脸对齐算法的对齐误差和对齐时长更能说明上述实验结果，如表

4-2 所示： 

表 4-2  测试集上对齐时长和对齐误差对比 

数据库 

KDE 

ESR 

SPR1 

SPR2 

对齐时长（ms）  对齐误差(pixels) 
HELEN 
LFPW 
0.578 
311.5 

HELEN 
292.4 

LFPW 
0.507 

11.1 

9.7 

8.9 

11.2 

9.8 

8.0 

0.491 

0.422 

0.457 

0.458 

0.426 

0.495 

由表 4-2 可知，基于级联回归的人脸对齐算法有显著的优越性，而基于显式形
状回归算法（ESR）改进的形状参数回归算法（SPR）在对齐速度和对齐精度上也
有部分提高。SPR 算法通过两组不同参数设置，可以看出形状参数维度可以根据
需求灵活调整，在不同对齐精度和对齐速度要求间适当取舍。 

图 4-15 给出了各个人脸对齐算法对检测集数据库中部分相同图片人脸的对齐

效果。 

38 

     
 
第四章  改进的人脸对齐方法 

(a) KDE 算法对齐结果 

(b) ESR 算法对齐结果 

(c) SPR 算法对齐结果 

图 4-15  各个算法对齐结果对比图 

由图 4-15 可以看出，复杂场景中的人脸图片，KDE 算法的对齐结果十分不理
想，无法实际应用。SPR 算法的对齐效果比 ESR 算法有不少的改善，SPR 算法几
乎没有对齐偏离的情况，对齐精度更高。 

通过对显式形状回归的改进，人脸形状参数回归算法不但提高了对齐速度和

精度，也具有较好的稳定性，如图 4-16 所示，给出了各种复杂场景的对齐效果图。 

(a)  不同光照的对齐结果 

39 

 
 
 
 
 
电子科技大学硕士学位论文 

(b)  变化表情的对齐结果 

(c)  姿态各异的对齐结果 

(d)  局部遮挡的对齐结果 

图 4-16 SPR 算法各种复杂场景的对齐结果 

由图 4-16 可以看出，SPR 算法在各种复杂条件下都具有良好地人脸对齐结果，
包括不同光照、各种表情、变化的姿态和局部有遮挡的情况下都能精确地对齐人

脸。改进后的算法更能适应长途客货运输，铁路运输中的复杂环境。 

4.4  本章小结 

为了在性能一般的安卓设备上实现实时的人脸对齐，我们对比多个人脸对齐

算法后选择了基于二级级联回归的显式形状回归算法。但该算法对齐精度仍然不

够理想，并且需要保存文件较大的形状回归量，难以移植到内存小，性能一般的

手机、平板等设备上。本文通过改进该算法，实现基于人脸形状参数回归算法。

选择 PCA 降维，生成人脸形状空间，使用人脸形状参数进行迭代，改进特征索引
方法，参考不同图片的尺度和角度，采用多重随机特征选择方法，提高了对齐速

度和对齐精度。最后通过实验证明改进后的算法在对齐效果和对齐速度上满足要

求，能够应用到低端的安卓设备上。

40 

 
 
 
第五章  疲劳状态分析 

第五章  安卓端算法实现 

传统的基于视觉的疲劳检测方法一般是通过检测到人脸之后分别定位眼睛、

嘴巴等器官，再分析该器官的疲劳特征。传统方法计算复杂度高，耗时长，难以

移植到硬件性能一般的安卓系统设备上。本文将人脸对齐方法用于疲劳特征分析，

如前文所述，在效果已经较好的显式形状回归算法的基础上再次对该算法进行改

进，大大降低了需要存储的数据量，提高了检测速度和精度。 

但是经过实验发现，66 个特征点的人脸形状在安卓系统设备上的实现效果不
如预期。若形状参数维度设置较大，虽然提高了对齐精度，但无法实现实时的人

脸对齐，相反，若将形状参数维度设置太小，虽然保证了实时的人脸对齐，但对

齐效果一般，不能准确地分析疲劳特征，尤其是眼睛部分的对齐结果，无法精确

地实现眼睛睁闭状态的区分。 

为了解决上述问题，本文采用分步对齐人脸的方法，分为局部人眼区域对齐

和全局的人脸轮廓对齐两步。为了在减少特征点的同时保留更多的局部区域特征，

约束人脸形状，本文选用标注了 83 个特征点的人脸形状，它采用了更多的标注点
标注人脸特征，使获取的人脸特征更加丰富、准确。选择其中的部分特征点进行

人脸对齐，其中局部的人眼轮廓用 20 个特征点标注，全局的人脸轮廓，在 83 个
特征点中选择 27 个点，主要对齐人脸轮廓、嘴巴和鼻子等。完整的 83 个特征点
的人脸形状如图 5-1 所示： 

图 5-1 83 个特征点的人脸形状 

41 

 
 
电子科技大学硕士学位论文 

5.1  安卓端人眼对齐与疲劳特征分析 

眼睛睁闭状态变化和睁闭频率是反应驾驶员疲劳信息的最明显特征，所有基

于视觉的疲劳检测方法都重点研究眼睛的状态特征，因此精确的人眼轮廓对齐是

本文实现疲劳分析的关键。本文采用 83 个特征点描述人脸特征，使人脸形状约束
性更好，提取到的人脸局部特征更准确，对齐结果更加精确。本文首先实现精确

的人眼轮廓对齐，保留 83 个特征点人脸形状中眼部区域的全部特征点，使提取的
眼睛特征更加丰富、准确，并且增加闭眼状态的人脸图片训练样本，提高睁闭程

度变化的对齐效果。保留的眼部特征点共 20 个，如图 5-2 所示： 

图 5-2  人眼形状及编号 

5.1.1  电脑端人眼对齐训练过程 

为了增加闭眼状态的对齐精度，训练样本集包括 LFPW 和 HELEN 数据库的
全部人脸图片，并且在百度图片搜索并筛选了大量人脸图片，特别加入闭眼状态、

打哈欠和头部大角度偏转的人脸图片，总共 2 万张左右，在其中选出 1000 张作为
检测样本，其余作为训练样本。为了消除额外的干扰因素对人脸图片的影响，需

要对所有样本进行预处理，主要包括去噪、灰度化和消除光照等操作。为了提高

图片处理速度，本文对全部样本进行灰度化处理，并都转换成 320*240 大小的图
片。 

采用 face++提供的在线人脸对齐程序将全部训练样本按 83 个特征点对齐，并
且手工剔除掉对齐效果特别差的图片，但保证足够多的人脸图片用于训练。得到

比较精确的对齐结果后，采用 MFC 编程，实现人脸图片和特征点显式及特征点调
整等功能，然后对每一张训练样本进行手工调整，使特征点对齐更加精确，调整

软件如图 5-3 所示： 

42 

123456701081112131415161718199 
第五章  疲劳状态分析 

图 5-3  特征点手工调整软件 

在人眼对齐部分，仅需要对人眼区域图片进行对齐处理，因此为了提高运算

速度，尽量减少需要处理的图片信息，本文仅截取人眼区域进行人眼对齐操作。

将所有样本以两眼的瞳孔特征点坐标为参照，截取出宽高为 2:1，尺寸接近 80*40
的人眼区域图片，最后将截取出的人眼图片全部归一化为标准的 80*40 大小，得
到人眼训练样本。如图 5-4 所示： 

图 5-4  大小 80*40 人眼样本图片 

人眼区域定位公式如下： 

                          (5-1) 

式中，

为人眼矩形区域左上角坐标，

为右下角坐标，

，

为双眼瞳孔坐标， 为两瞳孔坐标距离，

为缩放尺度，是平均人脸

43 

1212(80)0.5(40)0.58040leftxxdisscaletopyydisscalerightleftscalebottomtopscale(,)lefttop(,)rightbottom11(,)xy22(,)xydisscale 
 
 
电子科技大学硕士学位论文 

形状中双眼瞳孔坐标距离的倒数，实验所得

。 

为了增加人眼图片样本的有效性，本文将人眼样本集进行扩展。计算人眼图

片样本集的平均人眼形状 ，将平均人眼形状通过大小收缩、角度旋转和位置平移

变换得到多个初始人眼形状，并给每一个人眼样本都赋值

个初始人眼形状

，如图 5-5 所示： 

图 5-5  多个初始人眼形状 

将人眼样本集通过二级级联形状参数回归算法训练得到人眼形状参数回归量

模型。算法中的参数设置

，

，

，

，

。 

二级形状参数回归训练算法步骤如下： 
。 
算法输入：人眼训练样本集

算法输出：人眼形状参数回归量

。 

（1）赋值
（2）通过 PCA 算法得到每个人眼样本的标准人眼形状参数 和初始人眼形状

个初始人眼形状，得到扩展后的样本集

。 

参数 ，得到

。 

（3）随机选取
（4）由当前的人眼形状

个坐标，建立明确的人眼形状特征索引。 

和明确的人眼形状特征索引，还原

个

坐标的真实坐标，计算像素值特征，生成特征池。 

（5）根据多重随机特征选择算法从特征池中提取出最好的

对特征，然

后对人眼样本分类，计算二级弱回归量 。 
（6）更新每个人眼样本的形状参数
（7）跳回（5），迭代
（8）更新人眼形状
（9）
图片预处理时，通过对全部人脸样本截取同一尺度的人眼区域图片，并归一

次后结束训练算法。 

次后进入步骤（8）。 

，跳回（3），迭代

。 

。 

化到 80*40 大小，再进行灰度化，减小了需处理的样本信息。算法改进时，将 40
维的人眼形状压缩到 20 维，并未大量压缩，使得人眼特征信息很少丢失，保证了
算法有效性和准确率。在训练阶段，处理 2 万张人眼样本，训练时长 1 小时左右，
训练所得人眼形状参数回归量模型文件大小仅 1.32M，可以实现在安卓系统中快速
加载。 

44 

0.031scaleˆS50M0S10T100K5F400P20D1ˆ{(,)}NiiiIS12(,,...,)TRRR50M0501ˆ{,,}NiiiiISSˆ000501ˆˆ{,,,,}NiiiiiiISS400P501{}tNiiS400P5Fir()ttfiii100K0+ttiiiSSP1tt10T 
第五章  疲劳状态分析 

5.1.2  安卓端人眼对齐检测过程 

人眼对齐的过程可以分为图片预处理、人脸检测和人眼对齐几个步骤。在安

卓系统中实现人眼对齐，需要摄像头实时拍摄视频流，并根据算法处理速度，逐

帧或跳跃式地处理视频图像。为了减少需要处理的图片信息以及增加硬件平台的

移植性，本文设置安卓摄像头拍摄图片大小为 320*240。 

图片预处理。安卓开发时，摄像头采集到的视频图像都是 YUV 格式，为了方
便显示和处理，通常需要将图片进行转换。安卓自带了 YUV 转 RGB 格式的函数，
虽然使用方便，但自带的函数转换效率不高，耗时长，不适合用于实时处理。因

此本文选择在底层进行转换，直接将原始视频图像数据转换成 Bitmap 格式，大大
提高了转换速度。Bitmap 格式图片包含的图片信息比较丰富，但几乎不对图像进
行压缩，文件很大，所以本文对图片进行压缩及灰度化处理，安卓端图片直方图

均衡化去光照效果不明显，因此省去此步骤。 

人脸检测。安卓系统有自带的人脸检测程序，但检测速度慢，检测准确度不

太理想，本文通过加载 OpenCV for android 2.4.9 的 sdk，调用人脸检测函数，提高
了检测效率和检测精度。人脸检测得到的是图片中整个人脸的矩形区域，表示为

左上角顶点

，宽

，高

。为了准确截取出的包含人眼区域的图片，

需要根据人脸矩形参数初定位双眼瞳孔坐标。两瞳孔坐标转换公式如下： 

                                              (5-2) 

式中，

，

为左右眼瞳孔坐标，具体数字参数为实验所得。 

通过双眼瞳孔坐标，由公式(5-1)可截取出 2:1 的人眼区域，再 risize 为 80*40
大小，作为人眼对齐检测图片。加载训练阶段生成的人眼形状参数回归量模型文

件进行人眼对齐。 

二级形状参数回归检测算法步骤如下： 
算法输入：大小 80*40 的人眼图片 。 
算法输出：人眼对齐形状 。 
（1）根据初定位的双眼瞳孔坐标赋值初始人眼形状 。 
（2）通过 PCA 算法得到初始人眼形状参数 。 
（3）通过当前的人眼形状 和明确的形状特征索引算法还原出

个坐

标的真实坐标，并计算像素差特征。 

（4）计算

对像素差特征，根据阀值对该图片进行分类，并得到该类的

45 

(,)xywidthheight11220.330.397*0.6870.397xxwidthyyheightxxwidthyyheight11(,)xy22(,)xyIS0S0tS400P5F 
电子科技大学硕士学位论文 

形状参数回归量，作为人眼形状参数增量

。 

。 
次后进入步骤（7）。 

（5）更新人眼形状参数
（6）跳回（4），迭代
（7）更新人眼形状
（8）
通过算法改进和图片预处理，人眼对齐算法在小米 3 手机的安卓系统 4.4 版本
平台上的实验平均运行耗时只有 3 至 5 毫秒，完全能达到实时检测。人眼形状对
齐过程如图 5-6 所示： 

次后结束对齐算法。 

，跳回（3），迭代

。 

图 5-6  人眼形状对齐过程 

5.1.3  人眼疲劳特征分析 

目前基于眼睛的疲劳状态分析的主要判断方法有检测是否存在瞳孔、眼脸曲

线拟合和眼睛图像二值化分析等，这些方法都需要在精确定位到眼睛区域后再进

行比较复杂的计算，增加了处理时长，不适合用于安卓平台的实时疲劳检测。 

本文通过人眼对齐后，能直接得到人眼上下眼脸在图像中的位置坐标，仅通

过计算上下眼脸的两个坐标的距离就能得到人眼的睁闭程度。本文选择经典的
PERCLOSE 疲劳状态判断方法[48]，该方法是判断疲劳程度最为成熟和认可度最高
的准则之一。PERCLOSE 方法定义疲劳状态的标准中，P70 标准被 NHTSA 实验证
明检测效果较准确的，P70 标准即眼睛瞳孔的面积被眼脸覆盖百分之七十以上则判
断为眼睛闭合状态。如图 5-2 所示，我们仅选择左眼进行分析，人眼对齐后上眼脸
特征点编号 2 的坐标和下眼脸特征点编号 6 的坐标之间的距离大小可以表示眼睛
的睁闭程度。由于在 5.2 小结中，我们将头部角度偏转较大判定为清醒状态，所以
在此可以直接用上下眼脸两坐标的 轴差值作为眼睛睁闭大小的判断值。通过计算

平均人眼形状中编号 2、6 两个坐标的距离及多次实验，本文设置当上下眼脸特征
点编号 6、2 的坐标的 轴差值小于 2.85 时，满足眼睛瞳孔被眼脸覆盖百分之七十
以上，定义为眼睛闭合状态。 

安卓端的实时检测需要连续判断一段时间内的人眼睁闭状态。据科学统计，
人在一分钟内有大约 10 次的正常眨眼，每次眨眼的全过程时间为 0.2~0.4 秒[49]。
实验统计本系统在安卓平台上的检测速度为每秒 12~15 帧左右，安卓摄像头采集
帧率设置为低于 30 帧每秒，为了达到实时检测，本系统采取隔帧检测，即每隔一

46 

()fi()ttfi100K0ttSSP1tt10Tyy 
第五章  疲劳状态分析 

帧检测一次人眼状态。结合人眼正常眨眼规律、系统检测速度，本文通过实验将

判断驾驶员疲劳阀值定义为间断的 7 次闭眼，当两只眼其中一个达到闭合阀值时，
则认为是一次闭眼，人眼疲劳状态判断流程如下： 

图 5-7  人眼疲劳状态判断流程图 

如流程图 5-7 所示，检测时以 Count 变量统计一段时间内闭眼次数，为了增加
检测的准确性，排除连续闭眼状态的检测过程中可能出现的误检，当检测到连续

闭眼次数超过 3 次，紧接着检测到睁眼状态时，对闭眼次数统计惩罚性减 2。当判
断到 Count 值大于 7 次时，判定为出现一次眼睛疲劳状态，然后 Count 置零，进入
下一次眼睛疲劳状态检测。 

5.2  安卓端人脸轮廓对齐与疲劳特征分析 

疲劳检测的主要检测方法是根据人眼的睁闭状态判断驾驶员的精神状态，但

人面部的其他器官状态变化特征以及头部运动特征也能作为疲劳状态的检测目

标，比如打哈欠和连续点头。另外，头部的一些姿势也可以作为排除疲劳状态误

47 

人眼对齐结果是否闭眼是疲劳判断Count加1Count大于7眼睛疲劳Count置零是Count大于2Count减2Count置零是否否判断结束否 
 
电子科技大学硕士学位论文 

检的依据，比如当人脸大角度朝向左右和偏向左右时，可判断是驾驶员清醒状态

下做出的动作。本小节通过人脸轮廓对齐，分析得到驾驶员嘴巴、头部运动和面

部朝向特征，作为判断驾驶员疲劳状态的辅助特征。 

5.2.1 人脸轮廓对齐训练与检测 

人脸轮廓对齐主要是对齐人脸外部脸颊和下巴轮廓，上下嘴唇轮廓以及双眼

瞳孔和鼻头位置。为了提高打哈欠、头部偏转等状态的对齐效果，在样本中加入

一定数量的该类图片。为了减少需要处理的数据信息，本文从 83 个特征点的人脸
形状中选出 27 个点。筛选出的 27 个特征点，满足了疲劳检测需要的人脸特征点，
保留了大部分人脸形状空间约束，并且极大地减少了训练和检测时计算的数据维

度，如图 5-8 所示： 

图 5-8  简化后的人脸轮廓形状及编号 

人脸轮廓对齐的训练和对齐算法的步骤和实验参数设置和人眼对齐部分基本

相同，不过是对完整地人脸图片进行处理，并改进了初始人脸轮廓形状的赋值过

程。原始的人脸对齐算法中，检测到人脸后即对人脸区域直接赋值平均人脸形状

作为初始形状，这会导致对齐的收敛速度较慢，对齐精度不够高。本文为了提高

算法检测速度和对齐效果，利用第一步精确对齐人眼的结果改进初始人脸轮廓形

状，同时减少迭代次数，

。 

48 

123456701098111213141516171819202122232425268T 
第五章  疲劳状态分析 

初始人脸轮廓形状改进算法： 
（1）通过人眼对齐部分，获得准确的人脸双眼瞳孔位置坐标。 
（2）通过精确的人脸双眼瞳孔坐标和平均人脸轮廓中双眼瞳孔的坐标，计算
双眼瞳孔的距离之比，得到形状缩放尺度 ，计算双眼瞳孔倾斜角度，得到形状旋

转角度 ，计算左眼水平位置差值，得到平移量 。 

（3）根据以上参数对平均人脸轮廓形状进行缩放、旋转和平移处理，得到改

进后的初始人脸轮廓形状。 

图 5-9  赋值平均人脸轮廓形状和改进后人脸轮廓对比 

如图 5-9，改进后的初始人脸轮廓形状已经基本对齐人脸特征，加快了算法的
对齐速度，提高了对齐精度。通过形状参数回归算法和改进初始人脸轮廓，人脸

轮廓形状参数回归量模型文件大小仅为 1.32M，在小米 3 手机上实验检测时平均对
齐时间仅需要 3 至 5 毫秒，对齐速度和对齐精度都能满足实时检测需求。 

5.2.2  头部对齐结果状态分析 

基于视觉的疲劳检测中，驾驶员头部运动和脸部朝向信息同样能起到参考作

用，作为判断驾驶员是否出现疲劳的依据。当驾驶员疲劳时，头部通常会出现连

续点头的情况，且点头动作幅度大，速度快。 

驾驶员疲劳时的点头动作在检测过程中的表现即为一段时间内，头部在间隔

几帧的图片中的位置上下变化较大。如图 5-8 所示，本文选择人脸轮廓中鼻尖特征
点编号 2 的坐标表示人脸在图片中的位置，以平均人脸轮廓中鼻尖到下巴，即特
征点编号 2 和 22 坐标的 轴之间的距离作为疲劳状态中点头幅度的阀值，计算得
到阀值为 35。等差计算第 1、5、9 帧和 3、7、11 帧图片中驾驶员头部位置坐标
轴变化大小，当统计到 2 次点头幅度超过设置阀值的时间间隔小于 30 秒时，判定
为驾驶员出现点头特征疲劳。 

驾驶员的面部朝向也能作为判断驾驶员精神状态的依据，当驾驶员的头部偏

转动作较大时，可能是驾驶员在观察左右或后面的交通状况，是驾驶员有意识的

49 

styy 
 
电子科技大学硕士学位论文 

动作，说明驾驶员比较清醒，而平静地直视前方，则可能疲劳。因此检测驾驶员

头部是否有较大幅度的偏转能作为系统排出误判的依据。 

目前研究人脸头部朝向的方法分为基于 2D 的人脸外观特征检测与估计和 3D
人脸检测方法。基于 3D 人脸的检测方法不适于本文的运算简单，实时检测的要求。
本文参考 Mazumdar 等人脸 T 字模型[50]方法，结合人脸轮廓形状建立简单的面部
三角形，根据三角形形状的变化估计驾驶员的面部朝向。我们选取图 5-8 中人脸轮
廓形状特征点编号 2、20 和 24 的坐标建立面部正三角形，不采用 T 字模型中的倒
三角是因为通过实验发现鼻尖和两边脸颊组成的正三角比双眼和嘴巴组成的倒三

角在头部偏转时，三角形形变更明显，更利于判断，如图 5-10 所示： 

图 5-10 正三角形和倒三角形形变对比 

为了计算简单，本文只考虑驾驶员头部发生较大幅度的左右偏头动作和左右

转头动作，避免因为汽车抖动或驾驶员微小动作等因素出现误检。如图 5-11、5-12
所示： 

图 5-11  左右转头特征三角形变化 

50 

 
 
第五章  疲劳状态分析 

图 5-12  左右偏头特征三角形变化 

通过实验观察，当人正脸面向前方、头部左右任意角度偏头时，特征三角形

均为等腰三角形，如图 5-12。当头部左右转头动作时，三角形发生形变，如图 5-11。
在整张图片的全局坐标系中，通过三角形顶点 A 与顶点 B 和 C 的 轴距离变换可
以判断头部偏转的左右方向。因此，可以通过判断三角形的形状和顶点 A 相对的
位置变化分别判断头部的偏转和朝向。如图 5-12，根据人脸轮廓的对齐形状，计
算边长 和 ，判断三角形形状，为了忽略小幅的头部动作，不计 8 以内的误差。
计算顶点 A 与顶点 B、C 的 坐标的距离 和 ，不计 5 以内的误差。最终人
则人脸
脸可以分为三个朝向，如果

则为等腰三角形，若

向右偏，若

则向左偏。如果三角形发生形变，若

则人脸

向右转，相反则向左转。 

5.2.3  嘴部对齐结果状态分析 

驾驶员感觉疲劳时，常常会出现打哈欠的状态，所以检测嘴巴状态变化可以

判断驾驶员是否打哈欠，作为疲劳状态预警。 

人打哈欠时，嘴巴的张合程度通常比平时吃东西、说话的动作幅度明显变大。

本文选择人脸轮廓形状中对齐嘴巴的特征点编号 6、9、12 和 15 的坐标分析嘴巴
的张合程度，分别以编号 6 和 12 坐标的 轴距离代表嘴巴的宽度 ，以编号 9
和 15 坐标的 轴距离代表嘴巴的高度 ，如图 5-13 所示： 

51 

ABCxablaclxabLxacLx||8abaclxlx5abacLxLx5acabLxLx8abaclxlxxMWyMH 
 
电子科技大学硕士学位论文 

图 5-13 嘴部宽高距离 

嘴巴的状态变化主要分为张合程度和张合频率两方面，由于打哈欠时的张合

程度与频率明显区别与正常状态下吃东西和说话的状态，且一次打哈欠张嘴的时

间持续较长，所以本文仅考虑连续一段时间内检测到打哈欠的状态即判断为出现

疲劳，不考虑一段时间内打哈欠的频率。定义 表示嘴巴高度与宽度的比值，表

示为： 

                                                  (5-3) 

由平均人脸轮廓形状和实验数据，定义判断嘴巴是否打哈欠的高宽比阀值为

1.2。当连续多帧检测到嘴巴的张合程度超过阀值时，判断为打哈欠状态，驾驶员
出现疲劳状态。 

5.3  综合疲劳特征分析 

为了验证人眼对齐的检测效果，我们在 PC 端实现人眼对齐检测程序，检测静
态人眼图片，并根据对齐结果，判断测试样本睁闭眼状态，统计检测结果。实验

选择 200 张睁眼图片，200 张闭眼图片，检测样本包含不同光照、不同姿态以及是
否戴眼镜等图片。检测统计结果如表 5-1 所示： 

表 5-1 PC 端人眼对齐检测结果 

睁眼准确张数  闭眼准确张数  准确率 

196 
由表 5-1 可知，单独训练的人眼对齐结果速度快、精度高，尤其对人眼上下眼
脸轮廓位置的变化对齐效果好，对闭眼状态的图片对齐精度达到预期效果。其中

96.25% 

189 

睁眼样本检测错误的图片，包括一些向下看或有笑容的人脸，该状态时人眼轮廓

52 

MKMMMHKW 
第五章  疲劳状态分析 

状态比较类似于闭眼。闭眼样本中，如果是侧脸角度较大且有光照影响，则可能

出现误检。部分人眼形状对齐结果如图 5-14 所示： 

图 5-14  人眼对齐结果 

同样实现 PC 端人脸轮廓对齐程序，对静态人脸图片判断打哈欠和头部偏转方
向，统计检测结果。实验选择打哈欠样本 100 张，闭嘴 100 张，闭嘴样本中包含
说话或微笑等嘴巴微张的图片。选择左右偏头 100 张，左右转头 100 张，均选择
头部偏转角度较大，明显区别于驾驶员正常的驾驶姿态。样本包含不同光照和局

部遮挡等。检测结果统计如表 5-2 所示： 

表 5-2 PC 端人脸轮廓特征检测结果 

张嘴准确张数  闭嘴准确张数  准确率 

73 

99 

86% 

偏头准确张数  转头准确张数  准确率 

91 
由表 5-2 可知，人脸轮廓对齐对嘴巴状态的检测效果一般，通过实验分析，人
脸轮廓对齐时，对形状变化比较夸张的表情对齐效果一般，比如打哈欠，当嘴巴

89.5% 

88 

张得很大时，下嘴唇和下巴轮廓的对齐经常会错位，影响状态分析，如图 5-15 中
最后一张打哈欠图片。而偏头和转头的检测效果较好，因为头部偏转时特征三角

形变化比较明显，且偏头时通常为正脸，对齐效果更好。通过实验分析，偏头的

检测效果可以通过改变判断阀值提高，但敏感度降低，无法过滤一些小幅度的头

部动作。部分人脸轮廓对齐结果如图 5-15 所示： 

53 

 
 
电子科技大学硕士学位论文 

图 5-15  人脸轮廓对齐结果 

在安卓端疲劳分析时，当驾驶员出现长时间闭眼、连续大幅度点头和打哈欠

的状态，都可以作为判定驾驶员疲劳的标志。当驾驶员出现头部较大角度的偏转

时，表示驾驶员做出有意识的动作，状态清醒，可以排除部分误检。所以综合以

上驾驶员面部和头部特征，能更准确地对驾驶员状态做出判断。本文疲劳状态综

合分析和判定如表 5-3 所示： 

表 5-3  疲劳特征综合判定规则 

出现的疲劳特征  是否头部偏转  是否判定为疲劳 

闭眼或点头或打哈欠 

闭眼或点头或打哈欠 

多个疲劳特征出现 

否 

是 

否 

是 

否 

是 

多个疲劳特征出现 

是 
由表 5-3 可知，检测到单个疲劳特征时判定为疲劳状态，需要同时判断驾驶员
头部是否有大幅度的偏转，没有则判定为疲劳，给出报警提示，有则判定疲劳特

是 

征误检，不给出提示；当两个及以上疲劳特征同时出现时，都判定为疲劳状态，

给出报警提示。通过多特征结合的疲劳特征分析，提高了疲劳检测的准确度，排

除了部分的误检情况。 

5.4  本章小结 

本章通过分步实现人脸对齐，对驾驶员眼睛轮廓、头部运动和嘴巴张合状态

54 

 
第五章  疲劳状态分析 

进行分析，在安卓平台实现了实时的多特征疲劳检测，并实现 PC 端检测程序，验
证了算法的有效性和稳定性。 

算法应用方面，根据硬件性能和人脸疲劳特征检测的重点，将人脸对齐分为

人眼对齐和简化的人脸轮廓对齐，减小训练所得模型文件的大小，提高检测速度。

通过增加大量闭眼、打哈欠和大角度偏转的人脸图片训练样本，提高了眼睛眼脸

和人脸轮廓的对齐精度，更加适应表情变化夸张的轮廓对齐。通过改进人脸轮廓

初始形状，提高了人脸轮廓的对齐速度和精度。 

眼睛疲劳特征分析时，直接通过上下眼脸的特征点坐标距离得到眼睛的睁闭

程度，分析疲劳状态。头部运动，通过分析鼻尖坐标在多张图片中的位置变化得

到。面部偏转方向，通过判断面部三角形形状变化获得。嘴巴的张合程度，通过

计算嘴巴的高宽比得到。以上疲劳特征分析均根据两次人脸对齐的结果，经过简

单的算术运算就能得到，避免了传统的不同器官分别定位，扣取图像，再进行图

像处理和分析这样复杂计算的步骤。 

55 

 
电子科技大学硕士学位论文 

第六章  系统实现 

根据第三章的系统设计实现方案，本文实现了基于安卓系统的疲劳驾驶实时

检测应用程序和服务器端远程监测网站。通过大量的模拟实验，验证了本系统的

可用性。 

6.1  安卓端检测系统实现 

终端检测系统基于安卓系统 4.3 版本开发，主要实现了驾驶员账号登陆，疲劳

驾驶实时检测，疲劳警报，疲劳图片发送和保存等功能。 

驾驶员账号登陆部分主要通过驾驶员输入车牌号或手机号等身份信息，用于

网络端区分用户。登陆后驾驶员根据视频显示的拍摄状况调整手机或摄像头位置，

使摄像头能完整地拍摄到驾驶员的上半身并有良好地对齐效果。系统登录界面如

图 6-1 所示： 

图 6-1 系统登录界面 

疲劳驾驶实时检测部分主要实现了图像预处理，人脸检测，人眼对齐，人脸

轮廓对齐和驾驶员状态分析等功能。人脸检测部分采用 OpenCV 人脸检测函数，
当检测到人脸则继续进行疲劳状态检测，当连续多帧未检测到人脸，则判定为驾

驶员离岗或未正视前方，给出报警提示。检测到驾驶员疲劳后，报警部分是通过

文字显示和声音提醒两种方法提示驾驶员出现了疲劳状态。 

疲劳图片保存和发送部分是当检测到驾驶员出现疲劳特征时，保存当前检测

的图片，压缩并发送该图片给后台服务器。系统采用 3G 或 4G 移动信号进行图片
发送，由于移动网络信号可能出现不稳定的情况，会使图片发送失败，所以需要

不停上传未发送成功的图片，因此本系统采用双线程，分别实现疲劳检测和图片

56 

 
第六章  系统实现 

发送功能。但不停地使用网络发送图片会明显占用系统资源，降低实时检测的效

率，所以当检测到疲劳时才唤醒发送图片线程，发送成功后挂起，当发送失败时

需要休眠线程 5 秒再唤醒并尝试发送，反复以上过程，直到图片发送成功为止。 

我们采用小米 3 手机硬件平台运行疲劳驾驶实时检测程序，手机部分参数为：
Nvidia Tegra4 1.8Hz cpu，2G 内存，安卓系统 4.4 版本，自带 200 万像素前置摄像
头。编译环境为 adt-bundle-windows-x86_64，加载了 OpenCV-2.4.9-android-sdk。
系统运行检测效果如图 6-2 所示。为了显示检测重点，以及保持系统界面整洁性，
系统界面只显示人眼对齐形状。 

图 6-2  人眼对齐效果图  

为了检测系统的实验效果，我们设置 5 分钟模拟疲劳检测实验，测试者在连

续 5 分钟内模拟出各种疲劳状态的特征，具体模拟数据如表 6-1 所示： 

表 6-1 5 分钟模拟实验参数设置 

疲劳特征 
次数(个) 

闭眼 
5 

打哈欠 

5 

点头 
2 

头部动作 
4 

表 6-1 中，头部动作是偏头或转头同时出现闭眼或张嘴动作。我们随机选择 3
位测试人员，每个人完成 6 次模拟实验，则每个测试人员总共完成 30 次闭眼，30
次打哈欠，12 次点头，24 次头部动作。实验模拟时测试者手持手机，调整到较好
的检测角度，保持手机稳定。最终统计每人全部时长的检测结果，模拟实验检测

结果如表 6-2、表 6-3 所示。 

由表 6-2 可知，疲劳检测系统中，闭眼疲劳状态检测效果最好，符合 PC 端实
验结果，达到了预期检测效果。打哈欠的检测效果仍然不够理想，对夸张的表情

对齐效果还有待提高，但实验时发现，打哈欠状态发生时，通常伴随闭眼或眯眼

的特征，所以，通过闭眼检测部分减少了该类疲劳状态的漏检。部分闭眼或打哈

57 

 
 
电子科技大学硕士学位论文 

欠状态检测结果如图 6-3、图 6-4 所示： 

表 6-2  模拟实验统计结果 

疲劳特征  闭眼(30 个) 
测试者 1 
测试者 2 
测试者 3 

28 

28 

29 

准确率  打哈欠(30 个)  准确率 
76.67% 
23 
96.67% 

93.33% 

93.33% 

21 

22 

70% 

73.33% 

表 6-3  模拟实验统计结果 

疲劳特征  点头(12 个)  准确率  头部动作(24 个)  准确率 
测试者 1 
50% 
测试者 2 
测试者 3 

58.33% 

58.33% 

45.83% 

58.33% 

50% 

12 

14 

11 

6 

7 

7 

由表 6-3 可以看出，点头状态实时检测效果一般，实验中发现，当测试人员点
头幅度较大时，人脸轮廓对齐效果会变差，影响检测结果。另外，当测试人员头

部太低时，通常检测不到人脸，无法进一步对齐人脸并分析疲劳状态。部分小幅

度低头检测效果如图 6-5 所示。同时，由表 6-3 可知，本系统对模拟的头部动作检
测效果较差，明显低于 PC 端静态图片的检测结果。通过实验分析，我们发现安卓
系统自带的人脸检测以及安卓版 OpenCV 的人脸检测函数对人脸的检测角度远不
如 PC 版 OpenCV。所以当测试者出现大角度的左右转头时通常无法检测到人脸，
而出现驾驶员离岗的提示，使判断头部偏转方向部分无法进行。 

图 6-3  闭眼疲劳对齐效果 

58 

 
第六章  系统实现 

图 6-4 打哈欠疲劳效果图 

图 6-5  点头疲劳效果图 

图 6-6 人脸检测失败结果图 

通过模拟实验结果及分析，将二级回归的人脸形状参数算法移植到安卓系统

后，能够实现实时的疲劳驾驶检测。改进后的算法对齐速度和效果都较理想，其

59 

 
 
 
 
电子科技大学硕士学位论文 

中人眼对齐部分，具有较好的稳定性，能在光照变化、眼部戴眼镜等场景中有良

好检测结果。但也发现一些可改进的问题，首先模拟实验的条件比较理想，没有

加入车辆的自然抖动，我们在后续实验中通过轻微晃动手机进行检测，发现此时

的对齐效果较差，使得闭眼疲劳误检较多且人脸检测失败概率增大。然后，人脸

轮廓对齐部分，为了提高对齐速度，减少的特征点太多，使得对表情夸张以及过

大角度转头的图片对齐效果不如预期。另外，安卓系统端现有的人脸检测程度效

果远不如 PC 端程序，人脸不同角度和环境光照变化适应性很差，很大程度上影响
了后续的疲劳实验分析，如图 6-6 所示。最后，疲劳检测过程主要分为图像预处理、
人脸检测、人脸对齐和疲劳状态分析，其中图像预处理和人脸检测在完成一次疲

劳检测的过程中，耗时占了整体的 70%以上，如表 6-4 所示。因此，本系统在图像
预处理的效率、人脸检测的耗时和成功率以及图像防抖动方面还有待进一步研究。 

表 6-4  疲劳检测各模块耗时平均统计结果 

疲劳特征  图像预处理  人脸检测  分步人脸对齐  疲劳特征分析  总时长 

时长(ms) 

31 

27 

13 

12 

83 

6.2  服务器端系统实现 

后台网站采用 PHP 编程语言，ThinkPHP 框架和 MVC 模式，主要实现了首页
管理、系统设置、管理中心和数据中心四大模块。主要功能有用户管理和图片数

据管理。用不同权限的户通过账号、密码登录系统网站，即可查看各个功能模块。 
首页管理模块提供网站说明、展示和用户登陆的功能，如图 6-7 所示： 

图 6-7  后台系统登录界面 

系统设置包括两个子模块：基本设置和友情链接。基本设置实现网站和当前

登陆用户相关信息的设置，比如网站简介，站长邮箱，修改当前登陆用户名称或

密码等功能。友情链接提供与本网站相关的网址链接，如系统开发实验室的网址

60 

 
第六章  系统实现 

等。管理中心实现对网址管理员的管理。包括添加新的管理员账户，对已有管理

员账户信息进行维护或修改等。如图 6-8 所示： 

图 6-8  管理中心界面 

数据中心包括两个模块：用户管理和图片管理。用户管理实现对可以登陆本

系统的普通用户进行信息维护，可以修改、删除或添加普通用户信息。图片管理

最主要的功能是将终端即时发送过来的疲劳驾驶图片实时显示，每当接收到新的

图片时刷新实时显示页面。另外实现了对接收到终端发送的疲劳驾驶图片进行管

理，可以单张图片管理，点击大图阅览和删除，也可以批量图片管理，仅能对同

一个编号的用户进行图片批量删除。如图 6-9 所示： 

图 6-9  实时显示界面 

6.3  本章小结 

本章分别介绍了疲劳检测终端系统和网络服务器端系统的实现结果和效果展

示。通过模拟实验，检测了移动端疲劳检测系统各个疲劳状态的检测结果，验证

了本系统疲劳检测的实时性、稳定性，并通过网络端，实时查看检测结果。同时

通过实验，找出了系统存在的不足，明确了需要改进和提高的系统模块。

61 

 
 
 
电子科技大学硕士学位论文 

第七章  总结与展望 

7.1 全文总结 

疲劳驾驶检测随着社会交通运输的快速发展成为研究热点，其中基于计算机

视觉的非接触式检测因为对驾驶员无干扰，易于推广，成为重点研究方向。本文

在详细调研当前基于图像的疲劳检测发展现状和方法后，选择将人脸对齐算法用

于实现疲劳检测系统，并达到实时检测，设备简单且低廉，易于移植和安装等优

点。该系统包括车载的安卓移动设备实现实时疲劳检测和远程网络端实现疲劳检

测结果实时显示、查看和记录等功能。为了使系统达到良好的检测效果和实时的

检测速度，本文的主要工作和成果如下： 

（1）通过调研当前疲劳检测成果中使用的算法和取得的效果，结合项目中学
习到的模式识别相关的算法，率先采用人脸对齐方法应用于疲劳驾驶检测。该算

法的优势为通过对齐人脸形状，能一次得到人脸面部器官的全部轮廓信息，而传

统的疲劳检测方法是在检测到人脸区域后，分别定位和分析人脸各个器官的状态。

减少了需要处理的数据量，提高检测速度。 

（2）为了将显式形状回归人脸对齐算法移植到性能一般的安卓系统移动设备
上，并提高对齐精度和速度，本文对该算法进行多处的改进后，提出基于二级回

归框架的人脸形状参数回归算法。采用 PCA 降维，用低维的人脸形状参数约束人
脸形状。在第二级回归中，仅简单计算低维的人脸形状参数，替代原始的高维人

脸形状，大大减少计算的数据量。使用明确的形状特征索引替代局部特征索引，

提高特征的可比性。采用多重随机特征选择，使回归量的计算更快更准确。改进

的算法提高了对齐效率和对齐精度，并且极大地减小了需存储的模型文件，使其

能在安卓系统中快速加载。 

（3）找到大量的闭眼、打哈欠和头部偏转的人脸图片加入训练样本，选择 83
个特征点的人脸形状，通过预处理后，手工调整样本人脸形状，完成对齐准确的

参考人脸形状。在安卓系统中分步实现人脸形状对齐，重点提高人眼对齐和简化

后的人脸轮廓对齐效果，大大减少单次需要处理的数据量，降低数据维度，加快

检测速度。并根据人眼对齐得到精确的双眼瞳孔坐标，优化人脸轮廓对齐的初始

形状，使人脸轮廓对齐更快更精确。 

（4）疲劳特征分析时，根据人脸对齐结果，均采用简单的四则运算分析疲劳
特征，用上下眼脸坐标距离判断眼睛的睁闭，鼻尖坐标位置变化判断头部运动，

面部三角形形状变化判断面部朝向和偏转，嘴巴特征点距离的高宽比判断张合程

62 

第七章  总结与展望 

度，最后综合全部疲劳特征给出检测结果。避免了每个器官分别定位、扣取图像

并进行图像分析等复杂的计算过程。 

（5）最后，分别实现移动终端和服务器端系统，通过模拟实验得到良好的检

测效果，并根据工程和算法上的创新申请了一项专利，联合发表一篇论文。 

7.2 不足与展望 

根据现有的疲劳检测系统的研究和商用现状，本文在安卓系统的移动平台上

实现了基于视觉的实时疲劳检测系统。本系统的优点是检测效果好，设备性能要

求低，便于安装和携带，经过大量模拟实验，表明系统稳定性好，有很好的应用

前景。但在实验中也发现了一些不足，使得本系统成为有竞争力的商业产品还有

一定的改善空间。综合长途汽车驾驶和铁路运输中的复杂检测环境，本文的疲劳

驾驶检测系统还有以下几个部分可以进一步改进。 

进一步提高实时检测速度。虽然本文改进后人脸对齐算法耗时已经降到了毫

秒级，但仍无法达到每秒 30 帧的检测速率，因为图像预处理和人脸检测部分消耗
了大部分时间。本文因为研究重点不同，只是通过改变图像格式转换函数和人脸

检测函数，简单改善了该部分的耗时。 

提高人脸检测准确度。本文直接采用 OpenCV 的人脸检测函数，虽然比安卓
系统自带的人脸检测函数速度和精度上有一定提高，但相比 PC 端的检测效果还有
很大的改善空间，比如提高大角度人脸图片和不同光照人脸图片的检测效果。 

加入处理图像抖动算法。真实的应用场景中，车载台始终存在抖动，这严重

影响拍摄的图片质量，导致检测结果不如预期。 

加入更多的疲劳判断条件。比较可行的是将基于视觉的疲劳检测结果和车辆

行驶状况检测结果相结合，给出更加准确的判断结果。 

63 

 
 
电子科技大学硕士学位论文 

致    谢 

硕士三年，短暂却那么可贵，我非常庆幸来到了 cvlab，这个温馨、团结、向
上的团队，结识了这么多如此难得的良师益友。首先，感谢叶老三年来学习上的

耐心教导和生活方面的悉心关怀，让我每一天都感到充实和快乐。在科研项目中，

当因为自身的不足而遇到困难时，始终能感受到叶老的耐心、包容以及渊博的学

识。然后，是那么多难忘的名字：彭明超，王梦伟，归喆，申鹏，方正，李旭东，

向涛，李涛，杨晨雪，丰宁，刘子健，张里静，肖华强等，所有实验室的朋友，

他们代表研究生期间学生时代的感情，充满真挚和纯洁，生活和学习中总是那么

坦诚相待，毫无保留，如此真诚的情谊值得一生去珍惜、维护。最后，感恩父母，

是他们青丝到花发，几十年的艰辛付出，才创造了这个温馨的家，给了我学习和

生活的最坚实的后盾，让我求学在外，始终有个挂忘的地方。 

64 

 
参考文献 

参考文献 

[1]  薛雷.考虑驾驶员生物电信号的疲劳驾驶检测方法研究[D].  长春：吉林大学，2015, 3-14 

[2]  刘灵.心率变异性在汽车司机驾驶疲劳监测中应用的研究[D].  重庆：重庆大学，2007, 37-44 

[3]  张希波，成波，冯睿嘉.基于方向盘操作的驾驶人疲劳状态实时检测方法[J].  清华大学学报：

自然科学版，2010, 7(25): 1072-1076 

[4]  唐琎，许海柱，王力.图像中人眼检测技术综述[J].  计算机应用研究，2008, 25(4): 961-965 

[5]  孙伟，张小瑞，唐慧强，等.基于嘴唇色度 Fisher 分类的驾驶疲劳视觉检测[J].  南京信息工

程大学学报：自然科学版，2011, 3(4): 324-330 

[6]  杨秋芬，桂卫华，周书仁.疲劳驾驶面部表情识别算法[J].  计算机应用研究，2008,  25(10): 

3039-3041 

[7]  马添翼.基于面部表情特征的驾驶员疲劳状态识别方法研究[D].  北京：清华大学，2012, 2-7 

[8] S. J. Lee, S. B. Jung, J. W. Kwon, et al. Face detection and recognition using PCA[C]. TENCON 

99. Proceedings of the IEEE Region 10 Conference, 1999, 1: 84-87 

[9] D. Liu. Face Detection:a Survey[J]. Computer Engineering & Applications, 2003, 11(6): 101-77 

[10]  X.  X.  Shan,  C.  B.  Xiu.  Face  Detection  based  on  Skin  Color[J].  Netinfo  Security,  2012,  6: 

3625-3628 

[11]  张立刚，何东健.基于肤色模型和区域特征的人脸检测方法[J].  计算机工程，2008, 34(19): 

209-211 

[12]  卢绪军，赵勋杰.一种基于肤色和模板匹配的人脸检测方法[J].  计算机应用与软件，2011, 

28(7): 112-114 

[13]  程勇光. 基于肤色和面部几何特征的人脸检测算法的研究[D].  北京：北京交通大学，

2008,34-42 

[14]  龚文胜，陈宇，辛国江.一种基于轮廓图像的人脸检测方法[J].  计算机工程与设计，2006, 

27(21): 4068-4070 

[15]  杨光正，黄熙涛.镶嵌图在人面定位中的应用[J].  模式识别与人工智能，1996. 3(3): 213-220 

[16]  万飞.基于特征与模板的人脸检测技术研究[D].  成都：电子科技大学，2009, 35-41 

[17]  茅泉泉.基于统计理论的人脸检测方法的研究[D].  南京：东南大学，2006, 37-51 

[18]  廖频.基于统一概率模型的人脸识别技术[D].  北京：中国科学院研究生院(计算技术研究

所)，2003, 17-32 

[19]  H.  Jee,  K.  Lee,  S.  Pan.  Eye  and  face  detection  using  SVM[C].  Sensor  Networks  and 

Information Processing Conference, IEEE, 2004, 577-580 

65 

 
电子科技大学硕士学位论文 

[20]  G.  Li,  Y.  Xu,  J.  Wang.  An  improved  AdaBoost  face  detection  algorithm  based  on  optimizing 

skin color model[C]. International Conference on Natural Computation, 2010, 4: 2013-2015 

[21]  王刚，黄昶.基于 BP 神经网络的人脸检测算法[J].  中国科技信息，2010. 3(3): 50-51 

[22]  余龙华，王宏，钟洪声.基于隐马尔科夫模型的人脸识别[J].  计算机技术与发展，2012, 22(2): 

25-28 

[23] S. Solloway, C. J. Taylor, C. E. Hutchinson, et al. Quantification of articular cartilage from MR 

images using active shape models[M]. Computer Vision—ECCV'96. Springer Berlin Heidelberg, 

1996, 400-411 

[24]  T.  F.  Cootes,  C.  J.  Taylor,  D.  H.  Cooper.  Active  Shape  Models:  Their  Training  and 

Application[J]. Computer Vision and Image Understanding, 1995, 61(1): 38-59 

[25] I. Matthews, S. Baker. Active appearance models revisited[J]. International Journal of Computer 

Vision, 2004, 60(2): 135-164 

[26] T. F. Cootes, G. J. Edwards, C. J. Taylor. Active Appearance Models[C]. European Conference 

on Computer Vision. Freiburg, 1998, 484-498 

[27]  P.  Sauer,  T.  Cootes,  C.  Taylor,  et  al.  Accurate  Regression  Procedures  for  Active  Appearance 

Models[J]. Bmvc, 2011, 1(6): 681-685 

[28]  王科平.基于多特征融合的人脸检测与识别方法[D].  西安：西安电子科技大学，2006, 7-29 

[29]  汪晓妍.基于 ASM 的人脸定位研究[D].  南京：南京信息工程大学，2006, 38-42 

[30]  Imran,  Naseem,  T.  Roberto.  Linear  regression  for  face  recognition[J].  IEEE  Transactions  on 

Pattern Analysis & Machine Intelligence, 2010, 32(11): 2106-2112 

[31]  X.  Cao,  Y.  Wei,  F.  Wen,  et  al.  Face  alignment  by  Explicit  Shape  Regression[C].  IEEE 

Conference  on  Computer  Vision  and  Pattern  Recognition.  IEEE  Computer  Society,  2012, 

2887-2894 

[32]  O.  Jesorsky,  K.  J.  Kirchberg,  R.  W.  Frischholz.  Robust  face  detection  using  the  hausdorff 

distance[C]. Audio and video-based biometric person authentication. Springer Berlin Heidelberg, 

2001, 90-95 

[33]  V.  Le,  J.  Brandt,  Z.  Lin,  et  al.  Interactive  facial  feature  localization[M].  Computer 

Vision–ECCV 2012. Springer Berlin Heidelberg, 2012, 679-692 

[34] L. Liang, R. Xiao, F. Wen, et al. Face alignment via component-based discriminative search[M]. 

Computer Vision–ECCV 2008. Springer Berlin Heidelberg, 2008, 72-85 

[35]  Y.  Weng,  C.  Cao,  Q.  Hou,  et  al.  Real-time  facial  animation  on  mobile  devices  [J].  Graphical 

Models, 2013, 76(3): 172-179 

[36]  杨海燕，蒋新华，聂作先.驾驶员疲劳检测技术研究综述[J].  计算机应用研究，2010, 27(5): 

66 

参考文献 

1621-1624 

[37]  李洪升.基于 ASM 算法的人脸特征点定位研究及应用[D].  南京：东南大学，2009, 5-22 

[38] A. Bosch, A. Zisserman, X. Munoz. Image Classification using Random Forests and Ferns[C]. 

IEEE International Conference on Computer Vision. IEEE Computer Society, 2007, 1-8 

[39] J. H. Friedman. Greedy function approximation: A gradient boosting machine[J]. The Annals of 

Statistics, 2001, 29(5): 1189-1232 

[40]  J.  A.  Tropp,  A.  C.  Gilbert.  Signal  Recovery  From  Random  Measurements  Via  Orthogonal 

Matching Pursuit[J]. IEEE Transactions on Information Theory, 2008, 53(12): 4655-4666 

[41]  彭明超，叶茂，苟群森，等.基于形状参数回归的人脸对齐算法[J].  模式识别与人工智能，

2016, 29(1): 63-71 

[42]  T.  Ojala,  M.  Pietikainen,  D.  Harwood.  A  comparative  study  of  texture  measures  with 

classification based on featured distributions[J]. Pattern recognition, 1996, 29(1): 51-59 

[43] O. Déniz, G. Bueno, J. Salido, et al. Face recognition using histograms of oriented gradients[J]. 

Pattern Recognition Letters, 2011, 32(12): 1598-1603 

[44] X. Xiong, F. D. L. Torre. Supervised descent method and its applications to face alignment[C]. 

Proc of the IEEE Conference on Computer Vision and Pattern Recognition, 2013, 532-539 

[45]  J.  M.  Saragih,  S.  Lucey,  J.  F.  Cohn.  Face  alignment  through  subspace  constrained 

mean-shifts[C]. IEEE International Conference on Computer Vision, 2009, 1034-1041 

[46]  Qu  C,  Gao  H,  Monari  E,  et  al.  Towards  robust  cascaded  regression  for  face  alignment  in  the 

wild[C]. Computer Vision and Pattern Recognition Workshops, IEEE, 2015, 1-9 

[47] P. N. Belhumeur, D. W. Jacobs, D. Kriegman, et al. Localizing parts of faces using a consensus 

of exemplars[J]. IEEE Transactions on Pattern Analysis & Machine Intelligence, 2013, 35(12): 

545-552 

[48]  吴康华.基于 PERCLOSE 的驾驶疲劳检测系统设计[D].  杭州：浙江大学，2008, 17-20 

[49]  杨旭，李国强，陈文革，等.  控制暴露人体实验——眨眼频率测量方法和评价基准的研究

(续二)[J].  环境与健康杂志，2000, 17(2): 106-109 

[50] D. R. Mazumda, S. Dutta, S. Mitra. Automatic Feature Detection of a Face and Recovery of Its 

Pose[J]. Communicated to Journal of IETE, 2009: 505-511 

67 

 
电子科技大学硕士学位论文 

攻读硕士学位期间的成果 

[1]  苟群森，叶茂，彭明超，等.基于安卓的多特征疲劳实时检测方法[P].  中国，发明专利，

201510364426.X, 2015 年 6 月 29 日 

[2]  叶茂，王梦伟，苟群森，等.基于卷积神经网络的车牌检测方法[P].  中国，发明专利，

201410549315.1, 2014 年 10 月 16 日 

[3]  彭明超，叶茂，苟群森，等.基于形状参数回归的人脸对齐算法[J].  模式识别与人工智能，

2016, 29(1): 63-71 

68 

：簾护 ；

： ．ｍＳｐ

义

硕

志患 Ｓｉ

轉 副
滅圆
阔
ｉ
：Ｈ

ｒ ．Ｉ

Ｉ

１


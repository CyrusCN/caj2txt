212

2020，56（20）

Computer Engineering and Applications 计算机工程与应用

工程与应用

⦾
多特征融合的随机森林疲劳驾驶识别算法

⦾

吴士力 1，2，唐振民 1，刘 永 1
1. 南京理工大学 计算机科学与工程学院，南京 210094
2. 南京交通职业技术学院 汽车工程学院 长安福特实验室，南京 211188

摘 要：复杂的交通环境、个人和社会因素制约了疲劳驾驶识别技术的应用效果，提出一种对视频中驾驶员脸部状
态和车辆驾驶状态数据进行融合分析的疲劳驾驶识别算法。该算法基于 Dlib 库提取的人脸轮廓点计算眼和嘴的纵
横比值，生成眯眼和哈欠特征，基于线性拟合趋势提取法生成车辆操控活跃度特征，然后采用改进后的随机森林模

型对疲劳状态进行识别。该模型基于权重对特征的重要性进行评估，提高了树节点分裂的有效性，并给出了森林中

树的数量的调控方法。实验结果表明所提算法的疲劳驾驶识别准确率均值达到了 92.06%，并具有较好的计算效率，
验证了其有效性。

关键词：随机森林；人脸轮廓点；车辆操控活跃度；疲劳驾驶
文献标志码：A 中图分类号：TP391.4

doi：10.3778/j.issn.1002-8331.1907-0392

吴士力，唐振民，刘永 . 多特征融合的随机森林疲劳驾驶识别算法 . 计算机工程与应用，2020，56（20）：212-219.

WU Shili, TANG Zhenmin, LIU Yong. Fatigue driving recognition algorithm using random forest with multi-feature fusion.

Computer Engineering and Applications, 2020, 56（20）：212-219.

Fatigue Driving Recognition Algorithm Using Random Forest with Multi-feature Fusion
WU Shili1，2, TANG Zhenmin1, LIU Yong1
1.School of Computer Science and Engineering, Nanjing University of Technology, Nanjing 210094, China

2.Laboratory of Chang’an Ford, Department of Automobile Engineering, Nanjing Vocational Institute of Transport Technology,

Nanjing 211188, China

Abstract：Complex traffic environment, personal and social factors restrict the application effect of fatigue driving recog-

nition technology. This paper presents a fatigue driving recognition algorithm based on the fusion analysis of driver’s face
state in video and vehicle driving state data. The algorithm calculates the aspect ratio of eyes and mouth based on the

extracted face contour points using Dlib database, and then generates the orbital and yawn features. At the same time, the

vehicle manipulation activity features based on the linear fitting trend extraction method are obtained. The improved ran-

dom forest model is used to identify the fatigue state. The model evaluates the importance of features based on weight,

improves the validity of tree nodes splitting, and gives the method of regulating the number of trees in forest. The experi-

mental results show that the average accuracy of fatigue driving recognition of the proposed algorithm reaches 92.06%,

and it has good computational efficiency meanwhile, which verifies its effectiveness.

Key words：random forest; face contour points; vehicle manipulation activity; fatigue driving

基金项目：国家自然科学基金（No.61305134）。
作者简介：吴士力（1980—），男，博士，高级实验师，研究领域为智能控制系统、模式识别，E-mail：wsl_wushili@163.com；唐振民
（1961—），男，博士，教授，研究领域为模式识别、智能网联汽车控制系统；刘永（1973—），男，博士，教授，研究领域为模

式识别、智能机器人系统。

收稿日期：2019-07-25 修回日期：2019-08-29 文章编号：1002-8331（2020）20-0212-08

CNKI 网络出版：2019-09-16, http://kns.cnki.net/kcms/detail/11.2127.TP.20190916.1034.010.html

吴士力，等：多特征融合的随机森林疲劳驾驶识别算法

2020，56（20）

213

1 引言

疲劳驾驶是一种非常严重的危险驾驶行为。据美
国国家公路交通安全管理局估计，每年因疲劳驾驶导致
的交通事故数占总体的 20%，死亡率占总体的 80%以
上。疲劳驾驶识别方法主要有接触式和非接触式两
类。其中，基于脑电波等生理信息分析的接触式方法虽
然精度高，但应用成本较高，对驾驶员约束大，目前难以
大范围推广[1]。非接触式方法也可以分为两种，一种是
对车辆的行驶特征（如加减速、方向盘操控状况与轨迹
等）进行分析[2-5]。该类方法实现成本低，但复杂多变的
交通环境会明显影响其有效性。另一种是基于机器视
觉技术对驾驶员头部图像进行分析。得益于机器视觉
等人工智能技术的快速发展，该类方法的进步空间大、应
用成本相对较低，已经成为该领域的研究热点。Naz等根
据人脸视频中眼睛、嘴和头部运动特征来识别驾驶员的
疲劳状态 [6]。Mandal 等提出使用 PERCLOS（单位时间
内眼睛闭合所占比例）指标对驾驶员的眼睛状态进行跟
踪分析，使用自适应整合算法评估疲劳驾驶的程度[7]。
Omidyeganeh 等通过 Viola-Jones 算法对视频中驾驶员
的人脸和嘴部进行检测，然后使用反投影理论对驾驶员
嘴巴运动特征进行提取分析来识别哈欠[8]。郭慧利等基
于 Adaboost 算法对 CCD 摄像头采集的图像进行人脸检
测，采用灰度积分投影定位驾驶员的眼和嘴，并对其局
部状态进行监测，基于改进的 D-S 信息融合算法综合判
断疲劳驾驶状态 [9]。刘明周等基于 Adaboost 算法定位
驾驶员面部和手部区域，通过尺度不变特征变换提取区
域的 SIFT 特征点，将生成的特征向量输入三层 BP 神经
网络模型对疲劳驾驶状态进行分级[10]。上述方法具有
较好的疲劳驾驶识别精度，但在实际运用时会受到光
线、穿戴物遮挡等因素的干扰[11]，影响其实际运用效果。
综上所述，车辆操控行为分析和视频分析各有优缺
点，而如能将上述两种方法进行有效融合，弥补各自缺
陷，对提高疲劳驾驶分析与识别效果有积极意义[12]。本
文尝试在现有技术基础上对驾驶员脸部状态和车辆行
驶状态进行疲劳特征提取，通过改进的随机森林算法对
两类特征进行融合建模，从而提高疲劳驾驶识别的准确
率，并在真实道路环境下进行实验以验证其运行效果。

2 人脸疲劳特征
2.1 人脸轮廓特征点

基于人脸特征点对眯眼和哈欠进行检测是识别疲
劳状态的有效手段[13-15]。机器学习工具箱软件 Dlib 提供
了常用的机器视觉分析开源库函数（API）[16- 17]。使用
Dlib 相关 API 可以实时提取人脸 68 个轮廓特征点（如图 1
所示）及其坐标值。
2.2 眯眼行为特征

眯眼一般意义上是指眼部在一段时间内保持闭眼

18 19

20

17

21

22

23

24 25

26

16

15

14

13

12

0

1

2

3

36

38
37
41 40

39

43
47

44
46

45

42

27

28

29

4

5

30
31323334 35

48

49

60

59

52
50 51
63
61 62
67
65
66
58 57 56

53
64 54

55

11

10

6

7

8

9

图 1 人脸轮廓特征点位置

状态的行为。PERCLOS 值是识别眯眼的常用指标，
但其准确率对图像的分辨率依赖性较强，其适用性还
不 够 理 想 [18]。 Soukupová 提 出 了 使 用 眼 睛 纵 横 比 值
（EAR）来判断眼睛的开闭状态[19]。该方法基于眼部 6 个
特征点的坐标来实现，式（1）为图 1 中左眼 EAR 值的计
算过程。

|

EAR =

| p38 - p40
|
该方法只依赖图像中的眼睛轮廓信息，计算过程简洁。

| p37 - p41 +
| p36 - p39
2

|

（1）

由于疲劳时两眼的动作基本保持一致，所以取左右
眼 EAR 值的均值作为人眼的 EAR 值。图 2 所示的是某
视频样本中 EAR 值（归一化后）的变化情况。

值
均
R
A
E

1.0

0.9

0.8

0.7

0.6

0.5

0.4

0.3

0.2

0.1

0

睁眼

眨眼

眨眼

眯眼

20

40

60

80 100 120 140 160 180 200

样本点

图 2 眼部行为的 EAR 值

观察图 2 可知，人眼在各种状态下的 EAR 值都存在
明显波动，这是由人眼眼皮的生理特征导致的。样本中
睁眼时 EAR 值大约在 0.5~0.9 范围内波动，眯眼时 EAR
值大约在 0~0.3 范围内波动，其差别较为明显。虽然眨
眼时 EAR 值的波动范围（大约为 0.1~0.4）和眯眼时 EAR
均值的波动范围有部分重叠，但眨眼的持续时间（大约
为 2~3 个样本点）明显小于眯眼时间（大约为 50 个样本
点）。因此需要从 EAR 值的幅值（纵向）和时间（横向）

214

2020，56（20）

Computer Engineering and Applications 计算机工程与应用

两个维度去分析眼部状态。由于在驾驶过程中 EAR 值
是以数据流的形式存在，为了简化计算过程，本文将单
个时间窗内所有 EAR 值的均值来表征相应时域内 EAR

值的大小情况。时间窗的长度一般根据经验和分析要

求来设定，如时间窗长度太小容易造成把正常眨眼误识

别为眯眼；时间窗长度太大会降低眯眼识别的敏感度和
实时性。图 3 所示的是对图 2 中 EAR 值取时间窗长度
为 20 个样本点时的 EAR 均值情况。

值
R
A
E

1.0

0.9

0.8

0.7

0.6

0.5

0.4

0.3

0.2

0.1

0

EAR 值
EAR 均值

20

40

60

80 100 120 140 160 180 200

样本点

图 3 眼部行为的 EAR 均值

由图 3 可知，眯眼状态对应的连续两个时间窗（范
围为第 81~120 个样本点）内的 EAR 均值都低于 0.3，而
睁眼和眨眼时的 EAR 均值均远大于 0.3。
2.3 哈欠行为特征

哈欠最主要的外观特征是嘴部保持一定时间的大
幅度张开状态[20]。鉴于嘴部和眼部轮廓运动状态的相

似性，本文尝试将眯眼识别方法用于哈欠行为识别，得
到 MAR 值。

MAR =

|

| p2 - p6 +
| p1 - p4
2

| p3 - p5
|

|

（2）

图 4 所示的是某视频样本中嘴部行为的 MAR 值

（归一化后）变化情况。

值
R
A
M

1.0

0.9

0.8

0.7

0.6

0.5

0.4

0.3

0.2

0.1

0

唱歌

说话

哈欠

50

100

150
样本点

200

250

300

图 4 嘴部行为的 MAR 值

值
R
A
M

1.0

0.9

0.8

0.7

0.6

0.5

0.4

0.3

0.2

0.1

0

MAR 值
MAR 均值

50

100

150
样本点

200

250

300

图 5 嘴部行为的 MAR 均值

观察图 5 可知，哈欠时 MAR 均值在连续两个时间
窗内（范围为第 241~280 个样本点）大于 0.9，明显高于
说话与唱歌时的 MAR 均值。

3 车辆驾驶行为特征

相关研究结果表明，驾驶员在疲劳驾驶状态下的变
速和转向操控活跃程度会出现间断性大幅下降的情
况[21]，因此本文提取车辆加减速和转向行为的活跃度作
为疲劳驾驶行为特征值。为了降低正常驾驶状态下车
控数据正常波动产生的干扰，采用先求取车控数据流的
局部变化趋势，再计算活跃度的办法。实现思路是基于
线性拟合提取数据流的变化趋势，然后根据拟合线段的
斜率变化情况以及各样本点与拟合线段间的残差和，计
算相应的车控行为活跃度值。

基于分段线性表示的残差累计算法（Cumulative
Sum of Errors，CUSUM）是数据流线性拟合的有效方
法[22-23]，其基本思路是将数据流 T = {yt1,yt2,⋯,ytn} 按时
间 顺 序 分 割 成 k(k < n) 个 彼 此 相 连 的 子 段 Si = {ytx,
ytx + 1,⋯,ytx + l}, l < n - x, i = 1,2,⋯,k, 即 T = {S1,S2,⋯,
Sk},Si ∩ Sj = ∅,i ≠ j,i,j = 1,2,⋯,k ；然后使用最小二

乘法对各子段进行线性拟合，通过拟合过程中累积的残
差值来评估拟合线段的有效性，其过程如下。
设 ti 时刻信号 yti 的线性拟合值为：
yti' = ks(

)
ti - ts + bs

（3）

其中，ks 是当前拟合线段的斜率，ts 是该线段的起始时
间，bs 是 ts 时刻该线段在 y 轴上的截距，则 ti 时刻拟合
分 段 的 残 差 为 eti = yti' - yti ，则 ti 时 刻 的 累 积 残 差 为
i

cusumti = cusumti - 1 + eti = ∑

etk 。在任意时刻 ti ，将累积

k = s
残差值 cusumti 和阈值 th1 和 th2（通常设 th2 = 3th1）进
行比较：

若

| cusumti ≤ th1 ，则认为当前拟合分段合理；

|

若 th1 <

| cusumti < th2 ，则把 ti 时刻以后产生的数

|

取 20 个样本点为滑动时间窗长度，则图 4 中 MAR

据存储在缓存中；

值的均值情况如图 5 所示。

若| cusumti | ≥ th2 ，则需要对缓存中的数据进行重

吴士力，等：多特征融合的随机森林疲劳驾驶识别算法

2020，56（20）

215

新拟合，然后将 cusumti 重置为 0，并清空缓存。

基于所得拟合线段 yt' ，通过式（4）获得数据流 T

4 疲劳驾驶特征融合与识别算法
4.1 特征抽取与融合

在某时域内（样本点数量为 p）的活跃度 AT ：

基于上述工作生成表征驾驶员疲劳驾驶状态的 10

AT =

æ
ç
ç
çç
è

c

∑

m = 1

(

km - kˉ 2
)

c - 1

ö
÷
÷
÷÷
ø

×

+ 1

p

|
||∑
|

i = 1

|
||
|

eti

维特征向量，其物理意义如表 1 所示。

（4）

表 1 疲劳驾驶行为特征

其中，c 为时域内拟合线段的个数，km 为某拟合线段的
斜率，kˉ 为时域内所有拟合线段斜率的均值。 AT 值越
大表明时域内数据流的活跃度越大，反之越小。将上述

算法分别应用于油门踏板位置信号与方向盘转角信号数
据流（其采用等间隔采样方式生成，采样频率为 10 Hz），
由式（4）得到油门操控活跃度 Aap 和方向盘操控活跃度

Asw 。图 6 所示的是某测试样本的活跃度变化情况。

值
号
信
置
位
板
踏
门
油

1.2

1.0

0.8

0.6

0.4

0.2

0

－0.2

值
号
信
角
转
盘
向
方

1.0

0.8

0.6

0.4

0.2

0

－0.2

Aap = 75.5

Aap = 93.6

原始信号
拟合线段

Aap = 0

0 20

40 60

80 100 120 140 160 180 200

样本点

（a）油门操控活跃度计算过程

原始信号
拟合线段 Asw = 57.1

Asw = 14.6

Asw = 0.3

0 20

40

60

80 100 120 140 160 180 200

样本点

（b）方向盘操控活跃度计算过程

图 6 操控活跃度计算过程

观察图 6（a）可知，驾驶员分别在样本点 36~60 和
85~165 区域内进行了加速操作，样本点时域 30~50 和
140~160 区 域 内 的 活 跃 度 值 Aap 分 别 达 到 了 75.5 和

93.6，而在样本点区域 60~80 内驾驶员没有任何油门动
作，所以活跃度值 Aap 为 0。观察图 6（b）可知，驾驶员在

样本点时域 70~90 范围内没有明显的转向操作，活跃度
值 Asw 为 0.3，明显低于转向操作期的活跃度值。此外，
由于车辆上普遍采用制动开关来获取驾驶员的制动行

特征名称

EAR 均值

特征代码

EAR_Mean

EAR 持续时间

EAR_Time

EAR 频率

MAR 均值

EAR_Freq

MAR_Mean

MAR 持续时间

MAR_Time

MAR 频率

MAR_Freq

特征意义

眯眼幅度

眯眼持续时间

眯眼累计次数

哈欠幅度

哈欠持续时间

哈欠累计次数

油门活跃度

方向盘活跃度

制动开关值

SWP

Aap

Asw

Bs

SWP

油门踏板操纵活跃度

方向盘操纵活跃度

制动状态

驾驶员生理疲劳状态

表 1 中的 SWP（Sleep Wake Predictor）是衡量驾驶
员生理疲劳状态的重要特征之一，其值基于人在每天各
时段的清醒状态图来计算[24]，具体的计算方法为：

SWP = 10.9 - 0.6(S + C + U)
ö
÷
÷
÷÷
ø

θ1 - 14
θ1 - 7.96
8

æ
ç
ç
çç
è
)
θ1 - θ2 e

æ
ç
è

ö
÷
ø

lg

其中，S = θ1 - (

dt

（5）

，该值用于表征驾驶员

睡醒后到当前时间的清醒程度；C = θ3 + 2.5 × cos

æ
çæ
è
è

ç

÷π
ö
ø
12

(t - θ4) ，该值为人的作息生理周期指数，U = 0.5 × cos

)

æ
çæ
è
è

ç

÷π
ö
ø
6

×

×

)

(t - (θ4 + 3) ，该值为人体日节律指数，θ1 为清醒状态图
中渐近线对应横轴坐标 2.4 的纵轴坐标值，θ2 为驾驶员
的睡眠开始时刻，θ3 为中位值，θ4 为相位。

为了降低交通环境对疲劳驾驶识别的干扰，并降低
系统计算量，采用两阶段模式生成疲劳特征向量。第一
阶段只监测驾驶员人脸疲劳部分特征，当检测到疑似疲
劳时才进入第二阶段，该阶段生成时域内所有疲劳驾驶
特征，并调用指定模型实现疲劳驾驶识别，整个算法过
程为：

/*第一阶段：*/
while（1）
{

将当前时间窗内的数据流（ear、mar、油门踏板位置

信息、方向盘转角信号）存入缓存

/*检测眯眼和哈欠*/
if EAR_Mean<th_ear||MAR_Mean>th_mar

flag=1

//标记

if （EAR_Mean>th_ear||MAR_Mean<th_mar） && flag
{

flag=0

/*第二阶段：生成疲劳驾驶特征*/
Get：

为，而其信号类型为开关量，所以不需进行线性拟合。

EAR_Time

216

2020，56（20）

Computer Engineering and Applications 计算机工程与应用

MAR_Time

EAR_Freq

MAR_Freq

Aap

Asw

Bs

SWP

/*调用疲劳驾驶识别模型函数*/

do_fatigue_analysis（）
}

清空缓存

}

其中 th_ear 和 th_mar 分别为眯眼和哈欠阈值。
4.2 随机森林疲劳驾驶识别算法

疲劳驾驶是一种状态的渐变过程，一般可以根据其
程度分为清醒、轻度疲劳、重度疲劳三种状态。因此，疲
劳驾驶识别本质上是一个分类问题。文献[25]对现有
主流分类器在疲劳驾驶领域的应用性能进行了研究，发
现随机森林算法的准确率、鲁棒性较好，计算效率高，且
能够适应小样本的训练环境。

随机森林在结构上由若干决策树组成，决策树的质
量和数量都对其性能有重要影响。决策树的常用训练
思路是采用 Bootstrap 算法生成样本集，再随机抽取出特
征子集，然后基于信息熵对节点进行分裂。应用随机策
略虽提高了模型的泛化能力，但没有考虑特征的重要
性，使得重要性较小的特征也可能被优先选中，从而会
影响建模精度[26]。文献[27]提出了通过增加重要特征被
选中的机率来提高随机森林性能的方法，但是该方法会
减少待选特征的数量，不利于准确率的提高。而对于随
机森林的规模问题，合适的决策树数量能让随机森林在
准确率和计算效率间取得较好的平衡，树的数量太少会
降低随机森林的分类精度，过多会影响识别效率，一般
依赖经验和反复实验来确定[28]。

本文提出一种基于特征权重的随机森林构建方法
（Random Forest based Weights of Features，RFWF），
该方法基于特征在森林中的权重来控制树的构建和数
量，以此提高疲劳驾驶状态识别的有效性。

设疲劳驾驶特征向量 ti = (tij),j = 1,2,⋯,w ，由表 1
取 w = 10 。 其 组 成 的 样 本 集 T = {
(ti,ci) ,i = 1,2,⋯,
m,ci 为 ti 对应的疲劳驾驶状态类别，用 tij 对应随机森

}

林中树 τ 上的节点 nj ，则 pj( )c =

Nd
Nc

是该节点相对于

疲劳驾驶状态类别 c 的先验概率。其中 Nc 是类别为 c
的样本总数，Nd 为符合 tij > Tha 的疲劳样本数量，Tha
为阈值。基于 pi(c) 可得节点 ni 的熵为：

E = ∑

∀c

pi(c)ln 1

pi( )c

（6）

若用 tij 分裂节点 nk ，其左右孩子的熵分别为 El 和

Er 。定义 Q(
可行性（Q(

)
i,k = e
)

描述特征 tij 分裂节点 nk 的
i,k 值越大则可行性越大）。定义特征 tij 的

-(El + Er)

初始权重为：
N

ωτ(

)tij =

∑

i = 1

Q(

i,k

)

Nt

（7）

其中，Nt 是树 τ 中的节点数量。显然，wτ(tij) 值越大则
表明用特征 j 进行分裂的效果越好。设 δτ 为用袋外数
据（Out of Bag，OOB）在树 τ 上的分类错误率，通过：

γτ =

1
δτ
æ
ç
è

max
τ

1
δτ

ö
÷
ø

（8）

来衡量树 τ 的分类效果，γτ 值越大表示树 τ 的分类错误
越少。疲劳驾驶特征 tij 在随机森林中的全局权重为：

ω(

)tij =

ωτ( )tj /γτ

∑
(∑

∀τ
max
j

∀τ

ωτ( )j /γτ)

（9）

基于 ω(tij) 对特征 tij 的重要性进行评估。通过阈值
)
ω( )tj > Thω 和
α 和 C 0
β 分

α (
Thω 将所有特征分为重要特征集合 V 0
β (
非重要特征集合 V 0

)
ω( )tj < Thω 两部分，C 0

α -

α 和 V n

β - C n

α, vn = C n
r 为从 V n

α 和 C n
α, ∆v = C n + 1

β 。记 un = C n
β 。设 V n

β, 则有 ∆u = C n + 1
α ∪ V n
r 且 tj ∈ V n

别为其基数。在构建树的迭代过程中对两个集合进行
更新，第 n 次迭代后可得特征集合 V n
β ，其基数分
别为 C n
C n
的特征集合，如满足特征 tj ∈ V n
α ，则认为 tj
对节点的分裂是合适的。易知，获得该合适分裂的最小
概率就是从 V n
α 的概
率 ，并 将 其 记 为 q ，则 r = 1 - q 为 V n
tj ∈ V n
包含非重要特征，所以 r 的最大值为 rmax = æ
è

α 的概率。由于在树的构建过程中 V n
ö
÷v
ø
w

r 中 不 包 含 特 征
β 中也可能
/æ
è

r 中挑选出至少一个特征 tij ∈ V n

β 中随机选择

u + v
w

ç

ç

÷

对 于 一 个 包 含 B 棵 树 的 随 机 森 林 F ，令 qu = -
qv = - ∂r
∂v

，则有：

=

qu ≈ -

∆r
∆u

)
)
u + v !

v!(
u + v - 1 - w !w
)
(
v - f !(
v - 1 !(
)
(
u + v - 1 - w !uw
)
(
)
u + v - 1 !(
)
v - f !(
设一棵有 Nav 个节点的树 τ ，其所有节点都被合适

)
u + v

∆r
∆v

qv ≈ -

=

（10）

（11）

分裂的概率为 q

Nav ，定义：
τ(
)
(
ö
÷B
1 - q
ø
τ

Nav

q

B æ
φF = ∑
ç
è

τ = 1

B - τ

Nav

)

= 1 - (

1 - q

Nav

B

)

（12）

来表征 F 中至少一棵树 τ 中所有节点都被合适分裂的
概率。则 F 中任一树对 (
)
τx,τy 所有的 Nav 对节点中至
少有一个疲劳驾驶特征 tij 在 V n
r 中的概率为：

ö
ø
∂q
∂u

。

，

吴士力，等：多特征融合的随机森林疲劳驾驶识别算法

2020，56（20）

217

Nav

（13）

æ
ç
è

ö
÷
ø

æ
ç
è

ö
÷
ø

1 -

ρ =

æ
ç
ç
çç
ç
ç
è

u + v - w
w
u + v
w

ö
÷
÷
÷÷
÷
÷
ø
显然 ρ ≪ 1 ，则可得树对 (
τx,τy 中至少有一对节点特征
在 V n
r 中的概率为：
æ
çç
è

φp = ∑

= 1 - (

1 - ρ

1 - ρ

B
2
τ

ρτ(

ö
÷÷
ø

B
2

B
2

B
2

- τ

)

)

)

（14）

τ = 1

鉴于树 τ 中节点被有效分裂的概率越高（即 φF 值
越大），且非重要特征被分类的概率越低（即 φp 值越

大），则森林 F 的分类精度越高。定义随机森林 F 对疲
劳驾驶状态分类的准确率为：
B
φF - φp = εæ
)
è

φ = ε(

(
1 - ρ

2 - (

1 - q

（15）

ö
ø

Nav

)

)

B

ç

÷

其中 ε 为常数因子。

记 ∆B 为 随 机 森 林 F 中 B 的 变 化 量 ，有 dφ ≈

v∆B + lqu∆u + lqv∆v ,l = BNavq

ε(
上述分析可知 qu > 0 ，qv < 0 ，l > 0 ，∆v < 0 ，则只需使

1 - q

。由

Nav

)

Nav - 1(

B - 1

)

∆u ≥ 0 ，且 满 足 0 < ∆B <

lqu∆u + lqv∆v
v

，可 使 dφ > 0

成立，从而保证随机森林 F 的分类正确率在训练中不
断提高。

基于上述分析，RFWF 算法的基本流程如下：
1. 构建一个规模为 B0 的初始随机森林 F0 ；
2. 计算每棵树的权重 ωτ(⋅) ；
3. 生成 V 0

α 和 V 0

β ；

4. n = 0 ；
5.while (vn > w) {
α 和 V n + 1
计算 V n + 1

β

计算 ∆u 和 ∆v

计算 ∆B

if

(∆B > 0 && ∆B <

lqu∆u + lqv∆v
v

) {

Bn + 1 = Bn + ∆B

用 Bn + 1 更新随机森林 Fn + 1

}

n ++
}

图 7 实验平台安装位置

线电缆与 OBD 接口相连。Tx2 开发板通过 USB 接收摄
像头采集的驾驶员头部图像，采样速率为 10 帧/s；通过
CAN 总线读取相关车辆行驶数据（如车速、油门踏板角

度、方向盘转角、制动状态、行车时间等），采样速率为
10 Hz。为了便于测试和监控系统的疲劳驾驶识别效
果，设计了图形界面来展示系统工作过程，如图 8 所示。

（a）清醒状态

（b）疲劳状态

图 8 系统运行状态显示界面

图 8 中分别显示了人脸特征点的实时提取效果以

上述算法生成的随机森林可以对采集的疲劳驾驶

及车速、转向角度和制动状态（绿色表示无制动操作，红

样本进行状态识别。

5 实验
5.1 实验平台与样本设计

实验平台主要由中央控制单元、摄像头和 CAN 总
线电缆等设备组成，其在实验车上的安装位置如图7所示。
图 7 中，中央控制单元采用了英伟达 Tx2 开发板平
台，摄像头采用了 500 万像素红外单目摄像头，CAN 总

色表示制动操作）共三种车辆行驶状态信息。

招募了 62 名驾驶员志愿者（男 43 名，女 19 名），年
龄范围为 21~45 岁。实验地点位于南京市江宁大学城

福英路部分空旷路段。考虑到安全性，疲劳状态采用人
为模拟方式，共采集了 900 个清醒驾驶样本（含 450 个干
扰样本，其中包含了唱歌、交谈、揉眼睛等场景）、650 个
轻度和 550 个重度疲劳驾驶样本（参数如表 2 所示），单
个疲劳样本的持续时间范围为 3~8 min。

218

2020，56（20）

Computer Engineering and Applications 计算机工程与应用

表 2 疲劳样本参数

参数名称

眯眼次数

单次眯眼持续时长

哈欠次数

单次哈欠持续时长

参数值范围
1~5 次
2~6 s
1~3 个
5~11 s

阈值 th_ear 和 th_mar 取所有疲劳样本中眯眼状态
和哈欠状态下的均值。分别用数字“0”“1”“2”作为清
醒、轻度疲劳和重度疲劳三类样本的标签值。
5.2 实验分析

按 5∶1 比例随机生成训练样本集和测试样本集。
图 9 所示是某次训练生成的任一单棵决策树的结构，其
中显示了每个节点对应的特征及其阈值范围。

> 0.24

EAR_
Mean

EAR_
Time

> 37

Asw

< 8.94

≥ 8.94

> 4

≤ 37

EAR_
Freq

≤ 4 > 192

≤ 0.24

MAR_
Mean

> 0.65

MAR_
Time

≤ 0.65

0

≤ 192

0

Aap

0

< 7.03

≥ 7.03

0

SWP
< 11.2 ≥ 11.2 > 2

MAR_
Freq

≤ 2

Bs

0

2

1

SWP

0

= 1

2

= 0

1

< 11.2

≥ 11.2

1

0

图 9 决策树结构

观察图 9 可知，人脸疲劳特征的重要性高于车辆操

控行为特征，导致其对应节点先于后者分裂。

将 RFWF 的准确率和树的数量之间的对应情况与
传统随机森林（RF）进行比较。为了便于分析多特征融
合对疲劳驾驶识别的影响，使 RF 中树的数量与 RFWF
保持一致，将基于 10 维疲劳驾驶行为特征向量（见表 1）
生成的样本输入 RFWF 和 RF，得到的准确率值分别记
为 RFWF（10）和 RF（10）；从上述样本中去除特征 Aap、
Asw、BS 和 SWP 后得到 6 维驾驶行为特征向量样本，输
入 RFWF 和 RF 后得到的准确率值分别记为 RFWF（6）
和 RF（6），实验结果如图 10 所示。

92

90

88

86

84

82

80

78

/

%
率
确
准

76

20

RFWF（10）
RF（10）
RFWF（6）
RF（6）

30

40

50
树的数量

60

70

80

图 10 RFWF 与 RF 比较结果

观察图 10 可知，基于 10 维特征向量的疲劳驾驶识
别精度明显高于基于 6 维人脸疲劳特征的识别精度，这
表明了多特征融合策略在疲劳驾驶识别领域的有效
性。在 10 维特征向量样本集上，RFWF 的准确率随着树
的数量的增加而提高，当树的数量为 74 棵时，准确率达
到最高值（91.7%）。RF 的准确率虽然也随着树的数量
的增加而提高，但在达到 90.1%后（65 棵）出现了下降，
这主要是因为特征的随机选取以及树的数量的不确定
性影响了其准确率。

按五折交叉法将 RFWF 的运行性能和传统随机森
林（RF）、SVM、径向基神经网络（RBF）、贝叶斯分类（BC）
等模型进行比较。其中，RF 模型采用的是融合 SVM 的
随机森林算法[29]，SVM 模型采用的是 PSO-SVM 算法[30]，
RBF 模型采用的是 SOM 算法[31]，BC 模型采用的是基于
PCA 的贝叶斯模型[32]。考虑到疲劳驾驶系统的实时性
要求，除了准确率外还有必要考察其运行时模型的单次
识别过程（即第二阶段中 do_fatigue_analysis 函数的运
行时间）的耗时情况。测试结果如表 3 所示（A0 为清醒
状态的平均识别准确率、A1 为轻度疲劳状态的平均识
别准确率、A2 为重度疲劳状态的平均识别准确率、Av 为
上述三种状态的平均识别准确率）。

表 3 各模型的疲劳驾驶识别结果

模型

SVM

RBF

BC

RF

RFWF

A0

85.64

85.62

86.07

86.25

87.34

准确率/%

A1

87.75

87.23

88.31

88.40

89.18

A2

94.84

95.56

94.18

96.94

99.66

Av

89.41

89.47

89.52

90.53

92.06

耗时/ms

35

97

38

39

40

从测试结果看，基于随机森林算法的疲劳驾驶识别
平均准确率要高于其他几种分类模型 1 个百分点左
右。得益于特征选取和树的数量控制两方面的优化，
RFWF 的平均准确率又比 RF 高出 1.53 个百分点。同时
注意到，各模型对于清醒和轻度疲劳状态的识别准确率
明显低于重度疲劳的准确率，这主要是因为重度疲劳特
征较为明显，而其余两种状态容易受到各种环境和事件
因素干扰。从模型的运行耗时看，RFWF 的运行耗时和
其他分类器相比也处于较低水平，有利于疲劳驾驶识别
系统的实时性。

6 结束语

本文提出一种融合了驾驶员脸部疲劳特征和车辆
操控疲劳特征的疲劳驾驶识别算法。该方法对传统随
机森林进行了优化，改进了其特征选取策略和树的数量
的评估方法，提高了模型的识别效果。在实车上采集的
2 100 个样本上的平均准确率均值达到 92.06%，高于其
他分类模型。基于所提算法设计的车载疲劳驾驶系统
能够以较低的成本安装在实车上，具有较好的应用前景。

吴士力，等：多特征融合的随机森林疲劳驾驶识别算法

2020，56（20）

219

参考文献：
[1] Barry R J，De Blasio F M.EEG differences between eyes
closed and eyes-open resting remain in healthy ageing[J].
Biological Psychology，2017，129：293-304.

[2] Fugiglando U，Massaro E，Santi P，et al.Driving behavior
analysis through CAN bus data in an uncontrolled envi-

ronment[J].IEEE Transactions on Intelligent Transporta-
tion Systems，2019，20（2）：737-748.

[3] 屈肖蕾 . 基于转向操作和车辆状态的疲劳驾驶检测方法研

究[D]. 北京：清华大学，2012.

[4] Chang T H，Hsu C S，Wang C.Onboard measurement and
warning module for
irregular vehicle behavior[J].IEEE
Transactions on Intelligent Transportation Systems，2008，
9（3）：501-513.

[5] 贾丽娟 . 基于实车方向盘操作特征的疲劳驾驶检测方法研

究[M]. 北京：清华大学，2017.

[6] Naz S，Ahmed A，Mubarak Q，et al.Intelligent driver safety
system using fatigue detection[C]//International Conference
on Advanced Communication Technology，2017：89-93.
[7] Mandal B，Li L，Wang G S.Towards detection of bus
fatigue based on robust visual analysis of eye

driver

state[J].IEEE Transactions on Intelligent Transportation
Systems，2017，18（3）：545-557.

[8] Omidyeganeh M，Shirmohammadi S，Abtahi S，et al.Yawn-
ing detection using embedded smart cameras[J].IEEE
Transactions on Instrumentation and Measurement，2016，
65（3）：570-582.

[9] 郭慧利，王恁，郭浩，基于面部多特征的疲劳驾驶预警系统

的研究[J]. 通信学报，2018，39（1）：22-29.

[10] 刘明周，蒋倩男，扈静 . 基于面部几何特征及手部运动特

征的驾驶员疲劳检测[J]. 机械工程学报，2019（2）：18-26.

[11] Mandal B，Li L Y，Wang G S.Towards detection of
bus driver fatigue based on robust visual analysis of

eye state[J].IEEE Transactions on Intelligent Transpor-
tation Systems，2016，18（3）：545-557.

[12] Sun W，Zhang X R，Peeta S，et al.A real-time fatigue
driving recognition method incorporating contextual fea-

tures and two fusion levels[J].IEEE Transactions on Intel-
ligent Transportation Systems，2017，18（12）：3408-3420.

[13] Lei Jianmei，Han Qingwen，Chen Lei.A novel side face
contour extraction algorithm for driving fatigue statue
recognition[J].IEEE Access，2017，5：5723-5730.

[14] 邹昕彤，王世刚，赵文婷，等 . 基于眼睛与嘴部状态识别的
疲劳驾驶检测[J]. 吉林大学学报，2017，35（2）：204-211.
[15] Lopar M，Ribarić S.An overview and evaluation of var-
ious face and eyes detection algorithms for driver fatigue

monitoring systems[C]//Proceedings of the Croatian Com-
puter Vision Workshop，2013：15-18.

[16] He K，Zhang X，Ren S，et al.Deep residual

learning for

image recognition[C]//2016 IEEE Conference on Com-
puter Vision and Pattern Recognition（CVPR），2016.
[17] Zhang Fang，Su Jingjing，Geng Lei，et al.Driver fatigue

detection based on eye state recognition[C]//2017 Inter-
national Conference on Machine Vision and Informa-
tion Technology（CMVIT），2017.

[18] 李建平，牛燕雄，杨露，等 . 基于人眼状态信息的非接触式
疲 劳 驾 驶 监 测 与 预 警 系 统 [J]. 激 光 与 光 电 子 学 进 展 ，
2015，52（4）：1101-1106.

[19] Soukupová T，Cech J.Real-time eye blink detection using
facial landmarks[C]//21st Computer Vision Winter Work-
shop，2016.

[20] 马素刚，赵琛，孙韩林，等 . 一种基于卷积神经网络的哈欠

检测算法[J]. 计算机科学，2018，45（6A）：226-229.

[21] 贾硕，惠飞，马峻岩，等 . 商用车辆异常驾驶行为检测算法

研究[J]. 公路交通科技，2017，34（2）：29-36.

[22] Wu Shili，Tang Zhenmin，Guo Zhaosong.Lightweight mix-
ture faults detection method for gasoline engine using
on- line trend analysis[J].International Journal of Auto-
motive Technology，2017，18（3）：365-375.

[23] Charbonnier S.On line extraction of temporal episodes
for
from ICU high frequency data：a visual support
signal
interpretation[J].Computer Methods and Programs
in Biomedicine，2005，78：115-132.

[24] Åkerstedt T，Connor J，Gray A，et al.Predicting road
crashes from a mathematical model of alertness regula-
tion- the sleep/wake predictor[J].Accident Analysis &
Prevention，2018，40（4）：1480-1485.

[25] Martensson H，Keelan O，Ahlstrom C.Driver sleepiness
classification based on physiological data and driving perfor-
mance from real road driving[J].IEEE Transactions on Intel-
ligent Transportation Systems，2019，20（2）：421-430.
[26] Montillo A，Shotton J，Winn J，et al.Entangled decision
forests and their application for semantic segmentation
of CT images[C]//22nd International Conference on Infor-
mation Processing in Medical Imaging，2011：184-196.

[27] Paul A，Mukherjee D P，Das P.Improved random forest
for classification[J].IEEE Transactions on Image Process-
ing，2018，27（8）：4012-4024.

[28] Oshiro T M，Perez P S，Baranauskas J A.How many
trees in a random forest[C]//International Workshop on
Machine Learning and Data Mining in Pattern Recog-
nition，2012：154-168.

[29] 薛峰，朱强，林楠 . 结合改进的 SVM 和随机森林算法车标
分类识别[J].计算机工程与设计，2017，38（12）：3425-2430.
[30] Ardjani F，Sadouni K.Optimization of SVM multiclass
by particle swarm（PSO-SVM）[J].IEEE Transactions on
Geoscience and Remote Sensing，2007，45（6）：1887-1895.
[31] Chen Z Y，Kuo R J.Combining SOM and evolutionary
computation algorithms for RBF neural network train-
ing[J].Journal of Intelligent Manufacturing，2019，30（3）：
1137-1154.

[32] Wang Yazhen，Liu Yi，Khan F.Semiparametric PCA and
Bayesian network based process fault diagnosis tech-
nique[J].The Canadian Journal of Chemical Engineering，
2017，95（9）：112-123.


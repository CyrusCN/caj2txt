天津科技大学研究生学位论文(申请硕士学位)基于多特征因素的疲劳驾驶检测方法的研究RESEARCHONFATIGUEDRIVINGDETECTIONMETHODBASEDONMULTIFEATUREFACTORS专业名称：仪器科学与技术指导教师：李建良副教授研究生姓名：田垚申请学位级别：工学硕士论文提交日期：2022年6月分类号：TP391.学校代码：10057密级：公开研究生学号：19809010基于多特征因素的疲劳驾驶检测方法的研究ResearchonFatigueDrivingDetectionMethodBasedonMultiFeatureFactors专业名称：仪器科学与技术指导教师姓名：李建良副教授研究生姓名：田垚申请学位级别：工学硕士论文提交日期：2022年6月论文课题来源：横向项目学位授予单位：天津科技大学I摘要随着人民经济水平的提高，道路上的车辆不断增加，与此同时交通事故的发生率也在逐渐增多。根据调查显示，导致交通事故的主要原因之一是疲劳驾驶，驾驶员因长时间驾车会产生疲劳状态，轻度疲劳会使驾驶员的视野变得狭窄，漏看道路信息，严重者丧失驾驶能力，威胁驾驶员的生命安全。为了提醒驾驶员正确驾驶，减少交通事故的发生，一种高效精确的疲劳驾驶预警系统对于安全出行必不可少。本文主要研究基于多特征因素的疲劳驾驶检测的方法，用摄像头实时采集驾驶员的状态信息，利用计算机视觉技术对面部特征和头部姿态进行分析，结合驾驶员眨眼、哈欠、瞌睡点头等生理特征判断驾驶员的疲劳状态。本文主要研究内容如下：（1）疲劳检测系统主要利用计算机视觉技术采集驾驶员面部及头部疲劳特征，首先通过OpenCV从摄像头或本地视频中提取视频帧，循环视频帧提取每一帧的图像，扩大图片的维度、将图片灰度化处理，结合图像特征提取算法进行人脸识别和检测，实时定位和跟踪视频中驾驶员头部的位置，将面部特征信息转化为数组信息，并检测出人脸轮廓的68个关键点坐标。（2）根据面部68个关键点定位驾驶员面部眼、嘴坐标位置，计算面部眼睛、嘴部轮廓横纵欧式距离，设定眨眼和哈欠阈值，循环视频帧统计驾驶员眨眼和哈欠的次数，通过单位时间内眨眼或哈欠的次数来设定眼睛和嘴部的疲劳阈值，判断驾驶员是否属于眨眼和哈欠的疲劳状态。（3）建立空间坐标系，将人脸2D的关键点坐标与3D人脸模型关键点匹配，求解人脸在世界坐标与像素坐标之间的转换关系，求出坐标变换之间的转换矩阵即旋转矩阵和平移矩阵，通过旋转矩阵计算出头部空间运动的欧拉角，根据头部运动的角度设定瞌睡点头的阈值，统计瞌睡点头的视频帧数，判断驾驶员是否处于疲劳状态。本文通过分析面部特征和头部姿态等疲劳因素判断驾驶员的疲劳状态，最后在复杂的环境中测试实验准确率达到95%以上，验证系统的稳定性和抗干扰能力，并采集不同人脸进行疲劳测试依然能检测出疲劳状态，验证系统的有效性，综上疲劳检测系统可以准确的检测出驾驶员的疲劳状态，并且算法具有较强的鲁棒性。关键词：PHOG检测算法；关键点检测；面部特征；头部姿态IIABSTRACTWiththeimprovementofpeople'seconomiclevel,thenumberofvehiclesontheroadisincreasing.Atthesametime,theincidenceoftrafficaccidentsisalsoincreasinggradually.Accordingtothesurvey,oneofthemaincausesoftrafficaccidentsisfatiguedriving.Driverswillbetiredduetodrivingforalongtime.Mildfatiguewillnarrowthedriver'svision,Missroadinformation,seriouslylosedrivingabilityandthreatenthedriver'slifeandsafety.Inordertoreminddriverstodrivecorrectlyandreducetrafficaccidents,anefficientandaccuratefatiguedrivingearlywarningsystemisessentialforsafetravel.Thispapermainlystudiesthemethodoffatiguedrivingdetectionbasedonmultifeaturefactors.Thecameraisusedtocollectthedriver'sstateinformationinrealtime,andthecomputervisiontechnologyisusedtoanalyzethefacefeaturesandheadposture.Thedriver'sfatiguestateisjudgedincombinationwiththedriver'sphysiologicalcharacteristicssuchasblinking,yawning,dozingandnodding.Themainresearchcontentsofthispaperareasfollows:(1)Thefatiguedetectionsystemmainlyusescomputervisiontechnologytocollectthefatiguecharacteristicsofthedriver'sfaceandhead.Firstly,thevideoframeisextractedfromthecameraorlocalvideothroughopencv,theimageofeachframeisextractedfromthecyclicvideoframe,thedimensionoftheimageisexpanded,theimageisgrayed,andthefacerecognitionanddetectionarecarriedoutincombinationwiththeimagefeatureextractionalgorithmtolocateandtrackthepositionofthedriver'sheadinthevideoinrealtime,Thefacialfeatureinformationistransformedintoarrayinformation,andthecoordinatesof68keypointsoffacecontouraredetected.(2)Locatethedriver'sfacialeyeandmouthcoordinatepositionsaccordingtothe68keypointsoftheface,calculatethehorizontalandverticalEuclideandistanceofthefacialeyeandmouthcontour,settheblinkandyawnthreshold,cyclethevideoframetocountthedriver'sblinkandyawntimes,setthefatiguethresholdoftheeyesandmouththroughtheblinkoryawntimesintheunittime,andjudgewhetherthedriverbelongstothefatiguestateofblinkandyawn.(3)Establishaspatialcoordinatesystem,matchthe2Dkeypointcoordinatesofthefacewiththe3Dkeypointofthefacemodel,solvethetransformationrelationshipbetweentheworldcoordinatesandpixelcoordinatesoftheface,andcalculatethetransformationmatrixbetweenthecoordinatetransformations,namelytherotationmatrixandtranslationmatrix.CalculatetheEulerangleoftheheadspacemotionthroughtherotationmatrix,setthethresholdofnoddingaccordingtotheangleofheadmotion,andcountthenumberofvideoframesofnodding,Judgewhetherthedriverisinfatiguestate.IIIInthispaper,thefatiguestateofthedriverisjudgedbyanalyzingthefatiguefactorssuchasfacialfeaturesandheadposture.Finally,theaccuracyofthetestinacomplexenvironmentismorethan95%,whichverifiesthestabilityandanti-interferenceabilityofthesystem.Differentfacesarecollectedforfatiguetest,whichcanstilldetectthefatiguestateandverifytheeffectivenessofthesystem.Inconclusion,thefatiguedetectionsystemcanaccuratelydetectthefatiguestateofthedriver,Andthealgorithmhasstrongrobustness.Keywords:PHOGdetectionalgorithm,Keypointdetection,Facialfeatures,Headposture目  录 1 绪论 ......................................................................................................... 1 1.1 研究背景和意义 ............................................................................... 1 1.2 人脸检测识别研究现状................................................................... 2 1.2.1 人脸检测识别国内外现状 ......................................................... 2 1.2.2 人脸检测识别常用方法 ............................................................. 3 1.2.3 人脸检测识别存在的问题 ......................................................... 5 1.3 疲劳驾驶检测研究现状................................................................... 5 1.3.1 传统疲劳驾驶检测的发展 ......................................................... 7 1.3.2 计算机视觉疲劳驾驶检测的发展 ............................................. 8 1.4 主要研究内容 ................................................................................... 9 2 疲劳检测系统概述及人脸检测原理 .................................................. 11 2.1 疲劳驾驶检测系统概述................................................................. 11 2.1.1 疲劳驾驶检测系统简述 ........................................................... 11 2.1.2 疲劳驾驶检测系统的设计原理 ............................................... 12 2.2 人脸识别与检测算法 ..................................................................... 13 2.2.1 图像特征提取算法 ................................................................... 13 2.2.2 疲劳检测算法原理 ................................................................... 17 2.2.3 人脸的 68 个关键点定位 ....................................................... 19 2.3 实验检测结果 ................................................................................. 21 2.4 本章小结 ......................................................................................... 21 3 面部眼、嘴检测与疲劳判定 .............................................................. 22 3.1 人眼检测与疲劳判定 ..................................................................... 22 3.1.1 人眼定位 ................................................................................... 22 3.1.2 眨眼阈值EAR的设定 ............................................................. 23 3.1.3 眨眼疲劳阈值的设定 ............................................................... 23 3.1.4 实验结果分析 ........................................................................... 24 3.2 人嘴部检测与疲劳判定................................................................. 25 3.2.1 人嘴部定位 ............................................................................... 26 3.2.2 哈欠阈值MAR的设定............................................................ 26 3.2.3 哈欠疲劳阈值的设定 ............................................................... 27 3.2.4 实验结果的分析 ....................................................................... 28 3.3 本章小结 ......................................................................................... 29 4 人头部检测与疲劳判定 ...................................................................... 30 4.1 计算机视觉四大坐标系................................................................. 30 4.2 人头部检测与疲劳判定................................................................. 33 4.2.1 世界坐标与图像坐标的转换 ................................................... 34 4.2.2 人头部活动的欧拉角的判定 ................................................... 34 4.2.3 瞌睡点头阈值的设定 ............................................................... 35 4.2.4 头部疲劳的判定 ....................................................................... 36 4.3 实验结果分析 ................................................................................. 37 4.4 本章小结 ......................................................................................... 37 5 疲劳驾驶检测系统分析 ...................................................................... 38 5.1 朴素贝叶斯算法 ............................................................................. 38 5.2 疲劳驾驶系统的分析 ..................................................................... 38 5.2.1 不同环境下测试系统的稳定性 ............................................... 39 5.2.2 收集人脸进行测试分析 ........................................................... 43 5.2.3 实际工况中测试分析 ............................................................... 44 5.3 本章小结 ......................................................................................... 45 6 总结与展望........................................................................................... 46 6.1 全文总结 ......................................................................................... 46 6.2 论文创新点 ..................................................................................... 46 6.3 后续工作展望 ................................................................................. 46 7 参考文献 ............................................................................................... 48 天津科技大学硕士学位论文11绪论1.1研究背景和意义近几年来，随着人民生活水平的不断提升，交通运输行业的持续发展，机动车总量逐渐增加，据数据显示，2022年我国机动车数量高达3.95亿辆，机动车中汽车数量达到3.02亿辆；与此同时机动车驾驶人数量达到4.81亿人，其中驾驶汽车人数达到4.44亿人[1-2]。2022年我国新登记注册的机动车3674万辆，新领驾驶证人数超过2750万人。随着机动车和驾驶员数量的不断增加，与此同时我国交通事故也在不断发生，近几年来我国大力改善交通设施，道路也不断被扩充，我国交通道路的改善使交通事故的发生率呈现下降趋势。但我国道路上的汽车保有量基数大，交通事故的发生仍然是一个严重的问题，每年因交通事故而丧失生命的人逐渐增多，交通事故也给我国带来了严重的财产损失。引起交通事故的原因有很多种，其中最主要的原因是驾驶员的一些不正确驾驶行为和违法的操纵导致的。其中包括驾驶速度过快，违章驾驶，酒驾等等。据数据调查显示，疲劳驾驶是引发交通事故的主要原因之一，驾驶员疲劳主要由于较长时间驾驶汽车没有得到充分的休息[3-4]。为了避免交通事故的不断发生，国家法律明确规定违章驾驶、酒后驾驶等需要负法律责任，其中也包括驾驶员疲劳驾驶，我国交通法规定，驾驶员驾驶汽车连续时长超过4小时必须要休息，而且停车休息的时间不能少于20分钟，当驾驶员长时间驾驶将被视为疲劳驾驶行为，是交通事故的隐形杀手。驾驶员长时间开车就会开始产生疲劳状态，驾驶员会出现无精打采、注意力分散、瞌睡点头等生理行为，而长时间驾驶眼睛疲惫会导致视力范围缩小，反应缓慢等现象[5-6]。当视力范围缩小时导致驾驶员在快速行驶的道路上不能够准确的观察到车辆信息和道路信息，不能正确的操纵汽车，导致汽车时刻处于危险的边缘[7-8]。驾驶员疲劳时反应能力下降，有时当汽车处于急速行驶的状态，驾驶员需要较强的反应能力，使汽车保持在安全的道路上行驶。当驾驶员开车处于过度疲劳状态时，驾驶员不能完全睁开双眼，处于轻度睡眠状态，很容易操作不当造成交通事故，严重者会威胁生命[9-10]。因此驾驶员应该时刻保持清醒状态，遵循交通法规，做到绿色通行，安全出行。为了避免交通事故的发生，保障人们出行安全，可以研制一个疲劳驾驶预警系统，可以通过采集驾驶员的驾驶动作，生理行为等。通过疲劳驾驶预警系统检测驾驶员的疲劳状态，并实时采集驾驶员的驾驶数据和汽车的驾驶车况[11-12]。如果驾驶员或汽车处于疲惫驾驶状态和危险状态，疲劳驾驶监控系统进行实时检测并发出预警提醒。这时驾驶员应该马上做出调整，适当休息，保证安全驾驶[13-14]。如图1-1所示一个实时有效的疲劳驾驶监控预警系统能够保障驾驶员安全出行，保证人们的生命财产安全，系统可以检测驾驶员的眨眼、哈欠、瞌睡点头、左顾右盼、打电话等危险驾驶行为，并实时预警。天津科技大学硕士学位论文2图1-1疲劳驾驶检测系统Fig.1-1Fatiguedrivingdetectionsystem1.2人脸检测识别研究现状利用计算机视觉技术实现疲劳驾驶检测的基础是人脸识别，需要在采集视频数据中识别出人脸，近几年来，随着计算机视觉技术的不断发展，人脸检测识别技术也不断得到完善，并且已经应用在工业、金融等多个领域[15-16]。人脸识别应用在公安领域，可以将疑犯照片与档案库里的人脸信息进行比对大大提升了工作效率，被应用于身份验证，在火车站，机场，海口等场所，常常通过身份证件进行比对完成自动检票工作，实现智能化检票。在银行等重要场所，经常会安装监控系统，若出现陌生人闯入时，会对人进行人脸识别、检测、跟踪等并进行预警处理。在公司中常常用来员工考勤打卡，将员工的工作日记录下来，方便有效[17-18]。还被应用在表情识别领域，识别人的面部特征，根据面部特征分析人的情感状态，例如高兴、悲伤愤怒等。1.2.1人脸检测识别国内外现状1960年以来我国专家学者开始研究人脸检测识别这项技术，在1990年后期人脸识别技术得到了迅猛的发展，如今人脸检测识别技术已经逐渐成熟而并应用在各个领域[19-20]。人脸检测识别技术从传统模型识别到计算机视觉技术与人脸生物学原理相结合，再到人工智能识别技术不断更新。人脸检测识别的精度更高，功能更加全面，既能实时快速识别检测人脸，又能识别出人脸的表情，年龄等信息[21-22]。如今各个国家都在大力发展人脸检测识别技术，包括美国、英国、日本、德国等。日本在人脸检测识别方面取得了显著成果，虽然日本的人脸检测识别技术发展的比较晚，但是技术却在不断更新，前几年日本研发了一种实时视频人脸面部检测识别技术并且进行了测试，它的功能是通过检测人的表情和人的流动可以在危险的时候提高最有效的出口[23-24]。日本在克服人脸模糊部分识别也有了突破性进展，日本电气公司在人脸识别技术方面取得了突破性进展，在深度学习技术的基础上加入人的体型和衣服因素进行数据训练，完成人脸识别功能，检测结果具有较高的准确率。该方法优点在于可以在人群聚集的情况下识别出陌生人的身份。在疫情期间人们出行常常佩戴口罩这样会影响人脸识别的精度，日本Glory公司研发出一种戴口罩情况下的人脸识别系统，该系统在人脸被口罩遮住一半时依然可以识别出身份信息[25-26]。美国在识别速度、模型优化和准确率方面取得了显著成果，谷歌相关研究人员应天津科技大学硕士学位论文3用对抗生成网络，该技术可以有效减少图像生成时标记的数量，而且生成图像的质量也得到了提升[27-28]。技术人员将该技术与图像生成技术相结合，提升了图像合成的精度。美国南加大和加州大学的伯克利分校相关专家研发一种可辨别深度伪造图像的智能工具。该技术是通过判别人面部的细微表情来辨别真伪的例如人说话时的表情，或面部愤怒、微笑时的状态。为了提高辨别的精度，技术人员也增加了音色，音调等因素来判断[29-30]。英国在人脸检测识别方向也有显著成果，其中布拉德福德大学研究人面部被遮挡时进行人脸识别，技术人员表示，当人脸被遮挡1/2时依然能识别出人脸[31-32]。采用卷积神经网络进行图像特征提取，基于支持向量机和余弦相似度进行分类预测识别，最后进行实验数据测试。试验结果表明，该系统在只扫描人脸的1/2时依然能识别人脸，而且准确率非常高[33-34]。研究人员表示，该项研究成果提升了人脸识别技术中人脸被遮挡时识别的准确率，并广泛用在公安安防等领域。德国很多名校研究人脸识别技术，其中波茨坦大学研发出一种新型人脸识别技术，相关技术人员根据眼动原理来实现人脸识别功能[35-36]。数据采集人员收集大量人的无意识眼睛跳动行为，通过大量的训练和学习提高识别的精准度、该识别技术基于人的自然反应，不容易被破解，提高了安全性。1.2.2人脸检测识别常用方法人脸检测识别技术在各个领域都发挥着作用。它基于计算机视觉图像处理技术和面部特征轮廓原理，运用计算机视觉技术在视频中提取人脸数据，利用生物学原理将人脸特征信息转化为数字信息[37-38]。根据数字信息构建模型分类器完成人脸检测与识别的任务。人脸识别的方法有很多，每一种方法都有其优势，随着技术的更新人脸识别方法也在不断进步，其中几何特征方法是最经典算法之一，其应用层次聚类设计分类器完成人脸识别功能，其中用特征矢量描述面部器官的形状和位置，主要通过计算面部特征脸之间的欧式距离、和角度等信息来表示。这种方法对内存的要求不高，因此人脸识别的速度快[39-40]。能适应光照的变化，缺点是当人面部表情变化时，会影响算法的特征提取，而且这种方法往往会忽略图像中其他细节的变化，识别不准确等情况[41-42]。除此之外还有很多应用于人脸识别的方法，基于隐马尔可夫模型的方法常常用在人脸识别中，原理是将目标特征信号进行数据状态统计。记录统计信号的变化，而信号的变化又是用序列表述的，因此马尔可夫又是两重的随机的[43-44]。其中结点表示某种状态，边可以表示为从一种状态信息转移到另一种状态信息，每个状态信息都可以表示特征空间中的对应特征向量关系，不同状态信息表示为不同的特征向量，因此可以根据每个人脸的不同观察向量来进行人脸识别。这种方法大大提高了人脸识别技术的准确率和在复杂环境中系统的鲁棒性[45-46]。人脸识别方法中也常常用到基于统计学原理，将输入图像中人脸面部特征看作是随机向量，运用统计学原理统计面部特征向量建立面部模型进行数据分析完成检测与识别，该类方法不断更新，衍生出很多人脸天津科技大学硕士学位论文4识别相关算法。其中有主成分分析（PCA）法，该方法减少人脸特征向量之间的相关性，加快了运算速度[47-48]。PCA与LDA相结合的方法，原理是将类内散布正交的矢量作为特征脸空间，减少被检测的图像与目标物的不相关性，对光照强度和人的面部表情有较强的鲁棒性[49-50]。基于自身特征脸，原理是通过人脸肤色变化的信息从动态视频帧中识别出人脸，指定视频中人脸信息，缺点是不能区分人脸。利用神经网络和机器学习中的分类算法完成人脸识别功能广受好评，神经网络对人脸细节的提取更加充分，当人脸被部分遮挡时，它仍然能通过人脸细微的变化来识别出身份，后期不用再进行图像处理，但是需要大量训练，优化模型。在机器学习中常常用多种分类器进行组合达到提高精度的效果，单个分类器会受光照、面部表情等外在因素的影响，多个分类器重新组合，发挥多个分类器的优势，这样就会提升人脸识别的准确率[51-52]。人脸识别技术是属于无接触检测，具有简洁方便，各个领域也被广泛应用，如银行监控、海关监控、档案管理、犯罪嫌疑人的识别、人机交互等等。人脸检测与识别技术中的人脸检测尤为重要，是人脸识别的基础，人脸检测主要是在视频或图像中检测出人脸所在的位置和大小等信息，根据位置大小等信息实时跟踪人脸[53]。人脸检测的方法有很多，根据面部形态的方法、根据统计学原理、根据模板匹配原理。基于面部形态的方法就是将输入图像的面部灰度、结构、肤色、纹理等信息转化为数字化信息，以高维向量的形式表示出来，我们可以根据向量信息完成检测等功能[54-55]。人面部的灰度特征反应人脸面部亮度信息的特征，由于不同人脸的器官分布不同，因此人脸的面部的灰度值不同，可以通过人脸面部灰度的分布来制定规则，利用灰度规则判断当前图像中有无人脸，当光的强度变化可能打破灰度规则，但是人脸器官之间灰度比例不变，我们可以对输入的图片进行光照补偿，防止灰度特征发生变化[56-57]。人脸的形状和轮廓也可以制定规则，利用图像处理中边缘检测算法提取图片中面部的轮廓边缘特征，如利用Sobel算子、Canny算子等提取人脸的轮廓[58]。结构特征信息比较常见，根据人脸的对称性和面部器官的分布规律，将人脸器官之间的关系转换为向量信息用来描述人脸的特征信息，如相关研究人员通过眼睛之间的对称性看来识别检测人脸。基于纹理特征检测人脸更加注重人脸细微变化，每个人人脸的纹理特征有所不同，Dai等人利用空间灰度矩阵来表示纹理特征。此类方法适合低分辨率的人脸检测。另一种基于人脸肤色的人脸检测方法，利用高斯原理是在不同颜色空间中建立面部模型，可以适应不同光照情况，对光有较强的鲁棒性。使用该算法的前提是需要相机的内参和畸变参数。使用非参数估计法建立肤色模型进行局部人脸特征搜索完成人脸检测，虽然这一方法加快了检测速度，适应不同的光照强度，但对复杂背景下的人脸检测识别率不高[59-60]。通常情况下为了加强算法对光照的适应性，可以加入光补偿等方法，然后再检测图像中有肤色的区域。这样可以提高检测的准确率，避免背景复杂、光照变化等外界因素的影响[61-62]。综上基于肤色进行人脸检测不会受人脸表情、姿态变化、图像旋转等情况的影响具有速度快、稳定性好、准确率强等优点。天津科技大学硕士学位论文5人脸检测过程中常常应用到统计学原理，例如本征脸法、神经网络法、支持向量机法等等。基于本征脸进行人脸识别原理是通过代数运算将人脸空间特征做降维处理，求出面部向量的特征值，通过特征信息发现人脸和非人脸的分布规律，完成检测功能，神经网络一种通过反向传播更新参数达到最优化的方法，神经网络由大量的神经元组成，通过输入与输出之间的关系来训练学习判断是否为人脸[63-64]。神经网络有实时性好、表达充分等优点，但是结构复杂，计算量较大。基于支持向量机的方法也被使用，其适用于样本数量小，维度高的情况下。支持向量机的关键是建立高维度空间构建超平面，优势在于融合样本信息、复杂模型、较强的学习能力等[65-66]。基于Adaboost的迭代算法，该算法的原理是通过部分数据训练出弱分类器组合成强分类器，最后将决策交给较强的分类器，优点在于可以忽略不重要的数据集，识别的准确率较高。1.2.3人脸检测识别存在的问题虽然人脸检测识别技术已经逐渐走向成熟，但是仍然有很多因素影响人脸检测识别的速度和准确率，如光照的影响，面部被遮挡、年龄的变化等等[67-68]。如今很多专家学者针对这些情况优化算法，在一定程度上有所改善，但依然存在隐患。光照问题是影响人脸检测与识别的主要问题，很多高校和研究所针对这问题进行研究，中科院计算所对光照强度进行分析，通过对光照强度、光照方向和人脸的面部阴影、反射属性进行量化分析，得出结果构建数学模型。得出影响因素的数学模型，通过观察数学模型对图像预处理，消除或补偿光照的影响[69-70]。人脸表情和面部姿态的变化也会影响识别的准确率，而姿态问题一直备受研究学者们关注。人头部在三维空间姿态是不断变化的，当人处于仰视或俯视的情况下人脸检测识别的准确率会逐渐下降，或者人面部出现喜怒哀乐等表情的变化时也将影响识别的准确率。针对这一问题，可以增加人脸姿态样本训练学习，增加系统的泛化能力，提高识别的准确率[71]。当人出现仰视或俯视的情况时，我们可以将平面图像转换为3D空间姿态模型，根据3D空间姿态模型实现人脸检测识别功能。遮挡问题也是人脸检测识别难以跨越的屏障，人们经常会戴帽子，戴口罩，戴眼镜等配饰，这些配饰难免会对脸部有遮挡，克服这些困难是我们首要问题，随着人工智能的兴起，卷积神经网络逐渐应用到计算机视觉中，可以收集大量数据样本训练学习人的特征，捕捉图像中的细微变化达到检测和识别人脸[72-73]。除此之外仍然还有很多因素影响人脸检测识别的准确率如：年龄的变化、图像质量、样本的缺失等等。面对这些因素需要研究人员不断优化算法，减小识别的误差。1.3疲劳驾驶检测研究现状一个高效的疲劳检测预警系统对驾驶员及乘客的安全是非常重要的，而世界各国也投入大量的资金研究疲劳驾驶检测系统，并且也生产出很多有效的实用的产品。在疲劳检测方向取得了突破性的进展[74-75]。疲劳驾驶检测可以由驾驶员主动感受评估，驾驶员感觉自己身体疲惫，驾驶能力下降时，可以自行调整，停车休息。但是很多时天津科技大学硕士学位论文6候驾驶员自我感觉良好，自我评估不准确导致危险的降临。因此应该让驾驶员处于被动检测状态，这种客观的方式可以准确的检测出驾驶员的疲劳状态，具有较高的有效性和稳定性[76-77]。近几年来，研究人员通过检测车辆行驶状况、驾驶员的生理特征，驾驶员的面部特征来反应驾驶员的疲劳状态，并且取得了很好的效果。驾驶员长时间驾驶会出现如下几种反应：（1）驾驶员感觉自己身体疲惫，精神萎靡，驾驶员视力敏感度下降，对道路信息和路人会出现误判和漏判等现象，而且驾驶员由于需要长时间睁眼观察道路信息，会出现眼疲劳，眨眼的频率逐渐上升，而且眼睛的开合度也变低，导致视野下降[78-79]。驾驶员长期久坐会出现颈部肌肉酸痛，为了缓解酸痛，身体会不由自主的出现瞌睡点头，晃头等现象，因此这种瞌睡点头行为也严重威胁到驾驶员的安全。（2）驾驶员的反应速度和决策执行能力下降，当道路前方出现危险路况时，驾驶员不能做出快速应急反应，引发交通事故。而且由于疲劳导致驾驶员暂时忘记基本交通规则，出现违章驾驶，害人害己[80-81]。驾驶员的决策执行能力下降，导致油门和刹车混乱，出现严重的操作失误，酿成大错。（3）驾驶员长时间操纵方向盘，会导致手臂酸痛，导致驾驶员对汽车的行驶状态判断不准确，会出现汽车长时间压线行驶，容易和对向汽车发生碰撞事故[82]。与前方汽车车距较近，容易发生追尾现象。因此疲劳驾驶预警系统应该遵循以上几个疲劳因素进行设计，综合判断驾驶员的疲劳状态，真正的做到安全出行，保障人们的生命财产安全，多种形式的疲劳驾驶检测方法如图1-2所示。图1-2疲劳驾驶检测方法Fig.1-2Fatiguedrivingdetectionmethod天津科技大学硕士学位论文71.3.1传统疲劳驾驶检测的发展研究人员发现汽车行驶的过程中，若驾驶员处于疲劳驾驶状态，对汽车的控制能力降低，车况会发生变化，汽车的行为特征与正常驾驶时会有差异，可以根据行驶车况变化的参数来判断是否属于疲劳驾驶，这些参数包括方向盘的转角、油门和刹车的压力、车道线的偏离状况、汽车加速度的变化等。通过对汽车参数的实时检测，对数据进行整理分析，设定阈值，综合判断驾驶员是否处于正常的操纵状态[83-84]。美国华盛顿州立大学相关研究人员，分别在白天和晚上进行测试分析，通过驾驶汽车模拟器记录驾驶员和汽车的一系列特征信息，作为判断疲劳驾驶的指标[85]。实验数据表明，在汽车行驶过程中，若汽车偏离车道线行驶则可以反应驾驶员可能处于疲劳驾驶状态，而且汽车偏离车道线的变化与方向盘的转向有关。相关研究人员通过传感器实时测试汽车行驶时方向盘的转向角信息，并且由分类器判断驾驶员的是疲劳驾驶状态还是清醒状态，由此可以证明方向盘转角信息可以作为判断疲劳驾驶的依据之一[86]。在研究车辆的行驶状态与疲劳驾驶之间的关系中，贾丽娟在疲劳驾驶检测时，采用实际车辆进行测试，在行驶的过程中利用传感器获取实车方向盘的实时数据，提取实验中方向盘时域或频域的指标，最后将数据信息送入分类器中进行分类预测，最后根据方向盘的状态信息判断驾驶员的疲劳状态[87]。张明明等人提出了可以采集方向盘受到的压力信息，根据压力这个疲劳特征参数判断驾驶员的疲劳状态。张希波等人采集方向盘的转向角信息，将汽车行驶过程中零速百分比和角度标准差作为疲劳特征因素判断驾驶员的疲劳状态[88]。全威、李洪涛等研究人员将方向盘的转角、车道偏离信息作为判断疲劳的因素，上述的大部分实验数据是在模拟驾驶室中采集的，FabianFriedrichs等研究人员在实际的驾驶环境中进行了实验测试，将车道偏离和变线速度看作判断疲劳的因素，验证它们之间的关系，根据细心观察得出结论，少数驾驶员保持清醒时的驾驶习惯和疲劳驾驶员的驾驶行为很相似，从而论证判断驾驶员的疲劳状态需要多种疲劳特征因素相结合，清华大学屈肖蕾等人引入车辆行驶过程中变量的波动幅度、速度等作为疲劳特征因素，对于车辆不同状态下的转向做数据分析，选出最优指标，基于支持向量机方法进行疲劳判别，最终系统识别率可以达到87.7%[89]。通过采集汽车在行驶过程中的状态信息来作为疲劳特征因素优点在于不与驾驶员直接接触，不会影响驾驶员的正常驾驶，但是不同的驾驶习惯和不同的路况会影响疲劳检测系统的判断，在实际的测试过程中容易出现误检等状况，可以将其视为辅助驾驶的功能。研究人员发现，若驾驶员处于疲劳状态时，驾驶员的生理状态下降，身体的各项指标会发生明显的变化。相关数据表示驾驶员的心率、肌电信号、脑电波、呼吸频率会发生明显的波动[90]。相关医学资料显示，当人处于疲劳状态时，心率不齐，会有明显的波动，因此可以将这个指标作为判断驾驶员是否疲劳的因素之一，由于驾驶员长时间坐姿驾驶，长时间操纵方向盘，手臂、颈部及背部肌肉会出现酸痛的感觉，可以通过检测这些部位的肌电信号来反应驾驶员的身体状态，作为判别疲劳的指标。当驾天津科技大学硕士学位论文8驶员处于疲劳状态时，精神萎靡，注意力不集中，反应能力下降。此时驾驶员的脑电波与正常状态下有明显的差异，相关人员也将这一特征作为判别是否疲劳的特征之一。驾驶员长时间驾驶，消耗较大，血液中的氧含量下降，为了增加氧含量，呼吸频率会有所上升，这也是可以判断驾驶员是否疲劳的主要指标。在基于脑电信号的疲劳检测中，Jos[91]等人提出通过穿戴EEG等设备作为疲劳检测的工具，可以帮助驾驶员自己评估自己的疲劳状态。Luo[92]等人采集驾驶员前额脑电信号数据，利用自适应缩放因子和熵特征算法结合，对特征进行分类处理，并进行实验测试，证明该方法的有效性。在基于心电信号的疲劳驾驶检测中，Markus[93]等人用低成本的心电图传感器来通过心率变化判断疲劳驾驶状态；徐礼胜等用短时心电信号作为输入判断疲劳状态，通过心电信号传感器采集驾驶员短时间的心跳频率，对心电信号数据进行预处理，消除极端样本等噪音影响，送人神经网络中进行训练和学习，最后根据预测结果判断驾驶员的疲劳状态。基于肌电信号的疲劳检测中，Wang等人提出用肌电图来检测疲劳，用电肌肉刺激来缓解疲劳，利用采集系统采集肌肉的肌电信号，将肌电图的峰值设定为阈值，根据阈值判断驾驶员的疲劳状态，而且可以刺激手部肌肉来缓解疲劳的目的。东北农业大学祝荣欣等人通过传感器采集驾驶员的心电信和手掌、手臂等肌电信号，并对数据进行处理分析，融合两种疲劳特征因素判断驾驶员的疲劳状态，根据数据得出结论心电特征比肌电特征的判定准确率更高，融合后的准确率高达87.5%。Artanto[94]等人发明了可以检测睡意的设备，将肌电采集信号的设备放在眼睑周围的皮肤上，可以检测眼睛的闭合，最后可以检测疲劳状态。综上所述，基于驾驶员生理因素的疲劳驾驶检测方法一般为接触式的疲劳检测，驾驶员在检测期间会穿戴物理设备，虽然接触式疲劳检测的检测效果比较可靠、精度相对较高、检测出的数据可以实时使用，但是驾驶员在驾驶汽车时需要穿戴物理设备，降低驾驶的舒适性，影响驾驶员的正常驾驶。1.3.2计算机视觉疲劳驾驶检测的发展近年来随着计算机视觉的发展，研究人员发现当驾驶员处于疲劳状态时，身体的生理状态变化明显，人的面部也会出现很多反应疲劳的特征，例如由于长时间驾驶汽车眼睛始终处于高度集中状态，会产生眼干、眼疲劳等症状，为了缓解症状面部会出现频繁眨眼等特征，而且眼睛的开合度也比正常状态有所不同，研究人员可以利用这一特征因素判断驾驶员的疲劳状态。当驾驶员由于疲劳出现困倦打哈欠的行为，这时人脸嘴部的开合度有所变化，而随着疲劳程度的增加，打哈欠的频率也会逐渐增加，这一特征因素也是判断是否疲劳重要依据。相关人员主要通过摄像头采集人脸信息，然后对图像数据进行处理得出结论。利用计算机视觉技术属于非接触式检测，并不需要驾驶员穿戴物理设备，不影响驾驶员的正常驾驶，具有更高的有效性和舒适性。利用计算机视觉对驾驶员面部特征进行疲劳检测的方法被逐渐完善。Xu[95]等人提出可以通过追踪眼球的运动行为特征检测驾驶员的疲劳状态。Wang[96]等人提出双目一致性的鲁棒疲劳检测系统，主要原理是运用双向卷积神经网络，对注视状态下的两天津科技大学硕士学位论文9只眼睛进行特征提取，然后进行局部投影合并矢量化特征，运用卷积神经网络训练数据特征，完成疲劳检测功能；Poursadeghiyan[97]等人根据面部表情，眼睛位置等因素，通过跟踪和定位人眼，记录人眼的眨眼频率来完成疲劳检测功能。基于嘴部特征的疲劳检测中Knapik[98]等人将热成像技术运用到疲劳驾驶检测中，该方法的优点可以克服光照的影响，无论黑体或白天都能检测出驾驶员疲劳状态，更不会影响驾驶员的正常操作，该方法是通过热成像技术检测驾驶员的哈欠情况，判断驾驶员的疲劳状态。Anith[99]等人提出双代理新型专家哈欠检测系统，该系统对驾驶员人脸嘴部区域进行提取，获取驾驶员的哈欠特征，测试哈欠数据，判断驾驶员的疲劳状态。吉林大学牛清宁[100]等相关研究人员通过眨眼次数、眼睑尺寸等眼睛信息判断驾驶员的疲劳状态，并根据眨眼频率等参数构建疲劳检测模型，测试结果准确率达到了83%。旷文腾[101]等人，结合Viola和Jones的人脸检测算法完成了人脸检测，然后根据特定颜色空间中眼白呈现出的聚类特性，根据眼白区域面积和PERCLOS准则进行疲劳检测，有较高的准确率。清华大学张波等相关研究人员通过平均合成滤波器和改进的ASM算法定位人眼，该算法可以在人体姿态发生变化时仍然能准确的定位人眼，具有较强的鲁棒性[102]。邹昕彤等相关研究人员首先对人脸嘴部进行粗提取，将图像做二值化处理，计算嘴部的面积，根据面积设定嘴部闭合、张开的阈值，判断驾驶员的疲劳状态[103]。综上基于计算机视觉的疲劳驾驶检测的方法是无接触式检测，用摄像头来采集视频数据信息，提取视频中的面部特征信息，根据面部的特征因素判断驾驶员的疲劳状态，优点在于采集驾驶员疲劳特征因素属于无接触检测，不会影响驾驶员的正常驾驶，缺点是疲劳检测系统会受光照和驾驶员的姿态变化所影响，鲁棒性有待提高。1.4主要研究内容本文主要研究基于多特征因素的疲劳驾驶检测系统。系统主要运用PHOG图像特征提取算法，结合OpenCV开源软件库在视频数据中识别人脸，并检测出人脸所在位置。利用人脸关键点检测器在已经识别的人脸上检测出人脸68个关键点，用图像二维坐标标记出人的面部轮廓和眼、嘴等关键部位，然后设定眨眼和哈欠阈值，通过统计驾驶员眨眼的次数和哈欠的次数判断驾驶员是否处于疲劳状态。检测到人脸的位置后，需要将人脸2D关键点坐标与3D人脸模型相匹配，计算出实际空间中世界坐标与人面部图像坐标之间的转换矩阵，即旋转矩阵和平移矩阵，利用旋转矩阵计算出驾驶员头部在空间中活动的欧拉角，设定点头阈值，从而判断是否是瞌睡点头行为。然后根据朴素贝叶斯算法的样本相互独立原则，融合以上疲劳因素判断驾驶员的疲劳状态。最后为了证明疲劳检测系统的稳定性、有效性和抗干扰能力，收集不同人脸并且在多种复杂的环境中进行测试，经过大量的数据结果显示，系统具有稳定性和有效性，在复杂的环境中具有较强的抗干扰能力。第一章，主要对疲劳驾驶的背景和意义进行了详细的论述，表明驾驶员疲劳检测在交通安全领域和智能交通领域的重要性；分析了国内外人脸识别技术与疲劳驾驶检测技术的现状和不足；最后对本文各章节结构内容进行概述。天津科技大学硕士学位论文10第二章，对疲劳驾驶检测系统理论知识进行介绍，主要阐述疲劳驾驶检测系统的流程，人脸特征提取算法的选择和原理，利用特征提取算法在视频中检测出驾驶员的人脸的位置，检测出人脸轮廓的68个关键点，用红色原点描述出被检测人脸的68个点。最后得出运行效果图，验证算法的有效性。第三章，首先介绍面部眼、嘴疲劳特征对疲劳检测的重要性，对面部眼、嘴的疲劳检测原理进行了概述，设定眨眼、哈欠疲劳阈值。利用OpenCV软件库中显示函数得出运行的效果图，将驾驶员的眨眼、哈欠的阈值和频率相关数据显示在窗口中。第四章，首先介绍了计算机视觉中的四大坐标系和世界坐标到图像坐标之间的转化关系，介绍头部疲劳特征对疲劳检测的重要性，对头部的疲劳检测原理进行了概述，确定驾驶员头部在空间中的活动维度，设定瞌睡点头疲劳阈值。最后实验得出运行效果图，将驾驶员头部的空间坐标和瞌睡点头的相关数据显示在窗口上。第五章，对整个疲劳检测系统进行测试分析，证明疲劳检测系统的稳定性和抗干扰能力，在驾驶员佩戴装饰、光照变化等多种复杂情况下进行疲劳驾驶检测，统计数据、整理并分析结果，验证系统的鲁棒性。分别采集不同人脸进行实验测试，通过不同人脸检测结果分析，得出结论，证明疲劳驾驶检测系统针对不同人脸都具有良好的监测效果。第六章，对疲劳驾驶检测系统的技术内容进行归纳总结，并指出论文中所存在的不足，最后再对疲劳驾驶检测系统升级与完善等工作进行展望。天津科技大学硕士学位论文112疲劳检测系统概述及人脸检测原理疲劳驾驶检测方法按接触方式可分为两类，接触式疲劳检测和非接触式疲劳检测，接触式疲劳检测是驾驶员通过穿戴传感器设备检测的心电信号、肌电信号、脑电波、呼吸频率等生理因素判断驾驶员的疲劳状态。随着计算机视觉技术的不断发展，非接触式疲劳检测逐渐被开发应用，而计算机视觉技术在人脸识别领域已经得到了广泛应用，如人脸支付、人脸考勤、人脸表情识别等。基于计算机视觉的疲劳驾驶检测系统需要在算法的支撑下在复杂的环境中识别检测出人脸，通过视频帧捕捉到驾驶员人脸的疲劳特征因素，综合疲劳特征因素判断驾驶员的疲劳状态。2.1疲劳驾驶检测系统概述2.1.1疲劳驾驶检测系统简述疲劳驾驶检测系统的设计原理是根据驾驶员长时间驾驶过程中面部和头部的疲劳特征来判断驾驶员的疲劳状态。眨眼是人的正常的生理行为，当人眨眼的时候，可以使泪液均匀的湿润眼球，防止眼睛干燥，当长时间用眼时，就会眼疲劳，出现眼干、眼酸等症状，人就会不停的眨眼来分泌泪液来缓解眼部的不适感，根据这一生理特征，当驾驶员长时间开车过程中，注意力一直处于高度紧张状态，就会出现眼疲劳现象，从而导致驾驶员的眨眼频率发生变化，可以将这一生理特征作为疲劳特征因素判断驾驶员的疲劳状态。打哈欠也是人的正常生理行为，但是当人处于疲劳状态下，打哈欠的频率会变得更频繁，是因为当人疲劳或缺少睡眠时，大脑会供血供养欠缺，这时驾驶员就打哈欠使得肺部扩张增加吸氧量，增加血液流通的速率，使得血液中的含氧量增加，使得大脑处于更加清醒的状态，所以当驾驶员长期驾驶时会出现疲劳缺氧的状况，这时驾驶员就会出现频繁打哈欠的行为来缓解驾驶疲劳状态，因此打哈欠这一特征也是判断驾驶员是否疲劳的因素。医学表明人在长时间和高强度的工作时，人体肌肉群保持收缩状态就会产生肌疲劳等现象，肌肉疲劳是长时间工作积累产生的疲劳，而并不是某一个时刻产生的疲劳现象，所以当驾驶员长时间驾驶时，驾驶员处于坐姿状态，人的颈部肌肉长时间处于收缩状态，为了缓解颈部肌肉的疲劳现象，驾驶员就会出现瞌睡点头的生理状态，根据这个生理现象判断驾驶员的疲劳状态。综上所述，通过计算机视觉技术识别出视频中驾驶员的人脸，并检测出驾驶员面部及头部的位置，然后通过视频帧的变化检测出眨眼、哈欠、瞌睡点头的频率变化。因此，通过以上疲劳特征因素判断驾驶员是否处于疲劳驾驶状态，驾驶员的三种疲劳状态如图2-1所示。天津科技大学硕士学位论文12（a）驾驶员眨眼状态（b）驾驶员哈欠状态（c）驾驶员瞌睡点头状态图2-1驾驶员的三种疲劳状态Fig.2-1Threefatiguestatesofdrivers2.1.2疲劳驾驶检测系统的设计原理本文提出疲劳驾驶检测系统是利用OpenCV从摄像头中提取视频帧进行处理的实时检测系统，该疲劳检测系统可以在复杂的环境中检测出视频中驾驶员的人脸，框住视频中人脸的位置。然后定位人脸面部的68个关键点坐标，通过人脸的68个关键点坐标索引人面部眼、嘴部的位置坐标。通过坐标变换，将2D人脸关键点坐标与3D人脸模型进行匹配，计算出世界坐标与图像平面坐标的旋转矩阵与平移矩阵，定位出驾驶员头部的空间坐标，通过旋转矩阵计算出驾驶员头部活动的范围的欧拉角，设定瞌睡点头阈值，最后通过统计视频帧中，面部眼、嘴以及头部在空间的姿态变化判断驾驶员是否处于疲劳状态，疲劳驾驶检测系统的流程图如图2-2所示。图2-2疲劳驾驶检测系统流程Fig.2-2Flowchartoffatiguedrivingdetectionsystem天津科技大学硕士学位论文13疲劳驾驶检测系统可以看作一个主检测系统和两个分支子检测系统，其中主检测系统负责在复杂的环境中能够准确的识别出人脸，实时定位人脸的位置，并检测出人脸的68个关键点坐标，两个子系统分别为面部特征因素疲劳检测和头部空间姿态的疲劳检测，面部检测是根据68个关键点定位面部眼、嘴平面坐标，然后根据眼、嘴坐标设定眨眼和哈欠阈值，最后通过统计眨眼和哈欠的次数来判断是否疲劳，头部姿态检测则是需要将2D坐标转换为3D坐标，然后确定头部的空间位置，根据空间坐标计算出头部姿态运动的欧拉角，设定点头阈值，统计单位时间内点头的次数，根据以上疲劳特征因素征判断驾驶员的疲劳状态并给予疲劳预警。2.2人脸识别与检测算法2.2.1图像特征提取算法在计算机视觉中，在对视频图像进行处理过程中，常用于提取图像中的特征的算法有三种Haar特征算法、LBP特征算法和HOG特征算法。三种算法特征描述器分别提取图像中不同种类的局部信息，Haar特征描述器描述的是输入图像中局部区域像素值明暗交替的信息、LBP特征描述器反应是输入图像的局部区域纹理信息的变化，HOG特征描述器则是图像的局部区域梯度变化的信息，三种特征提取算法都在计算机视觉领域有广泛的应用。Haar-like特征提取算法是计算机视觉中常见的特征描述器，由Haar小波的启发命名为Haar，将Haar的特征维度扩展到3维空间，常常用于检测视频中的三维动态特征。Haar在目标检测中有广泛应用，常常用来检测行人，和人脸等目标物。Haar特征描述算子按特征模板的形状可分为三类：黑色矩形与白色矩形分布在两侧的边缘特征描述算子、黑色矩形与白色矩形分布在上下的线性特征描述算子、中间黑色矩形两侧为白色矩形的中心特征描述算子、黑白矩形呈对角线特征分布的对角线特征描述算子。如图2-3所示特征模板由黑白两种颜色，并规定特征描述算子滑过图像得到的特征值由黑色矩形像素和与白色矩形像素和之差决定。在输入图像上移动特征描述模板，穷举图像描述特征，将这些特征算子的算数集合作为特征描述器进行训练和分类，用于提取图像中的目标特征。图2-3特征描述算子类别Fig.2-3Typeoffeaturedescriptionoperator由于矩形特征描述算子可以在图中的任何位置，并且大小和类别可以随之改变，因此特征数量也会变得特别庞大，使得检测的速率变慢。为了加速计算机的处理速度，采用积分图加速算法提升速度。积分图算法原理对输入图像进行一次遍历，提前得出图像中所有区域的像素和，提高了检测效率。天津科技大学硕士学位论文14积分图算法的优点在于不用重复计算图像局部区域的像素和，首先对图像做预处理并计算图像中起点像素值到图像中各个点所组成的矩形区域的像素和，将计算出的各区域的像素和保存在内存中，如果需要再次计算数组的元素和可以直接从内存中引用数组元素，不用重新计算像素值。把输入的图像遍历一次时积分图就已经形成了。积分图的计算过程：（1）初始化行方向的累加和，),(jis代表像素累加和，则初始化为0)1,(si ；（2）初始化积分图像的累加和，),(jiii代表像素积分图像，则初始化为0),1(jii；（3）将输入图像进行预处理，扫描整个图像，将每个像素点的行方向累加如式（2-1）所示；和像素积分图像的),(jiii的值如式（2-2）所示。(,)(,1)(,)sijsijfij式（2-1）(,)(1,)(,)iiijiiijsij式（2-2）（4）将图像像素遍历一遍，当到达图像像素最右下角的像素点时，就构成了图像像素的积分图，将计好的积分图保存在内存中，输入图像中任何区域的像素和都可以通过积分图简单计算得到如图2-4所示。图2-4区域积分图计算Fig.2-4Calculationofregionalintegraldiagram若想要求出输入图像中D区域的像素和，已知D区域的的四个顶点分别为α、β、γ、δ，则D区域的像素和可以通过四个顶点表示，D区域计算公式如式（2-3）所示。ii()+ii()-(ii()+ii())Dsum式（2-3）为了更加全面的描述图像的特征，获得图像中更多种类的描述算子，将Haar-like常规矩形描述特征进行变换拓展，例如如将矩形特征旋转45°作为新的描述模板，拓展后的模板特征大致可分为4类，分别为：边缘特征模板、线特征环模板、圆心环绕特征模板和对角线特征模板如图2-5所示。天津科技大学硕士学位论文15图2-5矩形描述算子扩展图Fig.2-5ExpansiondiagramofrectangulardescriptionoperatorLBP特征的描述器又被称为局部二值模式，常常用于提取图像的局部特征。LBP特征描述器在图像处理方面具有较强的鲁棒性，即具有像素旋转不变性和像素灰度不变性等特征。并且LBP特征描述器具有计算原理简单，特征提取速度快，效果明显等特点，因此LBP特征描述算子应用在计算机视觉各个领域，LBP特征描述器经常被应用在人脸识别和目标检测方向。LBP描述算子相较于Haar计算特征值更加简单，如在图像的局部区域内有3*3尺寸的像素，以局部区域的中心像素为判定阈值，在局部区域内将中心像素与其他周围的像素点相比较，若局部区域内周围像素值大于中心点像素值即为1，若小于中心点像素值为0。因此围绕着中心点的8个像素点呈现0、1数值，可以组成8位二进制数，八位二进制数可以解码为一个二进制数值，这个数值就是区域内中心像素点的LBP的值。所以LBP特征描述算子反应了图像的纹理特征。为了加强LBP描述算子的表达能力，相关研究人员将图像像素的LBP描述算子做了改进，提出了圆形LBP算子，LBP旋转不变模式等。进一步提升了对图像特征的提取能力，LBP的二进制转化形式如图2-6所示。图2-6LBP的二进制转化形式Fig.2-6BinaryconversionformofLBPLBP用于人脸检测时，图像中人脸所在的区域都可以用LBP特征描述算子进行特征提取，人脸区域的每一个像素点都可以用LBP值来表示，首先将输入的图像进行灰度化，从灰度图像中记录每个像素点的灰度值，然后计算图像中每个像素点灰度值天津科技大学硕士学位论文16对应的LBP数值，组成新的LBP算子特征描述图。LBP的优点对不同光照有很好的鲁棒性，从而提取图像中目标物的纹理信息如图2-7所示。图2-7LBP检测的纹理图Fig.2-7TexturemapofLBPdetectionLBP特征描述算子的特征提取向量步骤如下。（1）首先将输入图像窗口划分成若干个小区域细胞单元（cell）；（2）然后将输入图像预处理灰度化。计算图像中每个细胞单元中灰度点的像素值，将灰度像素值与其邻域的像素值相比较，大于中心像素点的值标记为1，小于则标记0。因此中心点邻域内的8个像素点都可以用0、1代替，然后将二进制数组合成为二进制数值，即可得到该图像中某像素点的LBP特征值；（3）计算每个细胞单元中描述图像特征直方图，即在局部区域中LBP数值出现的频率，将直方图看作向量并做归一化处理。（4）最后将描述图像局部特征的直方图连接在一起，形成图像特征的描述器，即描述图像纹理特征向量描述器，最后利用机器学习相关分类算法检测分类，完成特征提取等任务。计算机视觉中常常用于特征提取，目标物轮廓检测的另一个特征描述器为HOG（HistogramofOrientedGradient,HOG）特征。HOG图像特征提取算法主要是通过像素值与像素坐标统计图像的梯度幅值和梯度方向信息，将梯度幅值在梯度方向上加权形成梯度方向直方图构成特征描述向量，将特征向量送人SVM分类器中分类学习，最后完成目标识别与检测的任务，尤其在行人检测中具有极高识别率。（1）主要思想：在输入的一张图像中，图像的目标特征和形状能够被边缘梯度和梯度方向的密度很好的描述出来。（2）具体的实现方法是：首先将输入的图像分成多个连通区域即相互关联细胞单元。然后统计连通区域中各像素点的梯度幅值和梯度方向组合成梯度直方图。将直方图看作一维特征向量，这个一维特征向量就成为小细胞单元的特征描述器。天津科技大学硕士学位论文17（3）提高性能：为了提高图像提取的泛化能力，提升图像特征的描述力，将小的细胞区域的特征描述向量扩展到大区域的特征描述向量。归一化后得到图像特征描述器，能对光照变化具有很好的鲁棒性。（4）优点：与其他特征提取算法相比，HOG特征有很多优点。因为HOG特征提取是在输入图像的区域单元格中进行梯度边缘提取，所以它对图像的局部形变和光照变化的影响具有良好的鲁棒性。其次，HOG特征的特征描述器包含了边缘梯度幅值和梯度方向两个因素，对动态特征的描述更加细致。因此HOG特征常常用于图像中的人体检测。2.2.2疲劳检测算法原理疲劳驾驶检测系统的人脸检测识别部分采用分层梯度方向直方图(PyramidHistogramofOrientedGradients，PHOG)算法，在梯度方向直方图(HistogramofOrientedGradients，HOG)算法的基础上进行改进加入分层金字塔结构，比局部二值模式(LocalBinaryPattern，LBP)、HOG算法更加稳定，具有更强的抗干扰能力，能适应强光、弱光等极端环境。PHOG是由HOG算法改进而来，HOG图像特征提取算法常常被应用在计算机视觉各个领域，HOG特征算法常常用来提取目标物的轮廓特征。由上述HOG特征算法描述可以得出，HOG特征描述器的原理是通过计算图像区域的梯度幅值和梯度方向来提取图像特征。首先将输入的图像分成若干个连通区域即细胞单元，然后计算和统计各个连通区域内像素点的梯度方向直方图，最后将各个区域的梯度方向直方图以向量的形式组合在一起构成图像特征描述器，输入到分类器中进行识别分类。PHOG算法步骤如下：（1）采用伽玛（Gamma）校正法对输入图像进行灰度化处理，有效的减小图像噪声干扰和光照变化的影响，通过调整gamma的值来处理图像，Gamma压缩公式为：,(,)gammaIxyIxy式（2-4）（2）计算图像梯度。根据输入图像中像素点的像素值(,)Hxy分别计算出水平方向的梯度和垂直方向的梯度，公式为：(,)(1,)(1,)GxyHxyHxyx式（2-5）(,)(,1)(,1)yGxyHxyHxy式（2-6）像素点(,)xy处的梯度幅值和梯度方向为：22(,)(,)(,)GxyGxyGxyxy式（2-7）天津科技大学硕士学位论文18(,)1[0,180)(,)GxyyGxyx（x,y）=tan式（2-8）（3）将图像划分成若干个小的连通区域即细胞单元，如每个细胞单元由8*8个像素点组成，将细胞单元内的每个像素点的梯度幅值在梯度方向上做累加操作，例如将梯度幅值在9个自由度方向上进行累加，得到每个细胞单元对应的梯度方向直方图形成1*9的一维向量，计算统计细胞单元对应的直方图过程如图2-8所示。图2-8形成梯度方向直方图Fig.2-8Forminggradientdirectionhistogram（4）将若干个连通区域的描述器组合成大区域块特征描述器，即将区域块内的所有细胞单元图像特征向量串联得到大区域特征描述器，然后滑动block模块描述器获取整张图片的一维向量特征如图2-9所示。图2-9HOG算法获取图像特征描述器Fig.2-9Imagefeaturedescriptoracquiredbyhogalgorithm（5）将HOG特征进行拓展引入分层梯度直方图即PHOG，把输入的图像进行不同尺寸的分割，例如将图片分割成3×3、6×6不同尺度。计算出不同尺寸HOG图像特征值，将这些HOG值相加在一起得到一维向量，归一化处理后，将一维向量特征描述器送入分类器中完成图像识别分类等功能。天津科技大学硕士学位论文19使用PHOG算法，利用OpenCV对视频流进行处理，检测出视频中人脸的轮廓，识别出人脸区域的界限，并用方框框住人脸的位置。2.2.3人脸的68个关键点定位人的面部比例通常可以用三庭五眼来形容，就是将面部纵向分为三等分，面部横向分为五等分，三庭五眼的三庭分为三个等分分别为从额头到眼眉，从眼眉到鼻尖，从鼻尖到下额，五眼是指将人脸从左侧发际线到右侧发际线分成5份，每份的距离为眼睛的长度，形成人脸的黄金比例，可根据人脸三庭五眼的比例用68个关键点描述出面部轮廓，三庭五眼如图2-10所示。图2-10人脸三庭五眼Fig.2-10Threecourtyardsandfiveeyesofhumanface人脸检测与识别的实现，运用OpenCV结合dlib库中的人脸识别检测器来提高准确率，dlib是基于深度学习残差网络ResNet-34训练实现的，根据人脸三庭五眼的比例训练人脸图片数据，最终获得人脸的检测模型，在人脸检测与识别和人脸轮廓关键点定位上具有较高的准确率，在复杂环境中能检测人脸，具有较高的稳定性和抗干扰能力。ResNet-34残差网络在传统的网络基础上进行局部区域短路连接，其主要作用是防止随着卷积层数的增加特征图的尺寸不断减少，而图像的特征丢失。而在训练时也有好的收敛效果，最重要的一点是防止网络的加深出现脸部特征丢失等现象，ResNet对于训练提取脸部的关键点有明显的效果，残差网络结构图如2-11所示。图2-11残差网络结构图Fig.2-11Residualnetworkstructure图中为两种结构的局部网络残差图，其中左图适用于卷积层数较少的结构，右图天津科技大学硕士学位论文20适用于较多卷积层结构，右图中通过1*1卷积来改变维度，减少计算量，两种结构原理相同都通过局部短路连接的方式训练参数完成特征融合。在利用人脸识别算法识别检测人脸后，为了能够精确的计算出疲劳区域的疲劳阈值，需要提取出人脸的特征关键点，我们可以将人脸的轮廓通过特征关键点表示，其中包括脸的外部轮廓，眼眉、眼睛、鼻子、嘴等器官，在平面坐标系中，每个器官轮廓都可由2维坐标表示。本文检测出人脸的68个关键点如图2-12所示。图2-12人脸的68个关键点坐标Fig.2-1268keypointcoordinatesofhumanface算法流程：本文利用笔记本摄像头采集视频数据，使用pycharm编程环境，用python编程语言实现算法流程，首先将采集到的视频进行视频帧循环，引入人脸检测器，检测出人脸在视频中的位置，利用opencv画图工具绘制矩形框，框住检测出的驾驶员的人脸，然后引入人脸关键点检测器检测出面部关键点坐标，用红色点分别标注出检测出的关键点，绘制出人面部的轮廓。人面部识别和关键点检测算法流程图如图2-13所示。图2-13面部识别和关键点检测算法流程图Fig.2-13Flowchartoffacerecognitionandkeypointdetectionalgorithm天津科技大学硕士学位论文21在对输入视频进行处理时首先需要循环视频帧，然后将每一帧图像进行扩大维度，灰度处理对脸部位置检测，循环脸部位置信息并获得脸部特征位置信息，将脸部特征信息转化为数组格式，获得脸部轮廓特征坐标并用红色点表示。2.3实验检测结果实验运行效果如图2-14所示，从视频中截取的一帧图像，首先对视频帧中的图像扩大维度，然后做灰度化处理如左图所示，检测出人脸在视频中的位置信息并用蓝色框框住，实时循环脸部位置信息检测出脸部的特征信息，将面部信息转化为数组格式存储备用，根据数组信息标记出人脸的68个关键点，可以明显看出68个红色关键点描述出人脸的轮廓，并描述出面部眼睛、鼻子、嘴等重要特征轮廓。图2-14检测出人脸和68个关键点Fig.2-14Detectedfaceand68keypoints人脸的68个关键点中1-17号代表左脸和右脸的外轮廓坐标、18-27号为左眼眉和右眼眉的坐标，37-40表示左眼轮廓坐标，43-48为右眼轮廓坐标，28-36为鼻子和鼻子底部的轮廓坐标，49-67为嘴部的外轮廓和内轮廓坐标。2.4本章小结本章基于PHOG图像特征提取算法原理，在视频中识别检测人脸的位置，根据人脸三庭五眼的比例，引用RestNet的残差网络训练出人脸位置信息检测和关键点检测模型的检测器，结合OpenCV完成人脸特征信息提取，用矩形框框住人脸位置和红色点描述出驾驶员面部的轮廓，其优点是表达能力强，具有较强的稳定性和抗干扰能力，而且在各种复杂情况下能实时准确的检测和跟踪视频中人脸，并检测出人脸的68个关键点坐标。天津科技大学硕士学位论文223面部眼、嘴检测与疲劳判定当驾驶员处于疲劳状态时，面部眼、嘴会发生眨眼、打哈欠等生理反应，眨眼和打哈欠的频率会随着驾驶员的疲劳发生明显变化。疲劳检测系统首先检测出人眼与嘴部的位置，然后设定驾驶员眨眼和哈欠的阈值，最后根据单位时间内视频帧中眨眼和哈欠的频率来判断驾驶员的疲劳状态。3.1人眼检测与疲劳判定眼睛的行为特征是疲劳检测的主要因素之一，而当驾驶员疲劳时，眼睛通常会表现为眨眼的行为，本文通过OpenCV在复杂的环境中识别出人脸，并从视频流循环帧，并对每个视频帧图片扩大维度，进行灰度化处理。将人脸部的特征信息转化为数组信息，提取面部左右眼坐标信息，设定眨眼阈值，设定眼睛的疲劳阈值，判断面部眼睛是否属于疲劳状态。检测的算法流程如图3-1所示。图3-1人眼检测算法流程图Fig.3-1Flowchartofhumaneyedetectionalgorithm3.1.1人眼定位当人处于疲劳状态时，眨眼的频率会逐渐增加，因此可以通过检测人眼的实时状态判断驾驶员是否处于疲劳驾驶。疲劳检测系统在复杂的环境下检测出视频中人脸的位置，并可以检测出描述人脸轮廓的68个关键点，根据面部68个关键点索引出人眼的坐标，定位人眼的位置，面部人眼的左右眼坐标如表3-1所示。天津科技大学硕士学位论文23表3-1面部眼睛轮廓坐标Table.3-1Facialeyecontourcoordinates面部特征坐标左眼像素点坐标x451460469477470461y309305305306310310右眼像素点坐标x383392401410402392y3103073073103133133.1.2眨眼阈值EAR的设定疲劳检测系统已经检测出了人脸，并且标记出人脸68个关键点坐标，我们可以提取出人的左右眼坐标，当人处于疲劳状态时，人眼会出现眯眼、闭眼等状态，为了更准确的检测出眼睛的状态，设定一个眨眼阈值，当小于这个阈值时认定为眼睛是闭合的。图3-2中36~41数字代表左眼坐标。通过眼睛坐标设定一个眼睛长宽比的眨眼阈值EAR，眼睛睁开时阈值会随着眼睛的抖动上下波动变化不明显，当阈值急剧下降且小于阈值时，将认为其是眨眼或闭眼行为，眨眼阈值EAR计算公式如式（3-1）所示。3741384036392YYYYEARXX眼式（3-1）图3-2眼睛坐标示意图Fig.3-2Eyecoordinatediagram3.1.3眨眼疲劳阈值的设定设定眨眼阈值后进一步设定眨眼疲劳阈值，驾驶员从正常状态到疲劳状态的过程中，眨眼的频率会发生明显变化，根据PERCLOS准则，首先统计单位时间内视频帧的总帧数，然后统计单位时间内眼睛闭合的帧数，最后通过二者的比值设定一个眨眼疲劳阈值，当驾驶员驾车过程中眨眼的频率超过这个阈值时，将认为驾驶员人眼处于疲劳状态，眼睛的疲劳阈值如式（3-2）所示。天津科技大学硕士学位论文24100%NPERCLOSN眼单位时间内眼部闭合帧数单位时间内的总帧数式（3-2）算法实现流程：获得眼睛部位坐标，通过长宽比设定眼睛眨眼阈值，检测当前帧图像中眼睛长宽比值是否小于设定阈值，若小于设定的眨眼阈值，则认为是一次眨眼行为，增加一次眨眼次数，循环视频帧，计算单位时间内驾驶员处于眨眼状态的总帧数，设定眼睛疲劳阈值，最后根据实时检测出的眼睛疲劳阈值判断驾驶员是否处于疲劳状态，算法流程如图3-3所示。图3-3循环视频帧判断眼部疲劳Fig.3-3Circularvideoframetojudgeeyefatigue3.1.4实验结果分析运行效果图如图3-4所示，疲劳检测系统在视频中检测到人脸，并用蓝色边框框住人脸所在的位置，通过预测器获得人脸68个关键点坐标并用红色点标记出来，系统检测出了人眼的特征点坐标，为了更明显的表现出人眼部位，将人的左右眼坐标用绿色曲线连接起来，并且疲劳检测系统能够实时的检测出眨眼的次数和眼睛闭合的阈值显示在窗口中。天津科技大学硕士学位论文25图3-4人眼检测运行效果图Fig.3-4Operationeffectofhumaneyedetection3.2人嘴部检测与疲劳判定嘴部行为特征是疲劳检测的第二个重要因素，而当驾驶员疲劳时，嘴部通常会表现为哈欠的行为，本文通过OpenCV在复杂的环境中识别出人脸，并从视频流循环帧，并对每个视频帧图片扩大维度，进行灰度化处理。将人脸部的特征信息转化为数组信息，提取驾驶员嘴部信息，设定哈欠阈值，设定嘴部的疲劳阈值，判断嘴部是否属于疲劳状态。检测的算法流程如图3-5所示。图3-5嘴部疲劳检测算法流程Fig.3-5Flowchartofmouthfatiguedetectionalgorithm天津科技大学硕士学位论文263.2.1人嘴部定位当人处于疲劳状态时，哈欠的频率会逐渐增加，因此通过检测人嘴部的状态可以有效的反应出驾驶员是否处于疲劳驾驶。疲劳检测系统在复杂的环境下检测出视频中人脸的位置，并检测出人脸的68个关键点，根据人脸68个关键点索引出人嘴部的坐标，定位人嘴部的位置，嘴部内外轮廓坐标如表3-2、3-3所示。表3-2嘴部外轮廓坐标Table3-2Mouthcontourcoordinates面部特征坐标嘴部外轮廓像素点坐标x413421431439446457y384374369371369373x466459450441433423y382392397399389394表3-3嘴部内轮廓坐标Table3-3Mouthinnercontourcoordinates面部特征坐标嘴部内轮廓像素点坐标x419432439447462448440433y3843783783773813863873863.2.2哈欠阈值MAR的设定疲劳检测系统在视频中检测出人脸，并索引出人脸的68个关键点坐标，当驾驶员疲劳状态时，会出现哈欠的行为，嘴部处于张开状态，人处于说话状态时嘴部也处于张开状态，可以设定一个哈欠阈值，当超过这个阈值处于哈欠行为状态，低于阈值将视为正常状态，如图3-6所示嘴部内轮廓坐标点为60~67，嘴部外轮廓坐标点为48~59。根据嘴部的开度设定阈值来判定是否处于打哈欠状态，人说话或哼歌时也处于张开状态，阈值会在一定范围内上下波动。当打哈欠时嘴部阈值会持续增加，并会持续一定的时间，将视为处于哈欠行为状态。采取内轮廓疲劳阈值1K与外轮廓疲劳阈值2K的均值MAR判别哈欠状态，内轮廓与外轮廓的计算如式（3-3）和（3-4）所示。50585256148542YYYYKXX式（3-3）61676365260642YYYYKXX式（3-4）天津科技大学硕士学位论文27122KKMAR嘴式（3-5）图3-6嘴部坐标示意图Fig.3-6Schematicdiagramofmouthcoordinates3.2.3哈欠疲劳阈值的设定设定哈欠阈值后进一步设定哈欠疲劳阈值，驾驶员从正常状态到疲劳状态的过程中，会出现打哈欠的行为特征，并且哈欠的频率会发生明显变化，根据PERCLOS准则，首先统计单位时间内视频帧的总帧数，然后统计单位时间嘴部超过哈欠阈值的帧数，最后通过二者的比值设定一个哈欠的疲劳阈值，当驾驶员驾车过程中眨眼的频率超过这个阈值时，将认为驾驶员处于疲劳状态，哈欠的疲劳阈值如式（3-6）所示。100%NPERCLOSN嘴单位时间内嘴部闭合帧数单位时间内的总帧数式（3-6）算法实现流程：获得人脸嘴部轮廓坐标，利用嘴部坐标的计算出嘴部轮廓的横向欧式距离和纵向欧式距离，通过嘴部轮廓横纵距离的比值得出嘴部开合度的阈值，循环视频帧实时检测出嘴部开合度的阈值，设定驾驶员打哈欠时嘴部开合度阈值，检测当前帧的图像中嘴部长宽比值是否小于设定阈值，若小于设定的哈欠阈值，结束当前帧的判断，若大于设定的哈欠阈值，则认为是一次哈欠行为，增加一次哈欠次数，循环视频帧并对每一帧进行判别，统计计算单位时间内哈欠的总帧数，设定嘴部疲劳阈值，若大于疲劳阈值则判断为疲劳状态，若小于疲劳阈值则继续循环视频帧判断，最后根据视频实时检测出的嘴部疲劳阈值判断驾驶员是否处于疲劳状态，算法流程如图3-7所示。天津科技大学硕士学位论文28图3-7循环视频帧判断嘴部疲劳Fig.3-7Circularvideoframetojudgemouthfatigue3.2.4实验结果的分析运行效果图如图3-8所示，疲劳检测系统在视频中检测到人脸，并用蓝色边框框住人脸所在的位置，通过预测器获得人脸68个关键点坐标并用红色点标记出来，系统检测出了人眼和嘴部的特征点坐标，为了更明显的表现出人眼和嘴部的位置，将人的左右眼和嘴部坐标用绿色曲线连接起来，并且疲劳检测系统能够实时的检测出眨眼和哈欠的阈值和次数显示在窗口中。图3-8面部检测效果图Fig.3-8Effectdiagramoffacedetection天津科技大学硕士学位论文293.3本章小结本章主要是在二维空间中对驾驶员面部特征进行分析，根据分析面部眼、嘴的生理状态判断驾驶员是否为疲劳驾驶，用摄像头实时采集人脸信息，跟踪驾驶员的人脸并检测出驾驶员的68个关键点坐标。根据面部68个关键点坐标定位驾驶员眼、嘴的位置，得到描述驾驶员人眼和嘴部轮廓的坐标，求出眼、嘴横纵的欧式距离，将横纵距离的比值设定为眨眼和哈欠的阈值，根据阈值判定是否为眨眼或哈欠的生理行为，循环视频帧，提取每一帧中驾驶员的面部信息，通过计算单位时间内眨眼的频率和哈欠的频率来判断驾驶员是否处于疲劳状态。天津科技大学硕士学位论文304人头部检测与疲劳判定当驾驶员处于疲劳状态时，驾驶员头部疲劳特征表现尤为明显，会出现瞌睡点头，反应迟钝等现象，瞌睡点头会随着驾驶员的疲劳程度点头的角度逐渐变大，频率逐渐变高。疲劳检测系统首先确定疲劳时头部的活动范围和活动角度，根据活动的角度确定点头的阈值，然后根据单位时间内视频帧中点头的频率来判定驾驶员的疲劳状态。4.1计算机视觉四大坐标系在计算机视觉中常常用到坐标变换等概念，常常会用摄像机记录空间中物体的姿态，图像处理中常被用到的坐标系有：世界坐标系、相机坐标系、图像坐标系、像素坐标系。世界坐标系：表示物体在真实世界中的位置，我们常常用相机采集物体在空间中的大小、位置、姿态等信息时，相机可以摆放在空间中的任何位置，我们可以在实际空间环境中建立一个空间直角坐标系来确定摄像机在空间中的位置，而且还可以描述空间中任何物体的位置，我们将这个空间直角坐标系称为世界坐标系。摄像机坐标系：相机坐标系是以摄像机的光心作为原点，光心位于凸透镜的的镜头上。以摄像机正前方光轴方向为z轴，与图像坐标系平行的x，y轴建立空间直角坐标系，摄像机光轴方向与图像坐标系垂直，与图像平面的交点作为图像的原点，摄像机坐标系也叫做相机坐标系。相机坐标系为三维空间的，记录物体的空间信息，相机坐标系的度量单位一般为米或厘米。像素坐标系：像素坐标系主要描述像素在图像中的相对位置，像素坐标系的度量单位一般为行和列，像素点在图像的位置可以用几行几列来表示，像素坐标系的原点为图像的左上角，以图像的两条边为x轴和y轴，图像中每个点的像素值表示图像的色彩和亮度等信息。相机记录空间中的物体信息并转化成图像形式以数组的形式储存在计算机中。图像坐标系：像素坐标系的度量单位是行和列表示像素的相对位置，而图像坐标系的度量单位是米和厘米，表示像素点在图像中精确的物理位置。图像坐标系是以光轴延长线与平面的交点为原点，x轴与y轴平行于图像的两条边。综上图像坐标系也可以看作是相机坐标系在z轴方向的投影，因此图像的亮度和色彩的变化就可以由像素坐标和图像坐标两个决定。在实际工程中要想获得物体在实际空间中的姿态信息，需要将物体在空间中的世界坐标转化为图像像素坐标，通过转换矩阵来反应空间中的物体相对于相机的位置关系，例如物体相对于相机的旋转矢量和平移矢量，然后通过透视投影原理将基于相机坐标系的物体信息投影到图像坐标系上获得精确物理单位信息，最后将图像坐标系中的像素点通过像素坐标系做离散化处理，计算机视觉中四个坐标系之间的转换关系如图4-1所示：天津科技大学硕士学位论文31X0111CWcWCWcWCWcWXXXYRTYYRYTZZZZ图4-1坐标系之间的转换关系Fig.4-1Conversionrelationshipbetweencoordinatesystems首先是由世界坐标系转换为相机坐标系，求出物体在世界坐标系到相机坐标系的转换关系，物体在两个三维空间坐标系的变换属于刚体变换，不会改变物体的大小形状等属性，只需要将空间中的物体进行平移和旋转等位姿的变化就可以得到物体在相机中的坐标，因此世界坐标到相机坐标的转换矩阵包括旋转矩阵和平移矩阵。那么从世界坐标系到相机坐标系的转换关系如图4-2所示：图4-2世界坐标系到相机坐标系的转换关系Fig.4-2Conversionrelationshipfromworldcoordinatesystemtocameracoordinatesystem其中世界坐标系上的一点P乘以旋转矩阵R得到其旋转姿态信息，再加上平移矩阵T得到其平移姿态的信息，最终得到P点在相机坐标系中的坐标，其中R为3*3旋转矩阵，T为3*1的平移矩阵如式（4-1）所示。式（4-1）从相机坐标系转换到图像坐标系是将三维空间信息转换为2维图像信息，利用投影原理沿Z轴方向做投影得到图像坐标信息，其转换关系如图4-3所示：天津科技大学硕士学位论文32图4-3相机坐标系到图像坐标系的转换关系Fig.4-3Conversionrelationshipfromcameracoordinatesystemtoimagecoordinatesystem在求相机坐标系到图像坐标系之间的转换关系中根据三角形相似性原理，求出图像坐标系中的坐标信息，根据图像坐标信息求出与世界坐标之间的转换矩阵，根据4-3图像得出公式如下：,~CCCCABOOCOPBOpCO式（4-2）CCCCCAOXZYABPBoCoOpCxfy式（4-3）,CCCCXYxfyfZZ式（4-4）式（4-5）图像坐标系与像素坐标系是在同一图像平面上，两个坐标系的原点和度量单位不同。二者对图像像素点的描述方式不同。图像坐标系描述图像每个像素点的真实物理位置，度量单位为厘米或毫米。而像素坐标系是将图像上的像素点进行离散化处理，用行和列来表示像素点的位置。像素坐标系与图像坐标系的转换关系如图4-4所示。图4-4图像坐标系到像素坐标系的转换关系Fig.4-4Conversionrelationshipfromimagecoordinatesystemtopixelcoordinatesystem000000100101CCCCXxfYZyfZ天津科技大学硕士学位论文33000010000001Z000000**010110010001000111wwxwwcywwuXXdxuffuYYRTRTvvffvKZWZZdy综上所述，通过四大坐标系之间的转换关系可以得出实际空间的一点世界坐标对应转换到像素坐标系之间的转换关系，在计算转换关系时我们还需要得到相机的内参数据、外参数据以及相机可能出现的畸变参数等等。根据这些参数矩阵我们就可以得到矩阵之间的转换关系，矩阵的变换关系如公式（4-6）所示，其中R，T矩阵参数为旋转矩阵与平移矩阵，分别反应真实世界物体相对于相机成像中的空间姿态。式（4-6）4.2人头部检测与疲劳判定头部行为特征是疲劳检测的第三个重要因素，当人处于疲劳状态时，颈部肌肉会出现间歇放松，产生瞌睡点头生理状态。因此可以通过点头频率来判断驾驶员是否处于疲劳状态。通过笔记本摄像头采集视频数据，循环视频每一帧，对每一帧图像进行扩大维度，并进行灰度化处理，通过坐标转换获取头部空间坐标信息，设定瞌睡点头阈值，设定头部疲劳阈值，判断驾驶员是否由于疲劳而瞌睡点头，算法流程图如图4-5所示。图4-5头部疲劳检测算法流程Fig.4-5Flowchartofheadfatiguedetectionalgorithm天津科技大学硕士学位论文344.2.1世界坐标与图像坐标的转换而头部的检测与面部检测不同，头部活动的范围是在三维的空间中，需要先对驾驶员头部空间姿态估计，先将头部2D关键点与3D人脸模型匹配，例如选取人脸眼眉、鼻子、嘴部等坐标信息与3维空间坐标相匹配。再加入相机内参、外参、畸变参数等相结合获得世界坐标与图像坐标的转换关系，获得旋转矩阵与平移矩阵，定位驾驶员头部的空间位置，在3D模型状态下能更加容易观察头部的活动范围，通过旋转矩阵计算出驾驶员头部活动的欧拉角，其中三维人脸关键点坐标如图4-6所示。图4-6人脸三维空间坐标信息Fig.4-6Coordinateinformationofface3Dimage4.2.2人头部活动的欧拉角的判定人头部的活动范围大概分为三种状态，点头、摆头、摇头。当驾驶员与人聊天或观察汽车左右两侧的后视镜时会出现摇头的状态，此时并不能反应驾驶员是否处于疲劳的状态，但是当驾驶员出现点头或摆头的状态时，认为是驾驶员正处于疲劳状态而引起瞌睡的行为。如图4-7所示，将结合pitch和roll两个角度来判断驾驶员是否处于疲劳状态，在这两个角度范围中，根据头部运动的欧拉角设定瞌睡点头阈值。图4-7头部活动的角度Fig.4-7Angleofheadmovement天津科技大学硕士学位论文354.2.3瞌睡点头阈值的设定疲劳检测系统在视频中识别人脸，并检测出人脸所在的位置，通过坐标变换将2D平面坐标转换为3D空间坐标，将面部关键点坐标与3D空间坐标相匹配，得到人头部空间3D坐标，通过3D空间坐标计算出头部活动范围的欧拉角，设定头部欧拉角点头阈值，驾驶员在驾驶位左右摆头，或轻微点头和摆头，我们认为是正常的驾驶状态，若点头或摆头的角度超过阈值，认定其为瞌睡状态，则驾驶员处于疲劳驾驶状态，设定头部点头阈值的算法流程如图4-8所示。图4-8瞌睡点头阈值设定Fig.4-8Dozingnodthresholdsetting在获取驾驶员头部空间姿态后，可以实时检测头部的空间状态包括驾驶员点头、摆头、摇头等状态的活动角度，采集数据如表4-1所示。表4-1头部姿态活动范围Table.4-1Headposturerangeofmotion头部姿态Pitch/°Yaw/°Roll/°11.82489816825.342884060.4087854062-3.7579784243.40772827724.20342139.2250030627.4623858456.257866003如表中驾驶员头部pitch、yaw、roll三种不同状态，其中pitch和roll是衡量驾驶员是否疲劳的状态因素，如在第一组数据中yaw的角度较高超过25度，但不是疲劳因素可以忽略，在第二组数据中roll的角度达到24度，驾驶员此时为摆头行为，可天津科技大学硕士学位论文36以认定为一次瞌睡点头行为，在第三组中pitch的角度较高，驾驶员此时为点头行为，可作为判断疲劳驾驶的因素之一。4.2.4头部疲劳的判定设定瞌睡阈值后进一步设定瞌睡疲劳阈值，驾驶员从正常状态到疲劳状态的过程中，瞌睡点头行为特征逐渐明显，并且点头的角度和频率会逐渐增加，根据PERCLOS准则，首先统计单位时间内视频帧的总帧数，然后统计单位时间头部超过瞌睡阈值的帧数，最后通过二者的比值设定一个哈欠的疲劳阈值，当驾驶员驾车过程中瞌睡的频率超过这个阈值时，将认为驾驶员处于疲劳状态，哈欠的疲劳阈值如式（4-7）所示。100%NPERCLOSN头单位时间内点头帧数单位时间内的总帧数式（4-7）算法实现流程：首先进行2D人脸关键点检测，然后将与3D模型匹配，求解3D点和对应2D点的转换关系，求出对应的转换矩阵和平移矩阵，根据旋转矩阵求出头部在空间中活动的欧拉角，设定点头角度阈值，当头部在空间的活动欧拉角超过阈值认为是一次点头行为，然后计算单位时间内瞌睡点头次数，最终判断驾驶员是否属于疲劳状态，算法流程图如图4-9所示。图4-9循环视频帧判断头部疲劳Fig.4-9Circularvideoframetojudgeheadfatigue天津科技大学硕士学位论文374.3实验结果分析疲劳检测系统在视频中识别出人脸，并检测出人脸所在视频的位置，通过坐标转换将人脸2D关键点坐标变为3D空间坐标，运行效果图如图4-10所示，系统检测出了人头部的位置，为了更明显的表现出人头部的位置，将人的头部用红色的矩形框框起来，能更加明显的观察出头部的活动范围，并且疲劳检测系统能够实时的检测出头部所在的空间坐标，并将头部瞌睡阈值和点头次数实时显示在窗口中。图4-10头部检测运行效果图Fig.4-10Operationeffectofheaddetection4.4本章小结本章主要介绍计算机视觉中的几个坐标系的关系，如何通过坐标变换将世界坐标转换为像素坐标，并将真实空间的物体姿态等信息转换为数字信息，运用到驾驶员头部空间姿态的检测中，疲劳驾驶检测系统首先检测出人面部关键点坐标信息，然后根据2D关键点坐标信息与三维人脸模型匹配，计算出真实空间中的世界坐标与二维图像坐标之间的转换矩阵，即旋转矩阵与平移矩阵，其中平移矩阵表示头部与相机之间的平移距离，旋转矩阵表示头部与相机之间的旋转姿态。在人的头部建立空间坐标系，确定头部关键点的三维坐标，根据疲劳状态下头部在空间中的活动范围设定瞌睡点头阈值，再根据PERCLOS准则，计算单位时间内点头的频率来判断驾驶员是否处于疲劳状态。天津科技大学硕士学位论文385疲劳驾驶检测系统分析5.1朴素贝叶斯算法通过眼、嘴、头部等疲劳因素可以实时判断驾驶员的疲劳状态，也可以考虑将多种疲劳特征因素融合后进行疲劳检测。根据医学资料显示，人面部和头部等疲劳行为特征相互不关联，例如眨眼、哈欠、和点头都属于独立条件属性，根据这些单一特征因素，可以采用朴素贝叶斯分类算法进行疲劳分类判别，朴素贝叶斯算法是以贝叶斯理论为基础。可以给定的条件特征集为X=(x1,x2,x3)，如x1为眨眼的样本属性，x2为哈欠的样本属性，x3为点头样本属性。Y为类别集Y{c1,c2}。c1代表正常驾驶状态，c2代表疲劳驾驶状态，由贝叶斯定理得：()(|)()(|)(|)()(|)()kkkkkkPYcPXxYcPYPXYPYcXxPXPXxYcPYc式（5-1）由于疲劳因素的条件相互独立所以：(|)(,,....|)1122(|)kkkPXxYcPXxXxXxYcjjPXxYcjjj式（5-2）由式（5-1）和（5-2）得：()(|)(|)()(|)kkjkkkjjjjjjPYcPXxYcPYcXxPYcPXxYc式（5-3）根据公式（5-3）建立朴素贝叶斯分类器：()argmax()(|)kkkjjyfxpYcPXxYccj式（5-4）由朴素贝叶斯分类器可知，输入疲劳驾驶的疲劳因素即样本属性，得出概率最大的类别就是预测出的结果。若根据这个原理，可以通过多个疲劳因素综合判别驾驶员的疲劳状态。5.2疲劳驾驶系统的分析本次实验使用惠普笔记本自带摄像头完成视频数据采集，使用Python3.7编程语言和Tensorflow2.4框架，在Pycharm编程环境下使用OpenCV进行人脸检测和面部关键点定位以及头部的三维空间的确定。为了证明算法的稳定性，和可靠性，分别采集人脸在不同环境下进行疲劳因素测试实验，例如戴眼镜状态、戴帽子状态、强光状态、弱光状态，每个状态下进行多组实验测试，为了证明算法的有效性分别采集不同人脸进行疲劳因素测试实验，观察实验测试中每个人脸疲劳特征因素的变化，得出结论。天津科技大学硕士学位论文395.2.1不同环境下测试系统的稳定性驾驶员在驾驶仓内会遇到各种复杂的环境，例如驾驶员常常会佩戴眼睛，佩戴帽子等。而且驾驶仓内环境的多变性也会为疲劳检测增加难度，为了验证算法的稳定性和抗干扰能力，分别在理想环境、戴眼镜、戴帽子、强光、弱光等不同状态下进行5组实验测试，每种环境经过多次试验得出眨眼、哈欠、瞌睡的实验数据，其中理想环境且无穿戴的状态下测得的数据如表5-1所示。表5-1理想状态下疲劳因素测试数据Table.5-1Fatiguefactortestdataunderidealstate眨眼测试实验哈欠测试实验瞌睡测试实验组号测试眨眼次数实际眨眼次数准确率（%）测试哈欠次数实际哈欠次数准确率（%）测试瞌睡次数实际瞌睡次数准确率（%）12020100101010055100223259211111006610033030100111291.67771004343597.14121392.317887.505384095141410099100由实验数据可知理想环境且无穿戴状态下眼、嘴、头部疲劳因素测试平均准确率分别为96.83%、96.80%、97.5%，均有很高的准确率。所以该方法在理想实验条件下进行疲劳检测具有较好的实验效果。表中测得的数据是假设驾驶员处于理想环境下时，测得疲劳特征准确率都很高，由于驾驶汽车时会出现各种复杂的环境条件，例如驾驶汽车时会穿戴饰品如戴眼镜或戴帽子等。当驾驶汽车面向太阳或背对着太阳时，会出现强光或弱光的环境等，为了测试系统的稳定性和抗干扰能力，分别在不同环境因素影响下测试实验数据，其中驾驶员佩戴眼镜测得的数据如表5-2所示。表5-2戴眼镜状态下疲劳因素测试数据Table.5-2Fatiguefactortestdataunderwearingglasses眨眼测试实验哈欠测试实验瞌睡测试实验组号测试眨眼次数实际眨眼次数准确率（%）测试哈欠次数实际哈欠次数准确率（%）测试瞌睡次数实际瞌睡次数准确率（%）119209510101005510022425961111100661003293096.6712121006785.714333594.29121392.31881005384095131492.8699100从测得的数据可以看出驾驶员佩戴眼镜的状态下测得眨眼、哈欠、瞌睡因素平均准确率分别为95.392%、97.034%、97.142%。由数据可以发现哈欠和瞌睡点头的准确率基本保持不变，眨眼的平均准确率相较于理想状态下准确率有所波动，但是准确率仍然处于95%以上。驾驶员佩戴眼镜时会对眨眼的疲劳特征因素的检测有所影响，但天津科技大学硕士学位论文40仍然具有较高的准确率，由此得出结论驾驶员在佩戴眼镜时疲劳检测系统仍然具有极高的稳定性。表5-3戴帽子状态下疲劳因素测试数据Table.5-3Fatiguefactortestdataunderhatwearing眨眼测试实验哈欠测试实验瞌睡测试实验组号测试眨眼次数实际眨眼次数准确率（%）测试哈欠次数实际哈欠次数准确率（%）测试瞌睡次数实际瞌睡次数准确率（%）1202010010101005510022425961111100661003293096.671212100771004333594.29121392.317887.505384095131492.868988.89由表5-3数据可知驾驶员佩戴帽子状态下测得眨眼、哈欠、瞌睡的平均准确率分别为96.392%、97.034%、95.278%，由测得的数据可以发现眨眼和哈欠的准确率基本保持不变，测得驾驶员瞌睡点头的准确率相较于理想状态下有所波动，但是其准确率仍处于95%以上。当驾驶员佩戴帽子等头上饰品时会对瞌睡点头的疲劳特征因素有所影响，但仍然保持较高的准确率，由此可以得出结论驾驶员在戴帽子时疲劳检测系统仍然具有较高稳定性和抗干扰能力。表5-2与表5-3是在驾驶员佩戴装饰的情况下测得的数据，验证驾驶员在佩戴装饰的情况下系统的稳定性，驾驶员开车出行时，疲劳检测系统也会受到自然环境的影响，在早上或正午时阳光充足，会有较强的光线照射到驾驶仓内，或在下午和黄昏时段，驾驶室内的光线较为暗淡等自然环境，为了验证系统的抗干扰能力，将分别在强光和弱光的情况下测得疲劳特征数据，验证系统的稳定性。在强光的环境下测出的数据如下表所示。表5-4强光状态下疲劳因素测试数据Table.5-4Fatiguefactortestdataunderstronglight眨眼测试实验哈欠测试实验瞌睡测试实验组号测试眨眼次数实际眨眼次数准确率（%）测试哈欠次数实际哈欠次数准确率（%）测试瞌睡次数实际瞌睡次数准确率（%）119209510101005510022425961111100661003283093.33111291.676785.714343597.141313100881005384095131492.8689100由表5-4可知，当驾驶汽车处于强光的环境下检测到的眨眼、哈欠、瞌睡的平均准确率分别为95.294%、96.906%、97.142%，虽然准确率有所波动但均在95%以上。由此可以得出结论，驾驶汽车处于强光的环境下，疲劳检测系统仍然具有较高的稳定性和抗干扰能力。天津科技大学硕士学位论文41表5-5弱光状态下疲劳因素测试数据Table.5-5Fatiguefactortestdataunderweaklight眨眼测试实验哈欠测试实验瞌睡测试实验组号测试眨眼次数实际眨眼次数准确率（%）测试哈欠次数实际哈欠次数准确率（%）测试瞌睡次数实际瞌睡次数准确率（%）119209510101005510022425961111100661003293096.671212100771004333594.29121392.317887.505384095131492.868988.89由表5-5可知，当驾驶汽车处于弱光的环境下，检测到眨眼、哈欠、瞌睡的平均准确率分别为95.392%、97.034%、95.278%，虽然准确率有所波动但均在95%以上。由此可以得出结论，驾驶汽车处于弱光的环境下，疲劳检测系统仍然具有较高的稳定性和抗干扰能力。在上述复杂的环境下测得眨眼、哈欠、瞌睡的准确率，实验数据表明，驾驶员处于不同环境下的疲劳特征因素的准确率有所不同。从折线图可以看出在驾驶员佩戴不同装饰的情况下分别对疲劳特征因素有所影响，而驾驶员处于强光或弱光的情况下疲劳特征因素检测的准确率相较于理想状态普遍有所下降，不同环境下检测结果曲线对比图如图5-1所示。图5-1疲劳因素检测示意图Fig.5-1Diagramoffatiguefactordetection综上所述，无论驾驶员在穿戴配饰还是在强光或弱光等自然环境干扰的情况下，疲劳特征因素测试实验的准确率虽有波动但都在95%以上，由此说明PHOG算法具有很好的稳定性和抗干扰性。在上述复杂情况下的运行效果图5-2所示。天津科技大学硕士学位论文42图5-2戴眼镜检测结果Fig.5-2Testresultsofwearingglasses如图所示当驾驶员在戴眼镜的情况下，系统可以检测出人脸，标定出人脸的68个关键点，并用正方体标定出人头部的位置，检测出当前眨眼阈值EAR为0.21、眨眼次数Blinks为24次，和哈欠阈值MAR为0.41、哈欠次数Yawns16次，以及头部的空间坐标x，y，z。并用红色正方体框住人头部所在的位置，检测出点头次数3次，最后检测出驾驶员的疲劳状态。当驾驶员在戴帽子的情况下，系统依然可以检测出人脸，标定出人脸的68个关键点，并用正方体标定出人头部的位置，检测出眨眼阈值EAR、眨眼次数Blinks和哈欠阈值EAR、哈欠次数Yawns及头部的空间坐标，并检测出驾驶员的疲劳状态，运行效果如图5-3所示。图5-3戴帽子检测结果Fig.5-3Testresultsofwearinghat当驾驶员处于强光的环境下，系统具有较强的稳定性和抗干扰能力，仍然可以检测出驾驶员的各项疲劳特征参数并检测出驾驶员的疲劳状态，运行效果如图5-4所示。天津科技大学硕士学位论文43图5-4强光情况下的检测结果Fig.5-4Testresultsunderstronglight当驾驶员处于弱光的环境下，检测系统并不受影响，可以准确的检测出眼、嘴及头部的疲劳特征参数并检测出驾驶员的疲劳状态，运行效果如图5-5所示。图5-5弱光情况下的检测结果Fig.5-5Testresultsunderweaklight5.2.2收集人脸进行测试分析为了证明疲劳检测系统的有效性和可靠性，本次实验又收集了实验室中不同人脸的数据，对不同人脸进行疲劳因素测试如下图所示。图5-6疲劳检测结果Fig.5-6Fatiguetestresults天津科技大学硕士学位论文44实验中采集了实验室中女同学人脸进行测试，系统依然能检测出面部眼、嘴和头部的空间位置，而且可以统计视频中眨眼次数、哈欠次数、瞌睡点头的次数，由此可以证明系统的有效性。图5-7疲劳检测结果Fig.5-7Fatiguetestresults为了证明系统的持续稳定性，在图5-7中增加了测试者眨眼次数、哈欠次数、点头次数。系统依然可以实时的检测出疲劳状态，由此可以证明系统的稳定性。图5-8疲劳检测结果Fig.5-8Fatiguetestresults在图5-8中，我故意减少嘴部疲劳特征哈欠的次数，可以看出在其中一种疲劳特征不足的情况下也依然可以检测出人脸的疲劳状态。可以证明系统的稳定性。综上所述，经过不同人脸疲劳检测结果可知，疲劳检测系统可以准确的检测和识别出图像中的人脸，并检测出人脸的68个关键点和头部的空间坐标，最终检测出疲劳状态，证明算法较高的有效性和稳定性。5.2.3实际工况中测试分析为了验证疲劳检测系统在实际工况下的稳定性，在驾驶仓内进行疲劳检测，在不同因素的影响下进行测试如图5-9所示。天津科技大学硕士学位论文45(a)理想无穿戴状态(b)戴眼镜状态(c)戴帽子状态下(d)多因素影响状态下图5-9驾驶室内疲劳检测结果Fig.5-9Fatiguetestresultsincab从检测示意图中可以看出，在驾驶室内实际工况中无论是理想状态还是佩戴眼睛、佩戴帽子或是多因素环境影响下都能检测出驾驶员的疲劳状态，并可以实时检测出驾驶员眼睛、嘴部的开合度阈值和头部的空间位置。因此可以证明系统在实际工况中的有效性和稳定性。5.3本章小结疲劳驾驶检测系统具有很好的稳定性、有效性和抗干扰能力，通过眨眼、哈欠、瞌睡点头等疲劳因素判断驾驶员的疲劳状态。由于驾驶员真实的驾驶环境比较复杂，为了验证系统的抗干扰能力和稳定性，分别在驾驶员穿戴配饰、强光、弱光等环境下测试系统的准确性，经过大量实验测试，实验数据表明疲劳驾驶检测系统的准确性均在95%以上，证明疲劳驾驶检测系统具有很好的稳定性和抗干扰能力，为了验证系统的有效性，又采集不同人脸进行疲劳检测测试，面对不同人脸疲劳驾驶系统依然能检测出疲劳状态，并能够准确的检测出不同人脸眨眼、哈欠、瞌睡点头的实时数据，并显示在窗口中，由此证明疲劳检测系统具有良好的有效性和实时性。综上所述疲劳驾驶检测系统可以在复杂的环境中准确的检测出驾驶员面部和头部疲劳特征的数据，并实时反应出驾驶员的疲劳状态。天津科技大学硕士学位论文466总结与展望6.1全文总结本文采用PHOG算法，结合OpenCV进行人脸检测和关键点定位，标注出人脸68个关键点，通过关键点坐标计算出哈欠和眨眼的开合度阈值，将人脸的2D关键点与人脸3D模型匹配，通过坐标转换计算出旋转矩阵和平移矩阵，通过旋转矩阵计算出头部空间活动的欧拉角，设定疲劳瞌睡点头阈值。根据PERCLOS准则，结合单位时间内眼、嘴以及头部视频帧的变化确定驾驶员疲劳的阈值，最终判断驾驶员的疲劳状态。通过实验数据表明，在上述复杂的环境下对眨眼、哈欠、点头的识别准确率均达到了95%以上。由此可以得出结论，PHOG算法在疲劳检测方面效果良好，且检测驾驶员人脸具有较强的稳定性和抗干扰能力。6.2论文创新点（1）随着疲劳驾驶导致交通事故的不断增加，为了减少人们生命财产的损失，致力于驾驶员疲劳检测系统的研究。本文主要基于多信息疲劳驾驶检测系统的研究，在复杂环境背景下检测出驾驶员人脸的位置，并实时跟踪视频中人脸的位置，检测出驾驶员人脸的68个关键点坐标，设定疲劳阈值，实时监控预警，本文采用PHOG算法进行人脸识别与检测，相对于传统图像处理算法具有更高的稳定性和抗干扰能力，可以适应强光、弱光等恶劣的自然环境。（2）本文在面部识别检测的基础上增加了驾驶员的头部检测，利用驾驶员2D关键点与3D人脸模型的匹配，计算出旋转矩阵与平移矩阵，利用旋转矩阵求出驾驶员头部在空间的活动欧拉角，设定驾驶员的瞌睡点头阈值，最终判断驾驶员是否处于疲劳状态。该方法为疲劳检测系统增加了一个疲劳因素较传统的疲劳检测更加全面。更能准确的检测出驾驶员的疲劳状态。6.3后续工作展望本文通过对PHOG算法实现了在复杂环境下对视频中人脸识别、检测与跟踪，且跟踪结果具有很好的稳定性和鲁棒性。但仍存在一些不足之处需要进一步改进和完善：（1）本文只是对驾驶员戴眼镜、戴帽子、强光、弱光的环境下进行人脸识别检测与跟踪，而现实中驾驶员所处在车内驾驶环境更加复杂。例如驾驶员处于车内完全黑暗的情况下，该算法是否能够准确的检测出人脸的位置，进行疲劳驾驶检测，需要进一步研究。（2）本文只对驾驶员在驾驶位置保持正确驾驶姿势的状态下进行人脸识别检测与跟踪，但实际上在驾驶员长期驾驶疲劳时，驾驶员的身体会出现后仰或前倾等驾驶姿势，在这种情况下会严重影响驾驶员采集视频中人脸数据，所以基于人体姿态对疲劳检测的影响仍需进一步研究。天津科技大学硕士学位论文47（3）本文对人面部眼、嘴及头部姿态等单一特征因素进行疲劳检测分析，后续应增加新的疲劳特征因素，并结合文中提到的朴素贝叶斯算法综合多个特征因素判断驾驶员的疲劳状态。（4）虽然本文的疲劳驾驶检测系统能够基本满足实时性的需求，但未达到满意的效果，仍需在算法计算量方面进行进一步的完善，由于两帧之间的变化速度较快，因而考虑到在如何优化算法来提升检测速度上做进一步研究。天津科技大学硕士学位论文487参考文献[1]ShiomiY，ToriumiA，NakamuraH.Internationalanalysisonsocialandpersonaldeterminantsoftrafficviolationsandaccidentsemployinglogisticregressionwithelasticnetregularization[J]．IATSSResearch，2022，46(1)：36-45．[2]单亚男，李树彬，林兆丰．城市快速路交通事故特性分析与安全评价[J]．山东学，2022，35(02)：115-123．[3]布和．道路交通事故的成因分析及预防研究[J]．武汉公安干部学院学报，2019，33(02)：16-20．[4]AminiRetal．TherelationshipbetweensleepqualityandroadtrafficcrashesofurbandriversinHamadan，Iran．[J]．Journalofinjury&violenceresearch，2020，12(1)：47-53．[5]ChungEKandParkSYandSohnYW．EffectsofOccupationalDrivers’TrafficAccidentHistoryonRiskPerception，WorkAttitudes，andUnstableDriving[J]．TransportationResearchRecord，2021，2675(10)：734-744．[6]ZhaoyouMetal．AnalysisoftheRelationshipbetweentheNumberofTrafficAccidentsandtheTrafficFlow&SectionLocationinExtraLongTunnel[J]．Engineering，2020，12(02)：71-81．[7]FisaRetal．Effectsofinterventionsforpreventingroadtrafficcrashes：anoverviewofsystematicreviews．[J]．BMCpublichealth，2022，22(1)：513-513．[8]孟继成．关于我国汽车安全驾驶影响因素的分析[J]．时代汽车，2021(11)：187-188．[9]WangZ，JiY，FuY，LiuF，DuX，LiuHG，ZhuW，XueKZ，QinW，ZhangQ．Geneexpressionassociatedwithhumanbrainactivationsinfacialexpressionrecognition．[J]．Brainimagingandbehavior，2022：1-14．[10]邓明阳，付锐，陈广交．道路交通事故背景因素指标的采集和统计分析[J]．重庆交通大学学报(自然科学版)，2012，31(04)：852-856．[11]魏凌峰，姜文龙．基于支持向量机的交通事故影响因素分析[J]．山东交通科技，2022(01)：84-87．[12]AsamiM，NakaharaS，MiyakeY，KandaJ，OnukiT，MatsunoA，SakamotoT．SerumD-dimerlevelasapredictorofneurologicalfunctionalprognosisincasesofheadinjuriescausedbyroadtrafficaccidents．[J]．BMCemergencymedicine，2022，22(1)：51-51．[13]廖烜永．道路交通事故车辆技术状况鉴定分析[J]．时代汽车，2022(08)：193-195．[14]ZainafreeIetal．TheRoadSafetyEducationProgramforAdolescentsUsingSocialMedia，ProvingIncreasingKnowledge，Beliefs，Attitudes，IntentionsandBehavior[J]．Safety，2022，8(1)：12-12．天津科技大学硕士学位论文49[15]张彦虎，鄢丽娟，张彦军．一种能实现免脱帽人脸识别系统算法[J]．计算机测量与控制，2022，30(02)：244-251．[16]MesquitelaJetal．DataAnalyticsProcessoverRoadAccidentsData—ACaseStudyofLisbonCity[J]．ISPRSInternationalJournalofGeo-Information，2022，11(2)：143-143．[17]YangXBandZhangW．Heterogeneousfacedetectionbasedonmulti‐taskcascadedconvolutionalneuralnetwork[J]．IETImageProcessing，2021，16(1)：207-215．[18]PranavKBandManikandanJ．DesignandEvaluationofaReal-TimeFaceRecognitionSystemusingConvolutionalNeuralNetworks[J]．ProcediaComputerScience，2020，171(C)：1651-1659．[19]MarconFandPasquiniCandBoatoG．DetectionofManipulatedFaceVideosoverSocialNetworks：ALarge-ScaleStudy[J]．JournalofImaging，2021，7(10)：193-193．[20]MuhammadU，YuZ，KomulainenJ．Self-supervised2Dfacepresentationattackdetectionviatemporalsequencesampling[J]．PatternRecognitionLetters，2022，156：15-22．[21]SubbaiahDV，PushkalP，RaoK．Venkata．Driverdrowsinessdetectionsystembasedoninfinitefeatureselectionalgorithmandsupportvectormachine[J]．InternationalJournalofKnowledge-basedandIntelligentEngineeringSystems，2022，25(4)：439-448．[22]王富强，刘德胜，刘云鹏．基于面部特征的疲劳驾驶检测技术研究[J]．现代计算机，2021(07)：121-124．[23]DeviB，PreethaMS，JainM．AutomaticFaceEmotionRecognitionWiththeAidofProbability-BasedBirdSwarm-TrainedNeuralNetwork[J]．InternationalJournalofSwarmIntelligenceResearch(IJSIR)，2021，12(4)：1-24．[24]孙洋，李汉林，邓晓慧，李秋慧，王传敏，王彩凤．基于OpenCV与STM32的驾驶员健康监控系统设计[J]．高师理科学刊，2021，41(02)：41-45．[25]ThorleyC，ActonB，ArmstrongJ，FordS，GundryM．Areestimatesoffaces’ageslessaccuratewhentheywearsunglassesorfacemasksanddothesedisguisesmakeithardertolaterrecognisethefaceswhenundisguised?[J]．CognitiveResearch：PrinciplesandImplications，2022，7(1)：17-17[26]BennettsRJ，JohnsonHP，ZielinskaP，BateS．Facemasksversussunglasses：limitedeffectsoftimeandindividualdifferencesintheabilitytojudgefacialidentityandsocialtraits[J]．CognitiveResearch：PrinciplesandImplications，2022，7(1)：18-18．天津科技大学硕士学位论文50[27]AyorindeHO，PromiseIA，KehindeGO．DeviceSynchronizationUsingAComputerizeFaceDetectionAndRecognitionSystemForCybersecurity[J]．InternationalJournalofComputer(IJC)，2022，42(1)：30-40．[28]李志华，张见雨，魏忠诚．基于MTCNN和Facenet的人脸识别系统设计[J]．现代电子技术，2022，45(04)：139-143．[29]KumarAetal．AhybridtinyYOLOv4-SPPmodulebasedimprovedfacemaskdetectionvisionsystem．[J]．Journalofambientintelligenceandhumanizedcomputing，2021，：11-14．[30]LiuXandWangYandLuanJ．FacialParalysisDetectioninInfraredThermalImagesUsingAsymmetryAnalysisofTemperatureandTextureFeatures[J]．Diagnostics，2021，11(12)：2309-2309．[31]SongZ，NguyenK，NguyenT，ChoC，GaoJ．SpartanFaceMaskDetectionandFacialRecognitionSystem[J]．Healthcare，2022，10(1)：87-87[32]蔡苗．人脸信息收集中知情同意规则的构建[J]．网络安全技术与应用，2022(02)：139-140．[33]AnilKY，R．K．Pateriya，NirmalKG，PunitG，4，DineshKS，MohammadA．HybridMachineLearningModelforFaceRecognitionUsingSVM[J]．Computers，Materials&Continua，2022，72(2)：2697-2712[34]管凯捷，姚康，任谊文，张熙，付威威．基于头动与眼电信号的疲劳检测研究[J]．计算机应用与软件，2022，39(02)：81-87．[35]Chalabi，NourEetal．Particleswarmoptimizationbasedblockfeatureselectioninfacerecognitionsystem[J]．MultimediaToolsandApplications，2021，80(24)：1-17．[36]宋广辉．智能汽车技术未来发展趋势[J]．时代汽车，2020(21)：29-30．[37]SanchezMorenoASetal．EfficientFaceRecognitionSystemforOperatinginUnconstrainedEnvironments．[J]．Journalofimaging，2021，7(9)：161-161．[38]VinhDN，KhanhXuanHNguyenTran，VuCN，NarayanCDebnath．RobustandReal-TimeDeepLearningSystemforCheckingStudentAttendance[J]．JAIT，2021，12(4)：296-301．[39]张佐营，叶桂荀．驾驶疲劳监测技术研究综述[J]．汽车科技，2022(01)：8-14．[40]LiXJandLingJXandShenY．Visualfatiguereliefzoneinanextra-longtunnelusingvirtualrealitywithwearableEEG-baseddevices[J]．JournalofCentralSouthUniversity，2022，28(12)：3871-3881．[41]黄瑛，黄淑兵，周云龙．基于FP-growth算法的车辆通行特征与交通事故关联分析[J]．道路交通管理，2022(01)：30-33．[42]Cao，Min．Facerecognitionrobotsystembasedonintelligentmachinevisionimage天津科技大学硕士学位论文51recognition[J]．InternationalJournalofSystemAssuranceEngineeringandManagement，2021，：1-10．[43]R．VinodiniandM．Karnan．Facedetectionandrecognitionsystembasedonhybridstatistical，machinelearningandnature-basedcomputing[J]．InternationalJournalofBiometrics，2022，14(1)：3-19．[44]NajlaaHAandEmadSJ．DynamicAudio-VisualBiometricFusionforPersonRecognition[J]．Computers，Materials&Continua，2022，71(1)：1283-1311．[45]刘硕，贺丽丽．基于图像处理的疲劳驾驶检测系统[J]．运城学院学报，2021，39(06)：51-54．[46]ShettyAB，Bhoomika，Deeksha，RebeiroJ，Ramyashree．FacialrecognitionusingHaarcascadeandLBPclassifiers[J]．GlobalTransitionsProceedings，2021，2(2)：330-335[47]蔡旭刚，王磊，王帆，李俊廷，潘家辉．融合语音和脑电的智慧病房控制系统[J]．计算机系统应用，2021，30(11)：71-81．[48]SongZWetal．SpartanFaceMaskDetectionandFacialRecognitionSystem[J]．Healthcare，2022，10(1)：87-87．[49]汪洪涛，谢牡丹，潘昊．基于面部特征的疲劳驾驶检测方法研究[J]．武汉理工大学学报(交通科学与工程版)，2021，45(05)：851-856+862．[50]DrozdowskiPetal．Signal‐levelfusionforindexingandretrievaloffacialbiometricdata[J]．IETBiometrics，2022，11(2)：141-156．[51]汪涵，高青松，吴科技．基于光纤传感器的汽车人眼预警系统[J]．科学技术创新，2020(32)：82-83．[52]ZhaoNetal．FatigueDetectionwithSpatial-TemporalFusionMethodonCovarianceManifoldsofElectroencephalography[J]．Entropy，2021，23(10)：1298-1298．[53]王健，杨秀奇，王亚威．基于树莓派4B的司机疲劳驾驶警报系统[J]．电子元器件与信息技术，2021，5(09)：178-179．[54]ChanisaJandKasiruMandTharagaS．DesigningaPrototypeforFaceRecognitionbasedSmartLockerSystem[J]．InternationalJournalofSciences：BasicandAppliedResearch(IJSBAR)，2022，61(1)：338-341．[55]RastogiRetal．AlgorithmicAnalysisofAutomaticAttendanceSystemUsingFacialRecognition：ARevolutionaryApproachforFutureEducation[J]．InternationalJournalofDecisionSupportSystemTechnology(IJDSST)，2022，14(1)：1-19．[56]周继红，杨傲，袁丹凤，向洪义．疲劳驾驶及其评估方法进展[J]．伤害医学(电子版)，2021，10(03)：45-50．[57]王政，汪军．不同姿态下基于多特征融合的疲劳状态检测方法[J]．重庆工商大学学报(自然科学版)，2021，38(06)：26-33．天津科技大学硕士学位论文52[58]LiXF，XiaJH，CaoLB，ZhangGuanJ，FengX．Driverfatiguedetectionbasedonconvolutionalneuralnetworkandfacealignmentforedgecomputingdevice[J]．ProceedingsoftheInstitutionofMechanicalEngineers，2021，235(10-11)：2699-2711．[59]CurtidorAandBaydykTandKussulE．AnalysisofRandomLocalDescriptorsinFaceRecognition[J]．Electronics，2021，10(11)：1358-1358．[60]NasirMohammadA.Haqueetal.Facialvideo-baseddetectionofphysicalfatigueformaximalmuscleactivity[J].IETComputerVision,2016,10(4):323-329.[61]DavisJP，DrayC，PetrovN，BelanovaE．Lowprevalencematchandmismatchdetectioninsimultaneousfacematching：Influenceoffacerecognitionabilityandfeaturefocusguidance．[J]．Attention，perception&psychophysics，2021，83(7)：1-18[62]李京徽，郭昕刚．一种疲劳驾驶检测方法[J]．长春工业大学学报，2021，42(04)：371-377．[63]WangCYandTianYXandJiaHB.Drivingfatiguedetectionbasedonfeaturefusionofinformationentropy[J].JournalofComputationalMethodsinSciencesandEngineering,2018,18(4):977-988.[64]龚昊，伍雪冬，金钊．光照不变特征下的人脸识别改进方法[J]．计算机与数字工程，2019，47(09)：2300-2305．[65]WangHGetal.HierarchicalCNN-basedreal-timefatiguedetectionsystembyvisual-basedtechnologiesusingMSPmodel[J].IETImageProcessing,2018,12(12):2319-2329.[66]ViolaP，JonesM．FastandrobustclassificationusingasymmetricAdaBoostandadetectorcascade[A]．InAdvancesinNeuralInformationProcessingSystems14[C]，-Cambridge，MA，USA：MITPress，2002：1311-1318[67]高荣星，魏骁勇，王俊峰．一种基于Adaboost-SVM的高层次语义概念提取方法[J]．计算机应用与软件．2012(04)：30-32[68]ShuL，Wu，ZiH，Suo，HuanD，Chen，Yuchen，Zhao，Yang，Zhang，JinB，Chen，QiaoN，Meng．Roadragedetectionalgorithmbasedonfatiguedrivingandfacialfeaturepointlocation[J]．NeuralComputingandApplications，2022(prepublish)：1-11[69]于雯，赵峰，王艳，梅诗雯，梁振杰．基于车联网的酒驾疲劳预警监测管理系统[J]．工业仪表与自动化装置，2020(05)：87-89+92．[70]AyorindeHO，PromiseIA，KehindeGO．DeviceSynchronizationUsingAComputerizeFaceDetectionAndRecognitionSystemForCybersecurity[J]．InternationalJournalofComputer(IJC)，2022，42(1)：30-40天津科技大学硕士学位论文53[71]李小平，白超．基于深度学习的司机疲劳驾驶检测方法研究[J]．铁道学报，2021，43(06)：78-87．[72]王川，段德全，王晓东．基于改进的PSO和HMM的Web信息抽取算法[J]．河南师范大学学报（自然科学版）．2010(09)：65-68.[73]MuhammadU，YuZ，KomulainenJ．Self-supervised2Dfacepresentationattackdetectionviatemporalsequencesampling[J]．PatternRecognitionLetters，2022，156：15-22.[74]孙玥，杨国为，陈雪鑫．基于计算机视觉的疲劳及注意力检测算法[J]．计算机与数字工程，2021，49(06)：1195-1198+1239．[75]P．Karuppanan，K．Dhanalakshmi．CriminalPersonsRecognitionUsingImprovedFeatureExtractionBasedLocalPhaseQuantization[J]．IntelligentAutomation&SoftComputing，2022，33(2)：1025-1043[76]宋美玉．无人驾驶汽车领域的人工智能技术应用[J]．湖北农机化，2020(14)：74-75．[77]R．Vinodini，M．Karnan．Facedetectionandrecognitionsystembasedonhybridstatistical，machinelearningandnature-basedcomputing[J]．InternationalJournalofBiometrics，2022，14(1)：3-19[78]阳晓霞，钟海强，李春来．基于图像识别技术的疲劳驾驶预警系统的设计[J]．信息与电脑(理论版)，2021，33(09)：138-140．[79]SukhavasiSBabu，ElleithyK，ElSayedA，ElleithyA．DeepNeuralNetworkApproachforPose，Illumination，andOcclusionInvariantDriverEmotionDetection[J]．InternationalJournalofEnvironmentalResearchandPublicHealth，2022，19(4)：2352-2352[80]HirokiM，NozomiN，TakuyaN，TakeshiI．BlinkingDetectionforObstructionWarningSignalusingFrontCamera：PAPERS[J]．QuarterlyReportofRTRI，2021，62(2)：118-123[81]黄志超，赵红梅，陈奕迅，汤耀森．基于面部识别的驾驶员疲劳危险驾驶检测系统[J]．机电工程技术，2021，50(12)：143-146．[82]娄平，杨欣，胡辑伟，萧筝，严俊伟．基于边缘计算的疲劳驾驶检测方法[J]．计算机工程，2021，47(07)：13-20+29．[83]汉纳森创新技术实现基于车辆运行数据检测疲劳驾驶[J]．城市公共交通，2021(04)：104．[84]HasanMK，AhsanM．ShamimA，NewazS．H．Shah，LeeGM．HumanFaceDetectionTechniques：AComprehensiveReviewandFutureResearchDirections[J]．Electronics，2021，10(19)：2354-2354天津科技大学硕士学位论文54[85]CrayeC，RashwanA，KamelMS，etal．Amulti-modaldriverfatigueanddistractionassessmentsystem[J]．InternationalJournalofIntelligentTransportationSystemsResearch，2016，14(3)：173-194．[86]朱名流，李顶根．基于人脸特征点的疲劳检测方法研究[J]．计算机应用研究，2020，37(S2)：305-307．[87]LiL，XiaZ，WuJ，YangL，HanH．Facepresentationattackdetectionbasedonopticalflowandtextureanalysis[J]．JournalofKingSaudUniversity-ComputerandInformationSciences，2022，34(4)：1455-1467[88]张希波，成波，冯睿嘉．基于方向盘操作的驾驶人疲劳状态实时检测方法[J]．清华大学学报(自然科学版)，2010，50(07)：1072-1076+1081．[89]屈肖蕾，成波，林庆峰，李升波．基于驾驶员转向操作特性的疲劳驾驶检测[J]．汽车工程，2013，35(09)：803-807+831．[90]KavithaHS，SugunaGC．EyeBlinkDetectionSystemforParalyzedPatients[J]．InternationalJournalofRecentTechnologyandEngineering(IJRTE)，2020，8(6)：333-336．[91]JoseMM，CarolinaDP，HECTORR，etalMonitoringdriverfatigueusingasingle-channelelectroencephalographicdevice：Avalidationstudybygaze-based，drivingperformance，andsubjectivedata[J]．AccidentAnalysisandPrevention，2017，109：62-69．[92]LuoHW，QiuTR，LiuC，etalResearchonfatiguedrivingdetectionusingforeheadEEGbasedonadaptivemulti-scaleentropy[J]．BiomedicalSignalProcessingandControl，2019，51：50-58．[93]MarkusG，DavidS，NatividadMM，etal．ECGsensorfordetectionofdriver’sdrowsiness[J]．ProcediaComputerScience，2019，159：1983-1946．[94]ArtantoD，SulistyantoMP，DeradjadPI，etal，Drowsinessdetectionsystembasedoneye-closureusingaLow-costEMGandESP8266[C]//20172ndinternationalconferencesonInformationTechnology，InformationSystemsandElectricalEngineering(ICITISEE)，Yogyakarta，Indonesia，2017：234-237．[95]XuJL，MinJL，HuJF．Real-timeeyetrackingfortheassessmentofdriverfatigue[J]．HealthcareTechnoloogyLetters，2018，5(2)：54-58[96]WangY，HuangR，GUOL．EyegazepatternanalysisforfatiguedetectionbasedonGP-BCNNwithESM[J]．PatternRecognitionLetters，2019，123：61-74[97]PoursadeghiyanM，MazloumiA，SarajigN，atal．Usingimageprocessingintheproposeddrowsinessdetectionsystemdesign[J]．IranJPublicHealth，2018，47(9)：1371-1378．[98]KnapikM，CyganehB．Driver’sfatiguerecognitionbasedonyawndetecionin天津科技大学硕士学位论文55thermalimages[J]．Neurocomputing，2019，338：274-292．[99]AnithaC，VenkateshaM，AdigaBS．Atwofoldexpertsystemforyawningdetection[J]．ProcediaComputerscience，2016，92：63-71．[100]牛清宁，周志强，金立生，刘文超，于鹏程．基于眼动特征的疲劳驾驶检测方法[J]．哈尔滨工程大学学报，2015，36(03)：394-398．[101]旷文腾，毛宽诚，黄家才，李海彬．基于高斯眼白模型的疲劳驾驶检测[J]．中国图象图形学报，2016，21(11)：1515-1522．[102]张伟，成波，张波．驾驶人眼睛定位与跟踪算法的研究[J]．汽车工程，2012，34(10)：889-893．[103]邹昕彤，王世刚，赵文婷，赵晓琳，李天舒．基于眼睛与嘴部状态识别的疲劳驾驶检测[J]．吉林大学学报(信息科学版)，2017，35(02)：204-211．